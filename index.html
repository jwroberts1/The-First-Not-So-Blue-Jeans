<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Man: 20,000 Fleas Under the Sea Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* New Game Styles */
        #game-canvas {
            background-color: #e0f2fe; /* Light blue sky */
            border: 4px solid #0284c7; /* Sky blue border */
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: grid !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            &larr; Go to Spelling
        </a>
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Dog Man: 20,000 Fleas Under the Sea</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: The Deep-Sea Dilemma</h2>

                <p class="mb-4">The adventure, brought to life once again by George and Harold, blasts off not with a crime, but with a date! The Chief, after finally working up the courage, asks Nurse Lady out to dinner, and he brings Dog Man along as his "wingman." Of course, with Dog Man involved, nothing stays simple. They go to a fancy restaurant called the Shark Shack, but the grumpy cook refuses to serve Dog Man. While the Chief and Nurse Lady try to have a nice date, Dog Man chases a squirrel, which leads to a chaotic chase through the kitchen. This ends with the grumpy cook getting covered in dogs and, strangely, deciding he loves them. This small, silly moment, however, is just the beginning of a much bigger, and much smaller, adventure.</p>
                <p class="mb-6">Meanwhile, Petey the Cat is a free man... well, a free cat. He's been released from cat jail and is trying his best to be a good "papa" to Li'l Petey. His first project as a good guy is to rebuild his secret lab. But he immediately hits a wall. The construction lady he tries to hire recognizes him. "Hey! You're the cat who stole all the toilets!" she yells, remembering one of his past evil schemes. She refuses to work for an ex-convict, leaving Petey feeling frustrated. He complains to Li'l Petey and their tadpole friend, Molly, that it's impossible to do good when no one will give him a second chance. Petey is stuck, unable to move forward because of his past.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Tiniest Breakout</h3>

                <p class="mb-4">While Petey is struggling with his new life, his old life is causing new problems. Deep in the city, the tiny, shrunken villains known as the FLEAS (Fuzzy Little Evil Animal Squad) are still trapped in the Mini-Jail. The leader, Piggy, is as grumpy and evil as ever. His two henchmen, Crunky the kraken and Bub the ape, however, have had a change of heart. They have decided they don't want to be evil anymore. They want to be... the "Friendly Friends"! They spend all day singing cheerful songs about helping and caring, which drives Piggy absolutely crazy. "Stop singing!" he screams, but they won't. Piggy is surrounded by goodness, and he hates it.</p>
                <p class="mb-6">Their tiny prison, however, isn't as secure as they thought. A big, friendly dog named Mister Stinkles, out on a walk, spots the Mini-Jail. Thinking it's a toy, he picks it up, shakes it, and then drops it, shattering the jail to pieces. The FLEAS are free! Piggy is overjoyed. "Now we can do evil!" he cackles. But Crunky and Bub have other plans. "Hooray!" they cheer. "Now we can do good!" They immediately find a kind inventor named Uncle Larry, who also happens to be a frog. Uncle Larry is thrilled to meet the "Friendly Friends" and shows them his amazing headquarters, complete with a brand-new invention: a high-tech, flying submarine! Piggy, seeing the submarine, gets a diabolical idea. He tricks Uncle Larry and the Friendly Friends, trapping them so he can steal the submarine for his own evil plans.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Panic in the City</h3>

                <p class="mb-4">At the news station, superstar reporter Sarah Hatoff gets a tip about the escaped villains. She calls in the story: "The FLEAS are back!" But the media boss at the TV station isn't listening properly. "What's that?" he yells. "A disease? Coming from the sea? Got it!" The station immediately runs a breaking news story: "A terrifying plague of '20,000 FLEAS UNDER THE SEA' is coming to wipe out the city!" The news is completely wrong, but it causes a massive panic. Everyone in the city starts buying toilet paper and building bunkers, terrified of the imaginary plague.</p>
                <p class="mb-6">Piggy, watching the news from his stolen submarine, is thrilled. "They're all panicking over nothing!" he laughs. "This is the perfect distraction!" While the entire city is hiding from a fake sickness, Piggy uses the submarine to fly around and commit crimes. He robs banks, steals art, and causes chaos, and no one is around to stop him. The Supa Buddies (Dog Man, Li'l Petey, Molly, and 80-HD) realize what's happening. They team up with Petey, who is desperate to prove he's a good guy now. "We have to stop him!" Petey declares. They all manage to sneak aboard the flying submarine, ready for a showdown with Piggy.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Way, Way Down</h3>

                <p class="mb-4">A giant fight breaks out inside the submarine. Piggy, Crunky, Bub, and the Supa Buddies are all rolling around, crashing into controls. In the chaos, Piggy grabs a powerful new weapon: the Shrink-V Scepter. "I'll shrink you all!" he screams. He blasts the Supa Buddies, but the beam reflects off 80-HD's metal head and hits the submarine's controls instead. The entire submarine, with everyone inside it (except Piggy), begins to shrink. It gets smaller, and smaller, and smaller... down to the size of a tiny speck of dust.</p>
                <p class="mb-6">Piggy, now alone in his cockpit, laughs as he watches the tiny submarine float away. "Good riddance!" he sneers. But then, he feels a tickle on his nose. He sneezes, and the microscopic submarine is sucked right into his nostril! The heroes are trapped, floating in the one place they never wanted to be: inside Piggy's body. They navigate the submarine through the dark, slimy passages until they are accidentally washed into one of Piggy's sweat glands. To them, it's like a giant, dark ocean. "This must be the sea!" says Li'l Petey. "I guess the news was right after all!"</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Mighty Mite</h3>

                <p class="mb-4">But they are not alone. A creature lurks in the darkness of the sweat gland. A monstrous, horrifying, giant... parasitic mite. To the tiny heroes, this mite is the size of a blue whale. It's a "Mighty Mite," and it's hungry. The mite attacks the submarine, its giant claws tearing at the metal. The heroes are terrified. "We have to fight it!" yells Dog Man. Petey, using his smarts, realizes the submarine is damaged. "The propeller is broken!" he shouts. "Molly, you're a tadpole! You have to swim outside and be our new propeller!"</p>
                <p class="mb-6">Molly, who is just a tiny tadpole, is terrified. "I can't! I'm too small!" she cries. But Li'l Petey gives her a hug. "It's not about being big or small, Molly," he says. "It's about being brave and DOING good!" Inspired, Molly takes a deep breath, swims out of the sub, and starts kicking her tail as fast as she can. She becomes a living motor, pushing the submarine forward. They ram the Mighty Mite, and then, in a burst of inspiration, Petey finds the "Grow" button. "Everyone, hold on!" he yells. He slams the button just as they escape Piggy's nostril.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Big Ending</h3>
                
                <p class="mb-4">The submarine explodes out of Piggy's nose and instantly grows to a massive, skyscraper-sized ship, right in the middle of the city. Piggy, still on board, is captured. The giant submarine lands harmlessly, and the city is saved. The news station, realizing its mistake, quickly changes the story: "The FLEAS have been stopped, and the 'plague' is over! Hooray for the Supa Buddies... and Petey!"</p>
                <p class="mb-6">For the first time, Petey is celebrated as a hero. The construction lady who had rejected him sees him on TV. "Wow," she says. "I guess he really has changed." The next day, she shows up at Petey's place, along with Dog Man, Li'l Petey, Molly, 80-HD, and even Crunky and Bub (the Friendly Friends). "We're here to help you rebuild, Papa," Li'l Petey says, holding up a hammer. Petey, looking at all his new friends, finally understands. It wasn't just about *being* good; it was about *doing* good. And for the first time, he wasn't alone. He finally had a team, and a family, to help him do it.</p>
            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Play the Chase Game!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section (Dog Man Chase) -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Dog Man Chase!</h1>
                <p class="text-gray-600">Use the arrow keys or buttons to help Dog Man catch Petey! Dodge the bombs!</p>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                 <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>
            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden grid grid-cols-3 gap-2 w-48 mt-6">
                <div></div> <!-- Top-left empty -->
                <button id="up-btn" class="control-button w-full">▲</button>
                <div></div> <!-- Top-right empty -->
                
                <button id="left-btn" class="control-button w-full">◀</button>
                <div></div> <!-- Middle-center empty -->
                <button id="right-btn" class="control-button w-full">▶</button>
                
                <div></div> <!-- Bottom-left empty -->
                <button id="down-btn" class="control-button w-full">▼</button>
                <div></div> <!-- Bottom-right empty -->
            </div>


            <div id="win-message" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 class="text-3xl font-bold mb-4 text-yellow-700 header-font">You Caught Petey!</h2>
                    <p class="text-gray-800 text-lg mb-6">Great job, hero!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- QUIZ DATA ---
        // (New questions for "20,000 Fleas Under the Sea")
        const allQuestions = [{
            id: 'q1',
            questionText: 'Why did Petey have trouble hiring a construction lady to rebuild his lab?',
            options: [{ value: 'A', text: 'He didn\'t have enough money.' }, { value: 'B', text: 'She recognized him as the villain who stole all the toilets.' }, { value: 'C', text: 'She was allergic to cats.' }, { value: 'D', text: 'His lab was in a dangerous location.' }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What did Crunky and Bub rename their team after they decided to be good?',
            options: [{ value: 'A', text: 'The Supa Buddies' }, { value: 'B', text: 'The Friendly Friends' }, { value: 'C', text: 'The Evil-No-More Club' }, { value: 'D', text: 'The Kraken and Ape Crew' }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'How did the FLEAS escape from the Mini-Jail?',
            options: [{ value: 'A', text: 'Dog Man accidentally broke it.' }, { value: 'B', text: 'Piggy built a tiny hammer.' }, { value: 'C', text: 'A dog named Mister Stinkles shook it and broke it.' }, { value: 'D', text: 'Uncle Larry rescued them with his submarine.' }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'What was the name of the kind frog inventor who built the flying submarine?',
            options: [{ value: 'A', text: 'Molly' }, { value: 'B', text: 'Bub' }, { value: 'C', text: 'Nurse Lady' }, { value: 'D', text: 'Uncle Larry' }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'What fake news story did the TV station report that caused the whole city to panic?',
            options: [{ value: 'A', text: 'That Dog Man was retiring.' }, { value: 'B', text: 'A plague of "20,000 Fleas Under the Sea" was coming.' }, { value: 'C', text: 'Petey had become the new mayor.' }, { value: 'D', text: 'A giant tidal wave was about to hit the city.' }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'How did the Supa Buddies and Petey get shrunk down to a microscopic size?',
            options: [{ value: 'A', text: 'Piggy blasted them with the Shrink-V Scepter.' }, { value: 'B', text: 'They drank a shrinking potion.' }, { value: 'C', text: 'Piggy\'s shrink beam reflected off 80-HD and hit the submarine.' }, { value: 'D', text: 'They pressed the wrong button on the submarine.' }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'After being shrunk, where did the heroes end up trapped?',
            options: [{ value: 'A', text: 'In the real ocean.' }, { value: 'B', text: 'In a bottle of soda.' }, { value: 'C', text: 'Inside a giant sweat gland on Piggy\'s nose.' }, { value: 'D', text: 'In the city\'s sewer system.' }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'What giant creature did the tiny heroes have to fight inside Piggy?',
            options: [{ value: 'A', text: 'A giant germ' }, { value: 'B', text: 'A parasitic Mighty Mite' }, { value: 'C', text: 'A baby kraken' }, { value: 'D', text: 'A robotic flea' }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'Who acted as the submarine\'s new propeller to help them escape?',
            options: [{ value: 'A', text: 'Molly the tadpole' }, { value: 'B', text: 'Dog Man by wagging his tail' }, { value: 'C', text: 'Li\'l Petey' }, { value: 'D', text: '80-HD' }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'What happened at the very end of the story?',
            options: [{ value: 'A', text: 'Petey decided to become a villain again.' }, { value: 'B', text: 'Piggy became a good guy and joined the Friendly Friends.' }, { value: 'C', text: 'All of Petey\'s new friends showed up to help him rebuild his lab.' }, { value: 'D', text: 'Dog Man got an award from the Mayor.' }],
            type: 'radio'
        }];

        // (New correct answers)
        const correctAnswers = {
            q1: "B",
            q2: "B",
            q3: "C",
            q4: "D",
            q5: "B",
            q6: "C",
            q7: "C",
            q8: "B",
            q9: "A",
            q10: "C"
        };
        // --- END OF QUIZ DATA ---


        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            // We use allQuestions directly, no shuffling of question order
            // const shuffledQuestions = shuffleArray([...allQuestions]);

            allQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    // Find the original label (A, B, C, D) for the shuffled option
                    const originalOption = allQuestions[questionIndex].options.find(o => o.value === option.value);
                    const originalLabel = allQuestions[questionIndex].options.indexOf(originalOption);
                    
                    label.appendChild(input);
                    // We display the option text, not a,b,c,d
                    label.appendChild(document.createTextNode(` ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                            input.checked = true;
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
Dos
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- DOG MAN CHASE GAME LOGIC ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const winMessage = document.getElementById('win-message');
        const playAgainBtn = document.getElementById('playAgainBtn');

        let isGameActive = false;
        let animationFrameId;
        const keys = {};

        const player = { x: 0, y: 0, width: 40, height: 40, speed: 4, symbol: '🐶' };
        const petey = { x: 0, y: 0, width: 40, height: 40, speed: 2, symbol: '🐱' };
        const obstacles = [];
        const obstacleSize = 20;
        let peteyThrowInterval;

        function resetGame() {
            // Stop any active game processes
            isGameActive = false;
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            clearInterval(peteyThrowInterval);

            // Hide win message and clear obstacles
            winMessage.classList.add('hidden');
            obstacles.length = 0;

            // Set initial positions for drawing during countdown
            player.x = 50;
            player.y = canvas.height / 2 - player.height / 2;
            petey.x = canvas.width - 50 - petey.width;
            petey.y = canvas.height / 2 - petey.height / 2;

            function drawStaticFrame() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#65a30d'; // Grassy green
                ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
                ctx.font = '40px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
                ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            }

            function drawCountdownText(text) {
                drawStaticFrame(); // Draw the background first
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.font = 'bold 96px Bangers, cursive';
                ctx.fillStyle = '#ffffff';
                ctx.strokeStyle = '#27272a';
                ctx.lineWidth = 6;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeText(text, canvas.width / 2, canvas.height / 2);
                ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            }

            let count = 3;
            drawCountdownText(count); // Draw initial "3"

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    drawCountdownText(count);
                } else if (count === 0) {
                    drawCountdownText('GO!');
                } else {
                    clearInterval(countdownInterval);
                    // --- START THE ACTUAL GAME ---
                    isGameActive = true;
                    if (!animationFrameId) {
                        gameLoop();
                    }
                    peteyThrowInterval = setInterval(() => {
                        if (!isGameActive) return;
                        obstacles.push({
                            x: petey.x,
                            y: petey.y + petey.height / 2,
                            width: obstacleSize,
                            height: obstacleSize,
                            speed: 5,
                            symbol: '💣'
                        });
                    }, 1200);
                }
            }, 1000);
        }
        
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function gameLoop() {
            if (!isGameActive) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                return;
            }

            // Update player position
            if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
            if (keys['ArrowDown'] && player.y < canvas.height - player.height) player.y += player.speed;
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;

            // Update Petey's position (simple AI)
            if (player.y < petey.y && petey.y > 0) {
                petey.y -= petey.speed;
            } else if (player.y > petey.y && petey.y < canvas.height - petey.height) {
                petey.y += petey.speed;
            }

            // Update obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.x -= obstacle.speed;
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1); // Remove obstacle if it's off-screen
                }
            }

            // Check for collisions
            // 1. Dog Man hits a bomb
            for (const obstacle of obstacles) {
                if (checkCollision(player, obstacle)) {
                    resetGame(); // Restart the game
                    return; // Exit loop for this frame
                }
            }
            // 2. Dog Man catches Petey
            if (checkCollision(player, petey)) {
                isGameActive = false;
                winMessage.classList.remove('hidden');
            }

            // --- DRAW EVERYTHING ---
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw ground
            ctx.fillStyle = '#65a30d'; // Grassy green
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // Draw characters and obstacles
            ctx.font = '40px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
            ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            
            ctx.font = '20px sans-serif';
            obstacles.forEach(obstacle => {
                 ctx.fillText(obstacle.symbol, obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2);
            });


            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // --- EVENT LISTENERS FOR GAME ---
        document.addEventListener('keydown', e => {
             if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
        });
        document.addEventListener('keyup', e => { keys[e.key] = false; });
        
        playAgainBtn.addEventListener('click', resetGame);

        // Mobile Controls
        const controlButtons = {
            'up-btn': 'ArrowUp', 'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft', 'right-btn': 'ArrowRight'
        };

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            if (!btn) return; // Add guard clause in case element isn't found
            const key = controlButtons[id];
            btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mouseleave', (e) => { keys[key] = false; });
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            if (!container) return; // Add guard clause
            const size = container.clientWidth;
            canvas.width = size;
            canvas.height = size;
            // Don't reset game on resize, let it continue
            // if (isGameActive) {
            //     resetGame();
            // }
        }

        function initGame() {
            resizeCanvas();
            resetGame();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', resizeCanvas);
        });
    </script>
</body>

</html>

