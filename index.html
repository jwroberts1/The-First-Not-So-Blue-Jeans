<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charlie Brown & Linus: A Friendship Story</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* --- NEW GAME STYLES --- */
        #game-canvas {
            background: #87CEEB; /* Sky Blue */
            border-bottom: 60px solid #4ade80; /* Grass */
            border-left: 4px solid #3b82f6;
            border-right: 4px solid #3b82f6;
            border-top: 4px solid #3b82f6;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
            width: 100%;
            height: 100%;
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-3xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
            width: 80px;
            height: 80px;
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center; /* Corrected 'align: center' */
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Blanket and the Baseball</h1>
        <p class="text-gray-600 text-center mb-8">A story about how Charlie Brown and Linus became best friends.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-base sm:text-lg border border-gray-200">
                
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 1: The New Kid on the Block</h2>
                <p class="mb-4">It was a Tuesday afternoon, the kind where the clouds look like mashed potatoes and the air smells like fresh-cut grass. Charlie Brown was sitting on the steps of his front porch, his chin resting in his hands. He let out a long sigh. "Good grief," he murmured to himself. Being Charlie Brown wasn't easy. He had just lost another kite to the Kite-Eating Tree, and Lucy had pulled the football away from him for the forty-second time that month.</p>
                <p class="mb-4">Just then, a moving truck rumbled down the street. It was big and orange, and it stopped right next door. Charlie Brown sat up straight. New neighbors! Maybe this was his chance. Maybe the new kid wouldn't know that Charlie Brown was the kid who never won a baseball game. Maybe, just maybe, he could make a new friend.</p>
                <p class="mb-4">A small boy stepped out of the car behind the truck. He had wild hair that stuck up in every direction and was dragging a light blue blanket behind him. He looked younger than Charlie Brown, maybe a few years younger. He walked slowly, looking at the big houses and the tall trees with wide, nervous eyes. He clutched his blanket tightly to his cheek and sucked his thumb.</p>
                <p class="mb-4">Charlie Brown walked over to the fence. "Hello," he said, trying to sound confident. The little boy took his thumb out of his mouth. "Hello," he whispered. "I'm Linus. My sister Lucy is inside yelling at the movers." Charlie Brown groaned. "Lucy? Is she the one with the loud voice who likes to boss people around?" Linus nodded solemnly. "That's her." Charlie Brown sighed. "Well, welcome to the neighborhood, Linus. I'm Charlie Brown."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 2: The Philosophers of the Wall</h2>
                <p class="mb-4">A few days later, Charlie Brown found Linus sitting on the low brick wall that separated their yards. Linus was holding his blanket and looking up at the sky. Charlie Brown climbed up and sat next to him. For a long time, neither of them said anything. They just watched the clouds drift by.</p>
                <p class="mb-4">"Do you ever feel like the world is too big?" Linus asked suddenly. His voice was small, but his words felt heavy. Charlie Brown blinked. Most kids he knew talked about toys or candy. Linus was different. "All the time," Charlie Brown admitted. "Sometimes I feel like I'm invisible. Or worse, like I'm a magnet for bad luck."</p>
                <p class="mb-4">Linus nodded. "I worry about everything," he said. "I worry about school. I worry about the future. I worry that my blanket will shrink in the wash." He squeezed the blue flannel tight. "This blanket makes me feel safe. It’s my security."</p>
                <p class="mb-4">"I have a dog," Charlie Brown offered. "Snoopy. He doesn't listen to me, and sometimes he thinks he's a World War I flying ace, but he's a good listener." Just then, Snoopy trotted by, wearing a pair of aviator goggles. He paused, looked at Linus's blanket, and tried to snatch it. "No!" Linus shouted, pulling it back with surprising strength. "This is essential equipment!" Snoopy shrugged and danced away. Charlie Brown smiled. "I think he likes you, Linus."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 3: The Pitcher's Mound</h2>
                <p class="mb-4">Spring turned into summer, and baseball season arrived. Charlie Brown was the manager and pitcher of the neighborhood team. They weren't very good. In fact, they were terrible. But Charlie Brown never gave up hope. One sunny afternoon, they were short a player. "We need a second baseman!" Charlie Brown shouted. "Schroeder is busy playing his piano, and Pig-Pen is... too dusty."</p>
                <p class="mb-4">He looked over and saw Linus watching from the sidelines, his blanket draped over his shoulder. "Linus!" Charlie Brown called. "Do you want to play?" Linus shook his head. "I don't think so, Charlie Brown. I've never played before. Besides, I can't let go of my blanket."</p>
                <p class="mb-4">"You can use the blanket!" Charlie Brown insisted. "Just stand near second base and try to stop the ball!" Reluctantly, Linus trotted onto the field. The first batter hit a line drive straight toward him. It was moving fast. Charlie Brown covered his eyes. "Oh no," he thought. "He's going to get hurt!"</p>
                <p class="mb-4">But then, *WHAP!* Linus flicked his wrist. The blue blanket snapped out like a whip. It wrapped around the baseball in mid-air, catching it softly. Linus unraveled the blanket and held up the ball. "You're out!" Charlie Brown screamed, jumping up and down. "Did you see that? Linus caught it! He used his blanket!" It was the first time Charlie Brown had felt hope on the baseball field in a long time. Linus smiled a small, shy smile. "It's a versatile fabric," he said.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 4: The Great Pumpkin Debate</h2>
                <p class="mb-4">October arrived, bringing crunchy leaves and chilly winds. All the kids were excited for Halloween. They talked about costumes and candy. But Linus had a different plan. "I'm going to wait in the pumpkin patch," he told Charlie Brown one day at lunch. "I'm waiting for the Great Pumpkin."</p>
                <p class="mb-4">"The who?" Charlie Brown asked, pausing with his sandwich halfway to his mouth. "The Great Pumpkin," Linus explained with bright eyes. "On Halloween night, he rises out of the most sincere pumpkin patch and flies through the air bringing toys to all the good children of the world!"</p>
                <p class="mb-4">Lucy laughed when she heard. "You're crazy, Linus! There's no such thing! You're going to miss trick-or-treating!" Everyone made fun of Linus. Everyone except Charlie Brown. Even though Charlie Brown didn't really believe in the Great Pumpkin, he knew what it felt like to be laughed at. He knew what it felt like to believe in something that no one else did—like believing his team could win a game, or that he could finally kick that football.</p>
                <p class="mb-4">On Halloween night, while the other kids went door-to-door (and Charlie Brown got a bag full of rocks), Linus sat alone in the cold pumpkin patch. Charlie Brown walked by on his way home. He saw his friend shivering. Instead of laughing, Charlie Brown walked into the patch. "Mind if I wait with you for a bit?" he asked. Linus looked up, surprised. "Really? You'd miss the party?" "Parties are overrated," Charlie Brown lied. "Besides, someone has to keep you warm." They sat together under the moon, two friends waiting for something magical.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 5: The Christmas Speech</h2>
                <p class="mb-4">Winter came, and with it, the school Christmas play. Charlie Brown was the director, but everything was going wrong. Snoopy was dancing on the piano, Lucy was yelling at everyone, and the aluminum Christmas tree Charlie Brown had bought was tiny and pathetic. "I ruined it," Charlie Brown shouted, throwing his hands up. "I don't even know what Christmas is all about! Does anyone know?"</p>
                <p class="mb-4">The auditorium went silent. Then, Linus walked to the center of the stage. He dragged his blanket with him. He asked for the spotlight. In a clear, calm voice, Linus recited the story of the first Christmas. He spoke of shepherds and angels and peace on earth. As he said the words "Fear not," he did something he almost never did—he dropped his blanket to the floor.</p>
                <p class="mb-4">When he finished, he picked up his blanket and walked over to Charlie Brown. "That's what Christmas is all about, Charlie Brown." The quiet power of his words changed the mood in the room. The kids stopped fighting. They followed Charlie Brown out into the snow to decorate his little tree. Linus wrapped his blanket around the base of the tree to keep it warm. "It's not a bad little tree," Linus said. "It just needs a little love."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 6: Best Friends Forever</h2>
                <p class="mb-4">Years went by, and the seasons kept turning. Charlie Brown never did get to kick that football (Lucy was too tricky). He never became a famous baseball player. But he realized he had won something much better. He had found a friend who listened to his worries on the brick wall.</p>
                <p class="mb-4">One afternoon, they were leaning on the wall again. "You know, Linus," Charlie Brown said, "I think I'm the most wishy-washy person in the world." Linus shook his head. "You're not wishy-washy, Charlie Brown. You're persistent. You keep trying, even when things go wrong. That takes bravery."</p>
                <p class="mb-4">Charlie Brown smiled. "And you're the smartest person I know, Linus. Even if you do carry a blanket." Linus patted the blue flannel fondly. "We all need something to hold onto, Charlie Brown. I have my blanket. And you..." He looked at his friend. "You have hope."</p>
                <p class="mb-4">Snoopy hopped up onto the wall and sat between them. The sun began to set, painting the sky in shades of orange and pink. "You're a good man, Charlie Brown," Linus said quietly. And for the first time in a long time, Charlie Brown believed it. They sat there together, a boy, a philosopher with a blanket, and a beagle, knowing that no matter how many kite-eating trees or footballs lay ahead, they would face them together.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 shadow-md hidden">
                    Congratulations! Play Snoopy's Word Catcher!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- --- NEW GAME SECTION: Snoopy's Word Catcher --- -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            
            <div id="game-info" class="mb-4 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Snoopy's Word Catcher!</h1>
                <p class="text-gray-600">Catch the <span class="text-green-600 font-bold">GOOD</span> words (friend, hope, brave). Avoid the <span class="text-red-600 font-bold">BAD</span> words (worry, fear, grief)!</p>
            </div>

            <!-- Game Stats -->
            <div class="flex justify-between w-full max-w-xl mb-2 px-4 text-gray-800 game-font text-2xl">
                <div id="score-display">SCORE: 0</div>
                <div id="timer-display">TIME: 60</div>
            </div>

            <!-- Game Canvas -->
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-[4/3] overflow-hidden rounded-lg">
                 <canvas id="game-canvas"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex justify-center space-x-12 w-full mt-6">
                <button id="left-btn" class="control-button">◄</button>
                <button id="right-btn" class="control-button">►</button>
            </div>

            <!-- Game Over Modal -->
            <div id="game-over-modal" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 id="modal-title-text" class="text-3xl font-bold mb-4 text-yellow-700 header-font">Good Grief!</h2>
                    <p id="modal-body-text" class="text-gray-800 text-lg mb-6">Game Over!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- NEW QUIZ DATA (Based on Charlie Brown Story) ---
        const allQuestions = [
            {
                id: 'q1',
                questionText: "Why was Charlie Brown sitting on his porch at the beginning of the story?",
                options: [
                    { value: 'A', text: 'He was waiting for the mailman.' },
                    { value: 'B', text: 'He was feeling sad about losing his kite and the football.' },
                    { value: 'C', text: 'He was eating a sandwich.' },
                    { value: 'D', text: 'He was hiding from Snoopy.' }
                ],
                type: 'radio'
            },
            {
                id: 'q2',
                questionText: "What object does Linus always carry with him?",
                options: [
                    { value: 'A', text: 'A baseball bat.' },
                    { value: 'B', text: 'A toy car.' },
                    { value: 'C', text: 'A blue security blanket.' },
                    { value: 'D', text: 'A comic book.' }
                ],
                type: 'radio'
            },
            {
                id: 'q3',
                questionText: "Where do Charlie Brown and Linus often sit to talk about life?",
                options: [
                    { value: 'A', text: 'On the pitcher\'s mound.' },
                    { value: 'B', text: 'On top of Snoopy\'s doghouse.' },
                    { value: 'C', text: 'On a low brick wall.' },
                    { value: 'D', text: 'Under the apple tree.' }
                ],
                type: 'radio'
            },
            {
                id: 'q4',
                questionText: "How did Linus help the baseball team?",
                options: [
                    { value: 'A', text: 'He hit a home run.' },
                    { value: 'B', text: 'He used his blanket to catch a fast line drive.' },
                    { value: 'C', text: 'He cheered louder than anyone else.' },
                    { value: 'D', text: 'He brought water for everyone.' }
                ],
                type: 'radio'
            },
            {
                id: 'q5',
                questionText: "Who is the 'Great Pumpkin' according to Linus?",
                options: [
                    { value: 'A', text: 'A ghost that scares people.' },
                    { value: 'B', text: 'A magical figure who brings toys to sincere pumpkin patches.' },
                    { value: 'C', text: 'Charlie Brown in a costume.' },
                    { value: 'D', text: 'The name of his favorite pie.' }
                ],
                type: 'radio'
            },
            {
                id: 'q6',
                questionText: "Why did Charlie Brown sit with Linus in the pumpkin patch?",
                options: [
                    { value: 'A', text: 'He wanted to see the Great Pumpkin too.' },
                    { value: 'B', text: 'He was hiding from Lucy.' },
                    { value: 'C', text: 'He didn\'t want Linus to be alone and cold.' },
                    { value: 'D', text: 'He lost his keys in the patch.' }
                ],
                type: 'radio'
            },
            {
                id: 'q7',
                questionText: "What did Linus do during his speech in the Christmas play?",
                options: [
                    { value: 'A', text: 'He danced with Snoopy.' },
                    { value: 'B', text: 'He forgot his lines.' },
                    { value: 'C', text: 'He dropped his blanket to the floor while saying \'Fear not\'.' },
                    { value: 'D', text: 'He sang a loud song.' }
                ],
                type: 'radio'
            },
            {
                id: 'q8',
                questionText: "What did the boys do to fix the tiny Christmas tree?",
                options: [
                    { value: 'A', text: 'They threw it away.' },
                    { value: 'B', text: 'They bought a bigger one.' },
                    { value: 'C', text: 'Linus wrapped his blanket around it, and they decorated it with love.' },
                    { value: 'D', text: 'They painted it green.' }
                ],
                type: 'radio'
            },
            {
                id: 'q9',
                questionText: "What word did Linus use to describe Charlie Brown at the end of the story?",
                options: [
                    { value: 'A', text: 'Wishy-washy' },
                    { value: 'B', text: 'Persistent' },
                    { value: 'C', text: 'Funny' },
                    { value: 'D', text: 'Loud' }
                ],
                type: 'radio'
            },
            {
                id: 'q10',
                questionText: "What is the main theme of this story?",
                options: [
                    { value: 'A', text: 'Winning baseball games is the most important thing.' },
                    { value: 'B', text: 'Halloween is better than Christmas.' },
                    { value: 'C', text: 'True friendship means supporting each other through hard times.' },
                    { value: 'D', text: 'Never trust a dog with goggles.' }
                ],
                type: 'radio'
            }
        ];

        // --- NEW Correct Answers ---
        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "C",
            q4: "B",
            q5: "B",
            q6: "C",
            q7: "C",
            q8: "C",
            q9: "B",
            q10: "C"
        };


        // --- ALL SCRIPTING BELOW THIS LINE IS UNCHANGED ---

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            startGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- SNOOPY'S WORD CATCHER GAME LOGIC ---

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const gameTimerDisplay = document.getElementById('timer-display');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalBodyText = document.getElementById('modal-body-text');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');

        // Game constants
        const playerWidth = 60;
        const playerHeight = 60;
        const gravity = 0; // Not a jumping game
        const wordSpeed = 3;
        
        // Words data
        const goodWords = ["FRIEND", "HOPE", "BRAVE", "KIND", "HELP", "TRUST", "LOVE", "SHARE"];
        const badWords = ["WORRY", "FEAR", "GRIEF", "MEAN", "RUDE", "SAD", "DOUBT", "QUIT"];

        // Game state variables
        let playerX;
        let playerY;
        let fallingWords = [];
        let score = 0;
        let timeLeft = 60;
        let gameLoop;
        let spawnInterval;
        let gameTimerInterval;
        let isMovingLeft = false;
        let isMovingRight = false;

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            playerY = canvas.height - playerHeight - 10;
        }

        // Initialize player position
        function initPlayer() {
            playerX = canvas.width / 2 - playerWidth / 2;
        }

        // Draw Snoopy (simplified as a white box with black ears for now, or text)
        function drawPlayer() {
            // Draw Snoopy-like shape
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth/2, playerY + playerHeight/2, playerWidth/2, playerHeight/3, 0, 0, Math.PI * 2);
            ctx.fill();
            // Ear
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.ellipse(playerX + 20, playerY + playerHeight/2, 10, 15, 0, 0, Math.PI * 2);
            ctx.fill();
            // Nose
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth - 10, playerY + playerHeight/2 - 5, 5, 5, 0, 0, Math.PI * 2);
            ctx.fill();
            // Collar
            ctx.fillStyle = "red";
            ctx.fillRect(playerX + playerWidth/2 - 5, playerY + playerHeight/2 + 10, 10, 5);
        }

        // Spawn a new word
        function spawnWord() {
            const isGood = Math.random() > 0.4; // 60% chance of good word
            const text = isGood ? goodWords[Math.floor(Math.random() * goodWords.length)] : badWords[Math.floor(Math.random() * badWords.length)];
            const x = Math.random() * (canvas.width - 100);
            
            fallingWords.push({
                x: x,
                y: -30,
                text: text,
                isGood: isGood,
                width: ctx.measureText(text).width + 20
            });
        }

        // Update and draw words
        function updateAndDrawWords() {
            ctx.font = "bold 20px 'Inter'";
            
            for (let i = fallingWords.length - 1; i >= 0; i--) {
                let word = fallingWords[i];
                word.y += wordSpeed;

                // Draw word background
                ctx.fillStyle = word.isGood ? "#dcfce7" : "#fee2e2";
                ctx.strokeStyle = word.isGood ? "#16a34a" : "#dc2626";
                ctx.lineWidth = 2;
                
                const textWidth = ctx.measureText(word.text).width;
                const boxWidth = textWidth + 20;
                const boxHeight = 30;
                
                ctx.fillRect(word.x, word.y - 20, boxWidth, boxHeight);
                ctx.strokeRect(word.x, word.y - 20, boxWidth, boxHeight);

                // Draw text
                ctx.fillStyle = word.isGood ? "#166534" : "#991b1b";
                ctx.fillText(word.text, word.x + 10, word.y);

                // Collision detection
                if (
                    playerX < word.x + boxWidth &&
                    playerX + playerWidth > word.x &&
                    playerY < word.y + boxHeight &&
                    playerY + playerHeight > word.y - 20
                ) {
                    // Collision!
                    if (word.isGood) {
                        score += 10;
                    } else {
                        score -= 5;
                    }
                    scoreDisplay.textContent = `SCORE: ${score}`;
                    fallingWords.splice(i, 1); // Remove word
                    continue;
                }

                // Remove if off screen
                if (word.y > canvas.height) {
                    fallingWords.splice(i, 1);
                }
            }
        }

        // Main game loop
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear sky
            
            // Draw grass
            ctx.fillStyle = '#4ade80';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

            // Move player
            if (isMovingLeft && playerX > 0) playerX -= 5;
            if (isMovingRight && playerX < canvas.width - playerWidth) playerX += 5;

            drawPlayer();
            updateAndDrawWords();
        }

        // End the game
        function endGame() {
            clearInterval(gameLoop);
            clearInterval(spawnInterval);
            clearInterval(gameTimerInterval);
            
            modalTitleText.textContent = score >= 50 ? "Good Grief!" : "Keep Trying!";
            modalBodyText.textContent = `Time's up! You scored ${score} points!`;
            if (score >= 50) {
                modalBodyText.textContent += " That's some great reading!";
            }
            gameOverModal.classList.remove('hidden');
        }

        // Start a new game
        function startGame() {
            // Reset state
            if (gameLoop) clearInterval(gameLoop);
            if (spawnInterval) clearInterval(spawnInterval);
            if (gameTimerInterval) clearInterval(gameTimerInterval);

            resizeCanvas();
            initPlayer();
            fallingWords = [];
            score = 0;
            timeLeft = 60;
            
            scoreDisplay.textContent = `SCORE: 0`;
            gameTimerDisplay.textContent = `TIME: 60`;
            gameOverModal.classList.add('hidden');

            // Start intervals
            gameLoop = setInterval(updateGame, 1000 / 60); // 60 FPS
            spawnInterval = setInterval(spawnWord, 1500); // New word every 1.5s
            
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                gameTimerDisplay.textContent = `TIME: ${timeLeft}`;
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // Handle keyboard input
        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = true;
            if (e.code === 'ArrowRight') isMovingRight = true;
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = false;
            if (e.code === 'ArrowRight') isMovingRight = false;
        });
        
        // Handle mobile button input
        leftBtn.addEventListener('mousedown', () => isMovingLeft = true);
        leftBtn.addEventListener('mouseup', () => isMovingLeft = false);
        leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingLeft = true; });
        leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingLeft = false; });

        rightBtn.addEventListener('mousedown', () => isMovingRight = true);
        rightBtn.addEventListener('mouseup', () => isMovingRight = false);
        rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingRight = true; });
        rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingRight = false; });

        playAgainBtn.addEventListener('click', startGame);

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameLoop) {
                    resizeCanvas();
                    initPlayer(); // Recenter player on resize just in case
                }
            });
        });
    </script>
</body>

</html>
