<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Man: A Tale of Two Kitties Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* New Game Styles */
        #game-canvas {
            background-color: #e0f2fe; /* Light blue sky */
            border: 4px solid #0284c7; /* Sky blue border */
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: grid !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="./Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Dog Man: A Tale of Two Kitties</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: The Clone and the Kitties</h2>

                <p class="mb-4">Our story, once again created by the comic geniuses George and Harold, begins with our hero, Dog Man, doing what he does best: being a very good boy and a very bad kitty's worst nightmare. After being celebrated for saving the city from an army of evil words, Dog Man was back on the job, sniffing out crime and accidentally chewing on the Chief’s furniture. Life seemed pretty normal, but not for long. In the darkest corner of cat jail, the world's most evil cat, Petey, was hatching a brand new plan. He was tired of being defeated all by himself. "What I need is a partner!" he declared. "An evil sidekick who is just as clever and wicked as I am. I need... another me!"</p>
                <p class="mb-6">So, Petey put his giant brain to work. Using a collection of smuggled spare parts, including a watch, a toaster, and a roll of toilet paper, he built a magnificent machine: the Clone-a-Tron 2000. This machine could create a perfect copy of anything. Petey cackled with glee as he stepped inside, setting the dial to "EVIL." He pushed the big red button, and the machine whirred and zapped. But just at that moment, a guard walked by, and Petey, in his haste, accidentally bumped the "EVIL" switch. The machine sputtered, the lights flickered, and when the smoke cleared, standing beside Petey was not an evil, snarling copy of himself, but a tiny, adorable, wide-eyed kitten. The clone was a total failure! Or was it?</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The World's Cutest Problem</h3>

                <p class="mb-4">Petey was furious. "You're supposed to be my evil twin!" he yelled. The kitten just blinked its big, innocent eyes and said, "Hewwo, Papa!" Petey couldn't believe it. This little kitten, who he quickly named Li'l Petey, was nothing like him. Li'l Petey was sweet, kind, and loved to play. He thought Petey was his father and followed him everywhere, asking endless questions and wanting to play patty-cake. Petey tried his best to teach his new clone the ways of evil. He gave him lessons on how to build death rays and how to cackle maniacally. But Li'l Petey just wasn't interested. He'd rather draw pictures of rainbows and hug Dog Man, who he thought was the coolest hero ever.</p>
                <p class="mb-6">Meanwhile, Dog Man was facing a new kind of problem. A mysterious villain was committing crimes all over the city. But this villain was strange; he was completely flat! It was Flat Petey, a paper-thin drawing of Petey from a previous adventure who had been accidentally brought to life. Flat Petey was tired of being a second-rate villain. He wanted to prove that he was even more evil than the real Petey. He started with small crimes, like stealing all the hot dogs from Philly's stand and replacing them with broccoli. The city was confused, but Dog Man, with his super sniffer, was on the case, even if he did stop to chase a few squirrels along the way.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Petey's Big Plan</h3>

                <p class="mb-4">While Dog Man was busy dealing with the paper-thin pest, the real Petey had escaped cat jail with his new, unwanted sidekick. He had a new, bigger, and much more stompy plan. He built a pair of gigantic, skyscraper-sized robot pants called the "Robo-Pants 2000." His plan was to use these giant pants to stomp all over the city, crushing buildings and causing chaos until everyone declared him the new king. He climbed into the cockpit at the top of the pants, dragging a very nervous Li'l Petey with him. "Behold, my son!" Petey announced. "This is how true evil works! Soon, this whole city will be ours!"</p>
                <p class="mb-6">The Robo-Pants stomped through the streets, sending cars flying and people running in fear. CRUNCH! STOMP! The police force was helpless against the giant trousers. Dog Man arrived on the scene, ready for a fight. He barked bravely at the giant metal legs, but they were just too big. The pants kicked Dog Man and sent him flying into a giant donut sign. It looked like Petey was finally going to win. From inside the cockpit, Li'l Petey watched in horror. "Papa, no!" he cried. "This is wrong! Being a bully isn't fun!" But Petey was too busy enjoying his evil victory to listen.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Flat-Out Complication</h3>

                <p class="mb-4">Just then, Flat Petey showed up, and he was not happy. He flew his paper airplane into the cockpit of the Robo-Pants. "I'm the main villain around here!" he squeaked in his high-pitched paper voice. He and the real Petey started to argue. "No, I'm the main villain!" shouted Petey. "No, I am!" insisted Flat Petey. While they were bickering, Flat Petey accidentally knocked over a bottle of "Living Spray." The spray went everywhere, and it landed on a nearby bowl of soup. The soup bubbled and churned, and a giant, living tidal wave of hot soup rose from the bowl. It was a Supa-Soup Monster!</p>
                <p class="mb-6">The Supa-Soup Monster sloshed through the streets, melting everything it touched. Now Dog Man had two giant problems to deal with! The Robo-Pants were still stomping, and the hot soup monster was dissolving the city. Thinking fast, Dog Man remembered something important about soup: it needs to be eaten with a spoon. He raced to the city museum, which had a giant silver spoon on display as a piece of art. He grabbed the giant spoon and used it to scoop up the hot soup monster, flinging it far away into the ocean where it could cool down and become regular, non-monster soup again.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Change of Heart</h3>

                <p class="mb-4">With the soup gone, it was back to the pants. Inside the cockpit, the fighting between the two Peteys got worse. During their struggle, Li'l Petey was knocked out of the cockpit and was left hanging from the giant robot's knee, hundreds of feet in the air! "Papa, help me!" he cried. Petey looked down and saw his little clone, his son, in terrible danger. For the first time, Petey felt something other than evil. He felt scared. He didn't care about crushing the city anymore. He only cared about saving Li'l Petey.</p>
                <p class="mb-6">Petey used a claw arm on the Robo-Pants to gently grab Li'l Petey and bring him back to safety. "Are you okay?" Petey asked, hugging the little kitten. At that moment, he realized that he loved Li'l Petey more than he loved being evil. While Petey was distracted, Dog Man saw his chance. He climbed up the giant legs of the Robo-Pants. He found the main power button, which was conveniently labeled "OFF," and pressed it with his nose. The giant pants powered down and tipped over, crashing harmlessly in a park.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Two Kitties, One Family</h3>
                
                <p class="mb-4">The day was saved! Dog Man had defeated both a soup monster and a pair of giant robot pants. The Chief arrived and arrested both Peteys. "It's back to cat jail for you two!" he yelled. As they were being led away, Li'l Petey ran up to his papa. "I love you, Papa," he said, giving Petey a big hug. Petey looked at the little kitten and smiled a real, genuine smile. "I love you too, son," he said.</p>
                <p class="mb-6">Back in their jail cell, things were different. Petey wasn't plotting evil schemes anymore. He was reading bedtime stories to Li'l Petey and teaching him how to draw. He was becoming a real dad. The story ends with Dog Man looking at a picture Li'l Petey had drawn for him. It was a drawing of Dog Man, Petey, and Li'l Petey all smiling together like a family. It truly was a tale of two kitties: one who was born good, and one who was learning that maybe, just maybe, being good wasn't so bad after all, especially when you have someone to love.</p>
            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Play the Chase Game!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section (Dog Man Chase) -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Dog Man Chase!</h1>
                <p class="text-gray-600">Use the arrow keys or buttons to help Dog Man catch Petey! Dodge the bombs!</p>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                 <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>
            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden grid grid-cols-3 gap-2 w-48 mt-6">
                <div></div> <!-- Top-left empty -->
                <button id="up-btn" class="control-button w-full">▲</button>
                <div></div> <!-- Top-right empty -->
                
                <button id="left-btn" class="control-button w-full">◀</button>
                <div></div> <!-- Middle-center empty -->
                <button id="right-btn" class="control-button w-full">▶</button>
                
                <div></div> <!-- Bottom-left empty -->
                <button id="down-btn" class="control-button w-full">▼</button>
                <div></div> <!-- Bottom-right empty -->
            </div>


            <div id="win-message" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 class="text-3xl font-bold mb-4 text-yellow-700 header-font">You Caught Petey!</h2>
                    <p class="text-gray-800 text-lg mb-6">Great job, hero!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data
        const allQuestions = [{
            id: 'q1',
            questionText: 'Why did Petey decide to build the Clone-a-Tron 2000?',
            options: [{ value: 'A', text: 'He wanted a new pet.' }, { value: 'B', text: 'He was lonely in cat jail.' }, { value: 'C', text: 'He wanted an evil sidekick exactly like him.' }, { value: 'D', text: 'He wanted to make a good version of himself.' }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What was the result of Petey\'s cloning experiment?',
            options: [{ value: 'A', text: 'It created an evil monster.' }, { value: 'B', text: 'It created a tiny, adorable kitten.' }, { value: 'C', text: 'The machine exploded.' }, { value: 'D', text: 'It made a perfect, evil copy of Petey.' }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'What is the name of Petey\'s kitten clone?',
            options: [{ value: 'A', text: 'Petey Jr.' }, { value: 'B', text: 'Cat Man' }, { value: 'C', text: 'Li\'l Petey' }, { value: 'D', text: 'Tiny Cat' }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'What was Petey\'s giant evil invention that he used to stomp the city?',
            options: [{ value: 'A', text: 'The Robo-Glove 2000' }, { value: 'B', text: 'The Robo-Pants 2000' }, { value: 'C', text: 'The Stompy-Bot 5000' }, { value: 'D', text: 'A giant vacuum cleaner' }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'Who is the paper-thin villain that causes trouble in the story?',
            options: [{ value: 'A', text: 'Paper Man' }, { value: 'B', text: 'Flat Stanley' }, { value: 'C', text: 'Origami Cat' }, { value: 'D', text: 'Flat Petey' }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What monster was accidentally created when the Living Spray spilled on a bowl of soup?',
            options: [{ value: 'A', text: 'A Supa-Soup Monster' }, { value: 'B', text: 'A Noodle Nightmare' }, { value: 'C', text: 'The Cracker Creature' }, { value: 'D', text: 'A Hot Dog Weenie Monster' }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'How did Dog Man defeat the Supa-Soup Monster?',
            options: [{ value: 'A', text: 'He froze it with a freeze ray.' }, { value: 'B', text: 'He used a giant spoon to fling it into the ocean.' }, { value: 'C', text: 'He drank the whole thing.' }, { value: 'D', text: 'He built a giant robot to fight it.' }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'What event caused Petey to have a change of heart and stop his evil plan?',
            options: [{ value: 'A', text: 'Dog Man convinced him to be good.' }, { value: 'B', text: 'He realized Li\'l Petey was in danger.' }, { value: 'C', text: 'The Robo-Pants ran out of batteries.' }, { value: 'D', text: 'The Chief offered him a peace treaty.' }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'How does Petey\'s relationship with Li\'l Petey change at the end of the book?',
            options: [{ value: 'A', text: 'He decides to abandon Li\'l Petey.' }, { value: 'B', text: 'He finally teaches Li\'l Petey to be evil.' }, { value: 'C', text: 'He starts acting like a real, caring father.' }, { value: 'D', text: 'He sends Li\'l Petey to live with Dog Man.' }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'The title is "A Tale of Two Kitties." Who are the two kitties?',
            options: [{ value: 'A', text: 'Dog Man and the Chief' }, { value: 'B', text: 'Petey and Flat Petey' }, { value: 'C', text: 'Petey and Li\'l Petey' }, { value: 'D', text: 'George and Harold' }],
            type: 'radio'
        }];

        const correctAnswers = {
            q1: "C",
            q2: "B",
            q3: "C",
            q4: "B",
            q5: "D",
            q6: "A",
            q7: "B",
            q8: "B",
            q9: "C",
            q10: "C"
        };

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- DOG MAN CHASE GAME LOGIC ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const winMessage = document.getElementById('win-message');
        const playAgainBtn = document.getElementById('playAgainBtn');

        let isGameActive = false;
        let animationFrameId;
        const keys = {};

        const player = { x: 0, y: 0, width: 40, height: 40, speed: 4, symbol: '🐶' };
        const petey = { x: 0, y: 0, width: 40, height: 40, speed: 2, symbol: '🐱' };
        const obstacles = [];
        const obstacleSize = 20;
        let peteyThrowInterval;

        function resetGame() {
            // Stop any active game processes
            isGameActive = false;
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            clearInterval(peteyThrowInterval);

            // Hide win message and clear obstacles
            winMessage.classList.add('hidden');
            obstacles.length = 0;

            // Set initial positions for drawing during countdown
            player.x = 50;
            player.y = canvas.height / 2 - player.height / 2;
            petey.x = canvas.width - 50 - petey.width;
            petey.y = canvas.height / 2 - petey.height / 2;

            function drawStaticFrame() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#65a30d'; // Grassy green
                ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
                ctx.font = '40px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
                ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            }

            function drawCountdownText(text) {
                drawStaticFrame(); // Draw the background first
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.font = 'bold 96px Bangers, cursive';
                ctx.fillStyle = '#ffffff';
                ctx.strokeStyle = '#27272a';
                ctx.lineWidth = 6;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeText(text, canvas.width / 2, canvas.height / 2);
                ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            }

            let count = 3;
            drawCountdownText(count); // Draw initial "3"

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    drawCountdownText(count);
                } else if (count === 0) {
                    drawCountdownText('GO!');
                } else {
                    clearInterval(countdownInterval);
                    // --- START THE ACTUAL GAME ---
                    isGameActive = true;
                    if (!animationFrameId) {
                        gameLoop();
                    }
                    peteyThrowInterval = setInterval(() => {
                        if (!isGameActive) return;
                        obstacles.push({
                            x: petey.x,
                            y: petey.y + petey.height / 2,
                            width: obstacleSize,
                            height: obstacleSize,
                            speed: 5,
                            symbol: '💣'
                        });
                    }, 1200);
                }
            }, 1000);
        }
        
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function gameLoop() {
            if (!isGameActive) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                return;
            }

            // Update player position
            if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
            if (keys['ArrowDown'] && player.y < canvas.height - player.height) player.y += player.speed;
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;

            // Update Petey's position (simple AI)
            if (player.y < petey.y && petey.y > 0) {
                petey.y -= petey.speed;
            } else if (player.y > petey.y && petey.y < canvas.height - petey.height) {
                petey.y += petey.speed;
            }

            // Update obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.x -= obstacle.speed;
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1); // Remove obstacle if it's off-screen
                }
            }

            // Check for collisions
            // 1. Dog Man hits a bomb
            for (const obstacle of obstacles) {
                if (checkCollision(player, obstacle)) {
                    resetGame(); // Restart the game
                    return; // Exit loop for this frame
                }
            }
            // 2. Dog Man catches Petey
            if (checkCollision(player, petey)) {
                isGameActive = false;
                winMessage.classList.remove('hidden');
            }

            // --- DRAW EVERYTHING ---
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw ground
            ctx.fillStyle = '#65a30d'; // Grassy green
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // Draw characters and obstacles
            ctx.font = '40px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
            ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            
            ctx.font = '20px sans-serif';
            obstacles.forEach(obstacle => {
                 ctx.fillText(obstacle.symbol, obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2);
            });


            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // --- EVENT LISTENERS FOR GAME ---
        document.addEventListener('keydown', e => {
             if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
        });
        document.addEventListener('keyup', e => { keys[e.key] = false; });
        
        playAgainBtn.addEventListener('click', resetGame);

        // Mobile Controls
        const controlButtons = {
            'up-btn': 'ArrowUp', 'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft', 'right-btn': 'ArrowRight'
        };

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            const key = controlButtons[id];
            btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mouseleave', (e) => { keys[key] = false; });
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            const size = container.clientWidth;
            canvas.width = size;
            canvas.height = size;
            if (isGameActive) {
                resetGame();
            }
        }

        function initGame() {
            resizeCanvas();
            resetGame();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', resizeCanvas);
        });
    </script>
</body>

</html>

