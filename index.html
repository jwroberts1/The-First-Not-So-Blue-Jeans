<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Story of the Mad World of Pandora Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* Styles for the Vault Hunter's game */
        #game-canvas {
            background-color: #333;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        #game-info {
            background-color: #222;
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #555;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(34, 34, 34, 0.95);
            padding: 2.5rem;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            text-align: center;
            z-index: 1000;
            border-radius: 15px;
        }

        .message-box button {
            background-color: #f59e0b;
            color: #1a1a1a;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .message-box button:hover {
            background-color: #d97706;
            transform: scale(1.05);
        }

        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent;
            /* Removes blue highlight on tap */
        }

        /* Media query to show controls on screens smaller than large desktops */
        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Story of the Mad World of Pandora Quiz</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: The Vault of the Destroyer - A Full Account</h2>
                
                <p class="mb-6">The adventure begins not with a grand entrance, but with a battered bus pulling up to the desolate landscape of a world known only as Pandora. This rugged, frontier planet is home to the four strangers, the Vault Hunters: a collection of mercenaries, soldiers, and Sirens drawn by the same impossible legend—the existence of a mythical Vault. This Vault is rumored to contain unimaginable caches of alien technology and wealth left behind by the Eridians, an ancient, vanished race.</p>

                <p class="mb-6">As soon as they step off the bus, their quest is guided by a mysterious, ethereal woman. She calls herself the Guardian Angel, and she speaks to them telepathically through the planet’s communication network, the ECHOnet. She is the first to confirm the legend, insisting that the Vault is real, but to open it, they must first assemble the fragmented Vault Key. This key, she explains, is not a simple lock-and-tumbler device, but a complex relic scattered across the planet and often guarded by the worst elements Pandora has to offer.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Desperate Key Hunt</h3>

                <p class="mb-4">The first obstacle is the local population. Pandora is infested with brutal bandits and powerful, self-appointed warlords who control the few remaining civilized areas. These warlords, men like the bloodthirsty Sledge, who controls a local iron mine, and the maniacal Baron Flynt, who rules the frigid northern territories, hold pieces of the fragmented Key. The Vault Hunters must track down and eliminate these local tyrants, fighting through camps of psycho bandits and vicious wildlife like the Skags and Rakk.</p>

                <p class="mb-4">The constant assistance in this hunt comes from a small, rolling robot known as Claptrap. Though he is often more annoying than helpful, this chatty, wheeled companion is responsible for handing out mission objectives, unlocking new travel routes, and providing the Vault Hunters with vital, if sometimes irritating, information. His presence grounds the Hunters in the chaos of Pandora's few remaining hubs, such as Fyrestone, the first settlement they encounter.</p>

                <p class="mb-6">As they gather the early fragments, a far more organized threat emerges: the Crimson Lance. This is the highly-trained, heavily-armed private military of the Atlas Corporation, one of the powerful mega-corporations from the core systems. The Atlas Corporation is not interested in legends; they are interested in property and profit. They view the Vault Hunters not as heroes, but as trespassers and competitors who must be eliminated so that Atlas can seize the alien technology for themselves. This corporate army soon becomes a much greater challenge than the scattered bandit gangs, turning the mission into a full-scale corporate espionage and war campaign.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Vault’s True Nature</h3>

                <p class="mb-4">The Vault Hunters encounter a crucial ally in the form of Dr. Patricia Tannis, a brilliant, if eccentric, scientist obsessed with Eridian culture. Tannis provides the intellectual framework for the Hunters’ search. She explains that the Eridian technology is unlike anything known to man, and she warns that the Key is not merely a tool for opening a door; it is an artifact of immense, unknown power.</p>

                <p class="mb-4">Tannis is the one who ultimately directs them to the key fragments held by the higher ranks of the Crimson Lance. This leads to intense battles across vast, derelict landscapes, culminating in the Hunters preparing for their final confrontation against the full might of the Atlas military.</p>

                <p class="mb-6">The hunt eventually brings the Vault Hunters face-to-face with the leader of the Crimson Lance on Pandora, Commandant Steele. Steele, acting on behalf of the Atlas Corporation, has successfully beaten the Hunters to the final fragments and is preparing to assemble the entire Vault Key herself. The Hunters must infiltrate the heavily fortified Crimson Lance central base, Tartarus Station, which is situated near the final location of the Vault.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Climax: The Destroyer</h3>

                <p class="mb-4">In a moment of dramatic betrayal, the Commandant manages to complete the Key and activate the Vault's mechanism. The true horror of the Vault is then revealed. It does not swing open to reveal riches, gold, or ancient Eridian weapons. Instead, it unleashes a devastating surge of energy, and the Guardian Angel’s cryptic instructions suddenly make terrible sense.</p>

                <p class="mb-4">The Vault was never a treasury. It was a prison. What emerges from the blinding light is not treasure, but the massive, terrifying alien monster known as the Eridian Destroyer. This creature, a truly ancient and terrifying organism, is a being of immense, catastrophic power. Its release threatens to end not just the quest for the Vault, but all life on Pandora.</p>

                <p class="mb-4">Commandant Steele, the human agent who succeeded in opening the prison, is instantly vaporized by the creature's fury, a stark demonstration of the Destroyer’s raw power. The Vault Hunters, initially motivated by profit, now realize the immense responsibility thrust upon them. They are the only ones who can stop this catastrophic creature.</p>

                <p class="mb-6">The ensuing battle is epic, demanding every ounce of the Vault Hunters' skill and weaponry. They work together, utilizing their unique abilities and arsenal to finally bring down the colossal Vault Monster. Once the creature is defeated, the victory is bittersweet. The massive alien organism does not leave a corpse; instead, the Vault, now quiet, begins the slow, powerful process of closing again, sealing the Destroyer away into its alien tomb.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Beginning</h3>

                <p class="mb-4">The Vault Hunters, having survived the impossible, stand victorious but empty-handed. The fortune they sought remains elusive, but they now hold something far more valuable: knowledge. They understand that the Vaults exist, that they are tied to a vast, interstellar network of alien secrets, and that the promise of true Eridian treasure is still out there, locked away on other planets or waiting to be found in other sealed locations on Pandora.</p>

                <p class="mb-4">The tale ends not with a final reward, but with a promise of the next great adventure. The Vault Hunters have secured Pandora, but they know that the major corporations, including the now-informed Atlas, and even newer, more sinister threats (which they do not yet know about), will soon return to claim the planet’s secrets. Their journey is far from over, and the pursuit of the next Vault begins now.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Check out your reward
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-900 rounded-lg shadow-2xl" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-white bg-gray-800 p-4 rounded-xl border-2 border-yellow-400">
                <h1 class="text-3xl font-bold mb-2 game-font">Vault Hunter's Treasure</h1>
                <p class="text-gray-300">Use the arrow keys to move and the <strong class="text-yellow-400">E key</strong> to investigate for key fragments!</p>
                <div class="mt-4 text-xl">
                    Key Fragments Found: <span id="foundCount" class="font-bold text-yellow-400">0</span> / 3
                </div>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex-col items-center mt-6 w-full">
                <div class="grid grid-cols-3 gap-2 w-48">
                    <div class="col-span-1"></div>
                    <button id="up-btn" class="control-button">▲</button>
                    <div class="col-span-1"></div>
                    <button id="left-btn" class="control-button">◀</button>
                    <div class="col-span-1"></div>
                    <button id="right-btn" class="control-button">▶</button>
                    <div class="col-span-1"></div>
                    <button id="down-btn" class="control-button">▼</button>
                    <div class="col-span-1"></div>
                </div>
                <button id="investigateBtn" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full mt-6 hover:bg-yellow-500 transition duration-300 w-48">
                    Investigate
                </button>
            </div>

            <div id="end-game-message" class="message-box hidden text-white">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4">Congratulations, Vault Hunter!</h2>
                <div id="completed-key-container" class="mb-6 flex justify-center"></div>
                <p class="mb-6 text-lg sm:text-xl">You have successfully completed the vault key. What knowledge will you seek?</p>
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data
        const allQuestions = [{
            id: 'q1',
            questionText: 'What is the main goal of the Vault Hunters when they arrive on Pandora?',
            options: [{
                value: 'A',
                text: 'To join the Crimson Lance'
            }, {
                value: 'B',
                text: 'To find the mythical Vault'
            }, {
                value: 'C',
                text: 'To build a peaceful colony'
            }, {
                value: 'D',
                text: 'To defeat Claptrap'
            }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'Which mysterious character guides the Vault Hunters by speaking to them through the ECHOnet?',
            options: [{
                value: 'A',
                text: 'Claptrap'
            }, {
                value: 'B',
                text: 'Commandant Steele'
            }, {
                value: 'C',
                text: 'The Guardian Angel'
            }, {
                value: 'D',
                text: 'Baron Flynt'
            }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'What powerful corporation\'s private army, the Crimson Lance, opposes the Vault Hunters?',
            options: [{
                value: 'A',
                text: 'Hyperion'
            }, {
                value: 'B',
                text: 'Maliwan'
            }, {
                value: 'C',
                text: 'Dahl'
            }, {
                value: 'D',
                text: 'Atlas'
            }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'What object must the Vault Hunters piece together to open the Vault?',
            options: [{
                value: 'A',
                text: 'The Golden Pistol'
            }, {
                value: 'B',
                text: 'The Vault Key'
            }, {
                value: 'C',
                text: 'The Eridian Map'
            }, {
                value: 'D',
                text: 'Claptrap\'s Manual'
            }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'Which notorious bandit warlord is mentioned as a major obstacle in the story?',
            options: [{
                value: 'A',
                text: 'Handsome Jack'
            }, {
                value: 'B',
                text: 'Commandant Steele'
            }, {
                value: 'C',
                text: 'Sledge'
            }, {
                value: 'D',
                text: 'Tannis'
            }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What is the major surprise when the Vault is finally opened?',
            options: [{
                value: 'A',
                text: 'It is empty'
            }, {
                value: 'B',
                text: 'It contains a giant alien monster'
            }, {
                value: 'C',
                text: 'It is a portal to another galaxy'
            }, {
                value: 'D',
                text: 'It is a massive pile of gold'
            }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'Who is the leader of the Atlas corporation\'s army, the Crimson Lance, who tries to stop the Vault Hunters?',
            options: [{
                value: 'A',
                text: 'General Knoxx'
            }, {
                value: 'B',
                text: 'Commandant Steele'
            }, {
                value: 'C',
                text: 'Moxxi'
            }, {
                value: 'D',
                text: 'Angel'
            }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'What happens immediately after the Vault Monster is defeated and the Vault is opened?',
            options: [{
                value: 'A',
                text: 'Pandora is destroyed'
            }, {
                value: 'B',
                text: 'The Vault closes again'
            }, {
                value: 'C',
                text: 'The Vault Hunters become emperors'
            }, {
                value: 'D',
                text: 'The Vault starts raining candy'
            }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'Which device is used by the Guardian Angel to communicate with the Vault Hunters across Pandora?',
            options: [{
                value: 'A',
                text: 'A walkie-talkie'
            }, {
                value: 'B',
                text: 'The ECHOnet'
            }, {
                value: 'C',
                text: 'A personal computer'
            }, {
                value: 'D',
                text: 'Smoke signals'
            }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'What is the alien monster sealed inside the Vault often referred to as?',
            options: [{
                value: 'A',
                text: 'A Skag Lord'
            }, {
                value: 'B',
                text: 'The Eridian Destroyer'
            }, {
                value: 'C',
                text: 'The Siren Queen'
            }, {
                value: 'D',
                text: 'The Ancient Claptrap'
            }],
            type: 'radio'
        }];

        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "D",
            q4: "B",
            q5: "C",
            q6: "B",
            q7: "B",
            q8: "B",
            q9: "B",
            q10: "B"
        };

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');
        const investigateBtn = document.getElementById('investigateBtn');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box flex flex-col items-center';
            messageBox.innerHTML = `
                <p class="text-white text-lg sm:text-xl mb-4">${message}</p>
                <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // Game Logic for Vault Hunter's Treasure
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const foundCountEl = document.getElementById('foundCount');
        const messageBox = document.getElementById('end-game-message');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const completedKeyContainer = document.getElementById('completed-key-container');
        const upBtn = document.getElementById('up-btn');
        const downBtn = document.getElementById('down-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const hunterSize = 50;
        let hunterX, hunterY;
        const speed = 5;
        let foundKeys = 0;
        let isGameActive = false;
        let animationFrameId;

        const hunterSymbol = '🤠';
        const keyFragmentImages = [];
        let objects = [];
        const numObjects = 10;
        const objectSymbols = ['📦', '💰', '🛡️', '⚙️', '💎', '🧪'];

        const keys = {};

        // SVG functions
        function createDiamondFragmentSVG(fragmentIndex) {
            const svgWidth = 50;
            const svgHeight = 50;
            let svgPath = '';
            if (fragmentIndex === 0) {
                svgPath = `M${svgWidth / 2},0 L0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth},${svgHeight / 2} Z`;
            } else if (fragmentIndex === 1) {
                svgPath = `M0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L0,${svgHeight} Z`;
            } else if (fragmentIndex === 2) {
                svgPath = `M${svgWidth},${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L${svgWidth},${svgHeight} Z`;
            }
            return `<svg xmlns="http://www.w3.org/2000/svg" width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
                        <path d="${svgPath}" fill="#a855f7" stroke="#8b5cf6" stroke-width="2" />
                    </svg>`;
        }

        function createCompletedDiamondSVG() {
            return `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                        <path d="M50,0 L0,50 L50,100 L100,50 Z" fill="#a855f7" stroke="#8b5cf6" stroke-width="4" />
                    </svg>`;
        }

        function preloadKeyFragments() {
            for (let i = 0; i < 3; i++) {
                const keyFragImage = new Image();
                const svgString = createDiamondFragmentSVG(i);
                keyFragImage.src = 'data:image/svg+xml;base64,' + btoa(svgString);
                keyFragmentImages.push(keyFragImage);
            }
        }

        function showGameMessage() {
            completedKeyContainer.innerHTML = createCompletedDiamondSVG();
            messageBox.classList.remove('hidden');
        }

        function hideGameMessage() {
            messageBox.classList.add('hidden');
        }

        // Game state and object creation
        function createObjects() {
            objects = [];
            const keyLocations = new Set();
            while (keyLocations.size < 3) {
                keyLocations.add(Math.floor(Math.random() * numObjects));
            }

            for (let i = 0; i < numObjects; i++) {
                let x, y;
                let overlap;
                do {
                    overlap = false;
                    x = Math.random() * (canvas.width - 50);
                    y = Math.random() * (canvas.height - 50);

                    for (const obj of objects) {
                        const dist = Math.sqrt(Math.pow(x - obj.x, 2) + Math.pow(y - obj.y, 2));
                        if (dist < 100) {
                            overlap = true;
                            break;
                        }
                    }
                } while (overlap);

                objects.push({
                    x: x,
                    y: y,
                    isKey: keyLocations.has(i),
                    isFound: false,
                    symbol: objectSymbols[Math.floor(Math.random() * objectSymbols.length)]
                });
            }
        }

        function resetGame() {
            foundKeys = 0;
            foundCountEl.textContent = foundKeys;
            hunterX = canvas.width / 2 - hunterSize / 2;
            hunterY = canvas.height / 2 - hunterSize / 2;
            hideGameMessage();
            createObjects();
            isGameActive = true;
            if (!animationFrameId) {
                gameLoop();
            }
        }

        // Game drawing logic
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            objects.forEach(obj => {
                ctx.save();
                ctx.translate(obj.x, obj.y);
                if (obj.isFound) {
                    const foundKeyCount = objects.filter(o => o.isFound).length;
                    const fragIndex = obj.isKey ? objects.filter(o => o.isKey).indexOf(obj) : -1;
                    if (fragIndex !== -1 && keyFragmentImages[fragIndex]?.complete) {
                        ctx.drawImage(keyFragmentImages[fragIndex], 0, 0, 50, 50);
                    }
                } else {
                    ctx.font = '40px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(obj.symbol, 25, 25);
                }
                ctx.restore();
            });

            ctx.font = '50px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(hunterSymbol, hunterX + hunterSize / 2, hunterY + hunterSize / 2);
        }

        // Game logic
        function investigate() {
            if (!isGameActive) return;
            let foundSomething = false;
            objects.forEach(obj => {
                if (!obj.isFound &&
                    hunterX < obj.x + 50 &&
                    hunterX + hunterSize > obj.x &&
                    hunterY < obj.y + 50 &&
                    hunterY + hunterSize > obj.y) {
                    if (obj.isKey) {
                        obj.isFound = true;
                        foundKeys++;
                        foundSomething = true;
                        foundCountEl.textContent = foundKeys;
                        if (foundKeys === 3) {
                            showGameMessage();
                            isGameActive = false;
                        }
                    }
                }
            });
            draw();
        }

        function gameLoop() {
            if (!isGameActive) return;

            if (keys['ArrowUp']) hunterY -= speed;
            if (keys['ArrowDown']) hunterY += speed;
            if (keys['ArrowLeft']) hunterX -= speed;
            if (keys['ArrowRight']) hunterX += speed;

            hunterX = Math.max(0, Math.min(canvas.width - hunterSize, hunterX));
            hunterY = Math.max(0, Math.min(canvas.height - hunterSize, hunterY));

            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Event Listeners for game
        document.addEventListener('keydown', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
            if (e.key.toLowerCase() === 'e' || e.key === ' ') {
                investigate();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        // Touch/Mouse event listeners for new buttons
        const controlButtons = {
            'up-btn': 'ArrowUp',
            'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft',
            'right-btn': 'ArrowRight'
        };

        function startMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = true;
        }

        function stopMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = false;
        }

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('mousedown', startMovement);
            btn.addEventListener('mouseup', stopMovement);
            btn.addEventListener('mouseleave', stopMovement); // Prevents movement from getting stuck if cursor moves off button
            btn.addEventListener('touchstart', startMovement);
            btn.addEventListener('touchend', stopMovement);
        });

        investigateBtn.addEventListener('click', investigate);
        playAgainBtn.addEventListener('click', () => {
            // New logic to return to the quiz
            hideGameMessage(); // Hide the "You Win!" message box
            gameContainer.style.display = 'none'; // Hide the game section
            quizContainer.style.display = 'block'; // Show the quiz section
            renderQuiz(); // Reset the quiz and restart the timer
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            resetGame();
        }

        function initGame() {
            preloadKeyFragments();
            resizeCanvas();
            isGameActive = true;
            gameLoop();
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameContainer.style.display === 'flex') {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>
