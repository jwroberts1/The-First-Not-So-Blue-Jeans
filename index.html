<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiny Tina's Wonderlands Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* Styles for the Vault Hunter's game */
        #game-canvas {
            background-color: #333;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        #game-info {
            background-color: #222;
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #555;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(34, 34, 34, 0.95);
            padding: 2.5rem;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            text-align: center;
            z-index: 1000;
            border-radius: 15px;
        }

        .message-box button {
            background-color: #f59e0b;
            color: #1a1a1a;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .message-box button:hover {
            background-color: #d97706;
            transform: scale(1.05);
        }

        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent;
            /* Removes blue highlight on tap */
        }

        /* Media query to show controls on screens smaller than large desktops */
        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="./Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Fatemaker and the Dragon Lord</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: A Tale of Bunkers & Badasses</h2>

                <p class="mb-4">In a dusty, forgotten bunker, aboard a crashed spaceship, the galaxy's most dangerous 13-year-old, Tiny Tina, decided it was time for an adventure. But not just any adventure. This would be a game of her own creation: "Bunkers & Badasses," a world born entirely from her explosive and unpredictable imagination. She was the all-powerful Bunker Master, the creator of the story. With her were her newest friends, who had been shipwrecked with her: Valentine, a smooth-talking but not-so-heroic space adventurer, and Frette, a high-strung robot who loved following the rules. And then there was you. In Tina‚Äôs world, you were not just a player; you were the Fatemaker, a brand-new hero whose destiny was unwritten, ready to save the day.</p>
                <p class="mb-6">Tina slammed a miniature figure onto the game board. "Your quest," she cackled, "is to defeat the most evil, super-mega-baddie of all time: the Dragon Lord!" The Dragon Lord was an ancient, powerful skeleton sorcerer who had returned after centuries of being sealed away. His goal was simple and terrible: to conquer the Wonderlands, drain all the magic from the world, and rule over a kingdom of dusty skeletons. The only thing standing in his way was the magical capital city of Brighthoof, and its majestic ruler, Queen Butt Stallion, a magical diamond horse known as a binicorn.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Siege of Brighthoof</h3>

                <p class="mb-4">The Fatemaker‚Äôs adventure began in a town called Snoring Valley, a peaceful place that was about to be anything but. The Dragon Lord‚Äôs skeletal army, a clattering horde of undead soldiers, suddenly rose from the ground and attacked. The Fatemaker fought bravely, proving they were a true hero from the very start. After saving the town, they learned the Dragon Lord was planning a massive assault on Brighthoof. The hero‚Äôs path was clear: they had to get to the capital and warn the Queen.</p>
                <p class="mb-6">The journey took the Fatemaker across the "Overworld," a giant game board that connected all the different lands of Tina's imagination. They fought through enchanted forests and spooky crypts until they finally arrived at Brighthoof. But it was too late. The city was already under attack. The sky was dark with smoke, and catapults were launching giant, flaming skulls over the city walls. The Dragon Lord himself was there, floating high above the chaos. He held a terrible weapon: the Sword of Souls. This magical blade gave him the power to raise the dead and command them to do his bidding. With a single swing, he struck down the magical barrier protecting the city, and his army of skeletons poured into the streets.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Realm of Strange Adventures</h3>

                <p class="mb-4">The Fatemaker, with the help of the brave Brighthoof guards, fought back against the skeletons and managed to push the army out of the city. But the Dragon Lord had accomplished his mission. He had stolen the very soul of Queen Butt Stallion, trapping her and leaving the city without its magical protector. To save the Queen and the world, the Fatemaker would have to find the Dragon Lord and destroy the Sword of Souls. This meant journeying to the far corners of the Wonderlands, a land filled with bizarre and dangerous places.</p>
                <p class="mb-4">Their first major stop was the Weepwild Dankness, a gloomy forest where giant mushrooms glowed with a spooky light. Here, they met a race of small, blue creatures called Murphs, who were being terrorized by a monster. The Fatemaker helped the Murphs, proving that a hero‚Äôs job is to help everyone, no matter how small. After the forest, their path led them to Mount Craw, a freezing mountain range ruled by goblins. But these weren't just any goblins. They were part of a group called G.T.F.O. (Goblins Tired of Forced Oppression), a revolution fighting for freedom. The Fatemaker joined their cause, helping them overthrow their cruel goblin bosses in a chaotic and hilarious battle for workers' rights.</p>
                <p class="mb-6">One of the strangest places they visited was Tangledrift. A magical beanstalk had sprouted underneath a small town and grown so large that it lifted the entire town, and the ground it was on, high into the sky. Now, it was a series of floating islands connected by vines and rickety bridges. The Fatemaker had to navigate this bizarre, vertical world, fighting off dangerous plants and creatures that had made their homes in the clouds. Each new place was a wild creation from Tina‚Äôs mind, and each adventure made the Fatemaker stronger and more famous throughout the land.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Dragon Lord's Story</h3>

                <p class="mb-4">As the game went on, Valentine and Frette kept asking Tina questions about the Dragon Lord. Why was he so evil? Where did he come from? At first, Tina would get annoyed and change the subject. But slowly, the truth began to come out. The Dragon Lord wasn't just a random villain she had made up for this one game. He was a character she had created a long, long time ago, back when she was just a little girl. And in her original stories, he wasn't a villain at all. He was supposed to be a hero.</p>
                <p class="mb-6">Tina confessed that in her first-ever game of Bunkers & Badasses, she had created the Dragon Lord to be the main hero. But she had made him too powerful and too complicated. She got frustrated because she felt like she wasn't a good enough storyteller to give him the adventure he deserved. So, she abandoned him. She locked his character sheet away in a box and tried to forget about him. But in the world of her imagination, the Dragon Lord didn't just disappear. He felt abandoned and betrayed by his own creator. His sadness and anger twisted him, turning him from the hero he was meant to be into the villain he was today. His plan to drain the world of magic was his way of getting revenge on the creator who had left him behind.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Fearamid and the Final Battle</h3>

                <p class="mb-4">With this new understanding, the Fatemaker knew the final battle would be about more than just winning. It was about helping Tina fix her mistake. Their journey finally led them to the Ocean... but the ocean wasn't water. It was a giant, shimmering sea of sand. And at the bottom of this sandy sea was the Dragon Lord's fortress: the Fearamid, a massive, black pyramid that floated in the depths, crackling with dark energy.</p>
                <p class="mb-6">The Fatemaker had to find a way to cross the sand-sea, which they did by befriending a grumpy pirate skeleton with a magical, sand-sailing ship. After a long and dangerous voyage, they arrived at the Fearamid and began their final assault. Inside, they fought through the Dragon Lord's most powerful minions, including his three ancient and powerful skeleton generals. The pyramid was a maze of traps and powerful magic, a final test of everything the hero had learned.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Creator's Choice</h3>

                <p class="mb-4">At the very top of the Fearamid, the Fatemaker finally confronted the Dragon Lord. The battle was epic. The skeleton sorcerer was incredibly powerful, using the Sword of Souls to summon armies of the dead and cast devastating spells. The Fatemaker had to dodge, shoot, and use all of their magical abilities to survive. Just when it seemed the Dragon Lord was too strong, help arrived. Queen Butt Stallion, her soul freed by the Fatemaker's progress, appeared in a flash of rainbow magic, helping the hero in the final moments of the fight.</p>
                <p class="mb-6">Together, they defeated the Dragon Lord, shattering the Sword of Souls and releasing all the trapped spirits. But as the villain lay defeated, Tina, as the Bunker Master, had a choice. She could have the Fatemaker finish him off for good, erasing him from her world forever. Or, she could do something different. Remembering how she had abandoned him, she chose compassion. She described how the Fatemaker didn't destroy the Dragon Lord, but instead used magic to trap him in a powerful mirror, imprisoning him but not killing him. She spoke to her creation, apologizing for leaving him behind and promising to one day write him a better story‚Äîthe heroic story he was always meant to have.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Beginning in the Wonderlands</h3>

                <p class="mb-4">With the Dragon Lord defeated and Brighthoof safe, the adventure was over. The soul of Queen Butt Stallion was returned to her body, and she once again ruled over her peaceful, shining city. The Wonderlands were safe from the threat of darkness. Back in the bunker, Tina, Valentine, Frette, and the Fatemaker celebrated their victory. They had not only saved a magical world, but they had helped Tina become a better and kinder storyteller. The game was over, but the friendships they had formed were real. And everyone knew that as long as Tiny Tina had her imagination, there would always be more adventures waiting in the incredible, chaotic, and wonderful world of the Wonderlands.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Check out your reward
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-900 rounded-lg shadow-2xl" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-white bg-gray-800 p-4 rounded-xl border-2 border-yellow-400">
                <h1 class="text-3xl font-bold mb-2 game-font">Vault Hunter's Treasure</h1>
                <p class="text-gray-300">Use the arrow keys to move and the <strong class="text-yellow-400">E key</strong> to investigate for key fragments!</p>
                <div class="mt-4 text-xl">
                    Key Fragments Found: <span id="foundCount" class="font-bold text-yellow-400">0</span> / 3
                </div>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex-col items-center mt-6 w-full">
                <div class="grid grid-cols-3 gap-2 w-48">
                    <div class="col-span-1"></div>
                    <button id="up-btn" class="control-button">‚ñ≤</button>
                    <div class="col-span-1"></div>
                    <button id="left-btn" class="control-button">‚óÄ</button>
                    <div class="col-span-1"></div>
                    <button id="right-btn" class="control-button">‚ñ∂</button>
                    <div class="col-span-1"></div>
                    <button id="down-btn" class="control-button">‚ñº</button>
                    <div class="col-span-1"></div>
                </div>
                <button id="investigateBtn" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full mt-6 hover:bg-yellow-500 transition duration-300 w-48">
                    Investigate
                </button>
            </div>

            <div id="end-game-message" class="message-box hidden text-white">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4">Congratulations, Vault Hunter!</h2>
                <div id="completed-key-container" class="mb-6 flex justify-center"></div>
                <p class="mb-6 text-lg sm:text-xl">You have successfully completed the vault key. What knowledge will you seek?</p>
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data
        const allQuestions = [{
            id: 'q1',
            questionText: 'Who is the "Bunker Master" running the game of Bunkers & Badasses?',
            options: [{
                value: 'A',
                text: 'The Dragon Lord'
            }, {
                value: 'B',
                text: 'Queen Butt Stallion'
            }, {
                value: 'C',
                text: 'Tiny Tina'
            }, {
                value: 'D',
                text: 'Valentine'
            }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What is the special name for the player\'s character in the Wonderlands?',
            options: [{
                value: 'A',
                text: 'The Vault Hunter'
            }, {
                value: 'B',
                text: 'The Fatemaker'
            }, {
                value: 'C',
                text: 'The Hero of Brighthoof'
            }, {
                value: 'D',
                text: 'The Bunker Master'
            }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'Who is the magical diamond binicorn that rules the capital city?',
            options: [{
                value: 'A',
                text: 'Princess Fluffybutt'
            }, {
                value: 'B',
                text: 'The Dragon Lord'
            }, {
                value: 'C',
                text: 'Frette'
            }, {
                value: 'D',
                text: 'Queen Butt Stallion'
            }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'What is the name of the Dragon Lord\'s evil weapon that lets him control the dead?',
            options: [{
                value: 'A',
                text: 'The Staff of Magic'
            }, {
                value: 'B',
                text: 'The Sword of Souls'
            }, {
                value: 'C',
                text: 'The Amulet of Power'
            }, {
                value: 'D',
                text: 'The Hammer of Skeletons'
            }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'What does G.T.F.O., the goblin group on Mount Craw, stand for?',
            options: [{
                value: 'A',
                text: 'Goblins That Fight Often'
            }, {
                value: 'B',
                text: 'Great Tactical Fighting Organization'
            }, {
                value: 'C',
                text: 'Goblins Tired of Forced Oppression'
            }, {
                value: 'D',
                text: 'Go Towards the Forbidden Oasis'
            }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What is the name of the Dragon Lord\'s floating pyramid fortress?',
            options: [{
                value: 'A',
                text: 'Castle Grayskull'
            }, {
                value: 'B',
                text: 'The Doom Spire'
            }, {
                value: 'C',
                text: 'The Bunkercastle'
            }, {
                value: 'D',
                text: 'The Fearamid'
            }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'What was the Dragon Lord originally created by Tina to be?',
            options: [{
                value: 'A',
                text: 'A funny sidekick'
            }, {
                value: 'B',
                text: 'A hero'
            }, {
                value: 'C',
                text: 'A shopkeeper'
            }, {
                value: 'D',
                text: 'A talking mountain'
            }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'Besides Tina and the Fatemaker, who are the other two people playing the game?',
            options: [{
                value: 'A',
                text: 'The Murphs'
            }, {
                value: 'B',
                text: 'The Goblins of G.T.F.O.'
            }, {
                value: 'C',
                text: 'Valentine and Frette'
            }, {
                value: 'D',
                text: 'Queen Butt Stallion and the Dragon Lord'
            }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'What does Tina choose to do with the Dragon Lord at the end of the game?',
            options: [{
                value: 'A',
                text: 'Destroy him completely'
            }, {
                value: 'B',
                text: 'Trap him in a mirror to redeem him later'
            }, {
                value: 'C',
                text: 'Make him the new king of Brighthoof'
            }, {
                value: 'D',
                text: 'Turn him into a friendly squirrel'
            }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'What is the main lesson Tina learns about being a good storyteller?',
            options: [{
                value: 'A',
                text: 'That the villain should always win'
            }, {
                value: 'B',
                text: 'That stories should never have goblins'
            }, {
                value: 'C',
                text: 'That she needed to be responsible for her creations and face her mistakes'
            }, {
                value: 'D',
                text: 'That games should always take place in a spooky forest'
            }],
            type: 'radio'
        }];

        const correctAnswers = {
            q1: "C",
            q2: "B",
            q3: "D",
            q4: "B",
            q5: "C",
            q6: "D",
            q7: "B",
            q8: "C",
            q9: "B",
            q10: "C"
        };

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');
        const investigateBtn = document.getElementById('investigateBtn');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box flex flex-col items-center';
            messageBox.innerHTML = `
                <p class="text-white text-lg sm:text-xl mb-4">${message}</p>
                <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // Game Logic for Vault Hunter's Treasure
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const foundCountEl = document.getElementById('foundCount');
        const messageBox = document.getElementById('end-game-message');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const completedKeyContainer = document.getElementById('completed-key-container');
        const upBtn = document.getElementById('up-btn');
        const downBtn = document.getElementById('down-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const hunterSize = 50;
        let hunterX, hunterY;
        const speed = 5;
        let foundKeys = 0;
        let isGameActive = false;
        let animationFrameId;

        const hunterSymbol = 'ü§†';
        const keyFragmentImages = [];
        let objects = [];
        const numObjects = 10;
        const objectSymbols = ['üì¶', 'üí∞', 'üõ°Ô∏è', '‚öôÔ∏è', 'üíé', 'üß™'];

        const keys = {};

        // SVG functions
        function createDiamondFragmentSVG(fragmentIndex) {
            const svgWidth = 50;
            const svgHeight = 50;
            let svgPath = '';
            if (fragmentIndex === 0) {
                svgPath = `M${svgWidth / 2},0 L0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth},${svgHeight / 2} Z`;
            } else if (fragmentIndex === 1) {
                svgPath = `M0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L0,${svgHeight} Z`;
            } else if (fragmentIndex === 2) {
                svgPath = `M${svgWidth},${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L${svgWidth},${svgHeight} Z`;
            }
            return `<svg xmlns="http://www.w3.org/2000/svg" width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
                        <path d="${svgPath}" fill="#a855f7" stroke="#8b5cf6" stroke-width="2" />
                    </svg>`;
        }

        function createCompletedDiamondSVG() {
            return `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                        <path d="M50,0 L0,50 L50,100 L100,50 Z" fill="#a855f7" stroke="#8b5cf6" stroke-width="4" />
                    </svg>`;
        }

        function preloadKeyFragments() {
            for (let i = 0; i < 3; i++) {
                const keyFragImage = new Image();
                const svgString = createDiamondFragmentSVG(i);
                keyFragImage.src = 'data:image/svg+xml;base64,' + btoa(svgString);
                keyFragmentImages.push(keyFragImage);
            }
        }

        function showGameMessage() {
            completedKeyContainer.innerHTML = createCompletedDiamondSVG();
            messageBox.classList.remove('hidden');
        }

        function hideGameMessage() {
            messageBox.classList.add('hidden');
        }

        // Game state and object creation
        function createObjects() {
            objects = [];
            const keyLocations = new Set();
            while (keyLocations.size < 3) {
                keyLocations.add(Math.floor(Math.random() * numObjects));
            }

            for (let i = 0; i < numObjects; i++) {
                let x, y;
                let overlap;
                do {
                    overlap = false;
                    x = Math.random() * (canvas.width - 50);
                    y = Math.random() * (canvas.height - 50);

                    for (const obj of objects) {
                        const dist = Math.sqrt(Math.pow(x - obj.x, 2) + Math.pow(y - obj.y, 2));
                        if (dist < 100) {
                            overlap = true;
                            break;
                        }
                    }
                } while (overlap);

                objects.push({
                    x: x,
                    y: y,
                    isKey: keyLocations.has(i),
                    isFound: false,
                    symbol: objectSymbols[Math.floor(Math.random() * objectSymbols.length)]
                });
            }
        }

        function resetGame() {
            foundKeys = 0;
            foundCountEl.textContent = foundKeys;
            hunterX = canvas.width / 2 - hunterSize / 2;
            hunterY = canvas.height / 2 - hunterSize / 2;
            hideGameMessage();
            createObjects();
            isGameActive = true;
            if (!animationFrameId) {
                gameLoop();
            }
        }

        // Game drawing logic
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            objects.forEach(obj => {
                ctx.save();
                ctx.translate(obj.x, obj.y);
                if (obj.isFound) {
                    const foundKeyCount = objects.filter(o => o.isFound).length;
                    const fragIndex = obj.isKey ? objects.filter(o => o.isKey).indexOf(obj) : -1;
                    if (fragIndex !== -1 && keyFragmentImages[fragIndex]?.complete) {
                        ctx.drawImage(keyFragmentImages[fragIndex], 0, 0, 50, 50);
                    }
                } else {
                    ctx.font = '40px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(obj.symbol, 25, 25);
                }
                ctx.restore();
            });

            ctx.font = '50px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(hunterSymbol, hunterX + hunterSize / 2, hunterY + hunterSize / 2);
        }

        // Game logic
        function investigate() {
            if (!isGameActive) return;
            let foundSomething = false;
            objects.forEach(obj => {
                if (!obj.isFound &&
                    hunterX < obj.x + 50 &&
                    hunterX + hunterSize > obj.x &&
                    hunterY < obj.y + 50 &&
                    hunterY + hunterSize > obj.y) {
                    if (obj.isKey) {
                        obj.isFound = true;
                        foundKeys++;
                        foundSomething = true;
                        foundCountEl.textContent = foundKeys;
                        if (foundKeys === 3) {
                            showGameMessage();
                            isGameActive = false;
                        }
                    }
                }
            });
            draw();
        }

        function gameLoop() {
            if (!isGameActive) return;

            if (keys['ArrowUp']) hunterY -= speed;
            if (keys['ArrowDown']) hunterY += speed;
            if (keys['ArrowLeft']) hunterX -= speed;
            if (keys['ArrowRight']) hunterX += speed;

            hunterX = Math.max(0, Math.min(canvas.width - hunterSize, hunterX));
            hunterY = Math.max(0, Math.min(canvas.height - hunterSize, hunterY));

            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Event Listeners for game
        document.addEventListener('keydown', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
            if (e.key.toLowerCase() === 'e' || e.key === ' ') {
                investigate();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        // Touch/Mouse event listeners for new buttons
        const controlButtons = {
            'up-btn': 'ArrowUp',
            'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft',
            'right-btn': 'ArrowRight'
        };

        function startMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = true;
        }

        function stopMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = false;
        }

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('mousedown', startMovement);
            btn.addEventListener('mouseup', stopMovement);
            btn.addEventListener('mouseleave', stopMovement); // Prevents movement from getting stuck if cursor moves off button
            btn.addEventListener('touchstart', startMovement);
            btn.addEventListener('touchend', stopMovement);
        });

        investigateBtn.addEventListener('click', investigate);
        playAgainBtn.addEventListener('click', () => {
            // New logic to return to the quiz
            hideGameMessage(); // Hide the "You Win!" message box
            gameContainer.style.display = 'none'; // Hide the game section
            quizContainer.style.display = 'block'; // Show the quiz section
            renderQuiz(); // Reset the quiz and restart the timer
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            resetGame();
        }

        function initGame() {
            preloadKeyFragments();
            resizeCanvas();
            isGameActive = true;
            gameLoop();
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameContainer.style.display === 'flex') {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>

