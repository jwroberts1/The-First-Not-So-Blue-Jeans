<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Man: A Hero is Unleashed Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* Styles for the Vault Hunter's game */
        #game-canvas {
            background-color: #333;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        #game-info {
            background-color: #222;
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #555;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(34, 34, 34, 0.95);
            padding: 2.5rem;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            text-align: center;
            z-index: 1000;
            border-radius: 15px;
        }

        .message-box button {
            background-color: #f59e0b;
            color: #1a1a1a;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .message-box button:hover {
            background-color: #d97706;
            transform: scale(1.05);
        }

        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent;
            /* Removes blue highlight on tap */
        }

        /* Media query to show controls on screens smaller than large desktops */
        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="./Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Tale of Dog Man and Petey the Cat</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: A Hero is Unleashed!</h2>

                <p class="mb-4">Once upon a time, in a city that was pretty okay, there were two best friends named George Beard and Harold Hutchins. George was the kid with the tie and the flat-top. Harold was the one with the T-shirt and the bad haircut. Together, they spent all their time in their treehouse, writing and drawing their very own comic books. Their greatest creation was a hero for the ages, a crime-fighter who was part dog, part man, and ALL cop! His name was Dog Man.</p>
                <p class="mb-6">The story of how Dog Man was created was both sad and a little bit silly. There was a brave police officer named Officer Knight, who was the best cop in the whole city. And with him was his equally brave police dog, Greg, the smartest dog on the force. They were an unstoppable team, always ready to fight for justice. Their biggest enemy was a fuzzy, orange cat named Petey. Petey was the world's most evil cat, a master criminal who was always coming up with wicked plans. One day, Petey built a bomb, a tricky trap to finally get rid of his two biggest enemies. Officer Knight and Greg tried their best to defuse the bomb, but... KA-BLOOEY! The bomb went off. It was a terrible accident. Officer Knight’s head was dying, and Greg’s body was dying. They were goners for sure.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Hero is Born</h3>

                <p class="mb-4">But a quick-thinking nurse at the hospital had a wild idea. A really, really wild idea. "Hey!" she said. "This dog's head is still good, and this cop's body is still good! I know what to do!" With some surgical thread and a whole lot of hope, the nurse performed a new kind of surgery. She sewed the dog's head onto the cop's body. The operation was a success! A new hero was born that day. He had the smarts and strength of a human police officer, but the head and doggy instincts of a super-loyal canine. Dog Man was ready for his first day on the job, and the Chief of Police was there to see him off. The Chief was a grumpy man who was always yelling, and he wasn't so sure about this new kind of cop. "Now listen here," the Chief grumbled. "You may look strange, but I expect you to be the best cop ever! No funny business!"</p>
                <p class="mb-6">Dog Man was, in fact, the best cop ever. He was strong, he was fast, and he was a very, very good boy. He could sniff out crime from a mile away and chase down bad guys with incredible speed. But there was a small problem. Even though he had a man's body, he still had a dog's brain. He would get distracted by squirrels, chase bouncing balls into traffic, and dig through the Chief's garbage cans. He would jump on the Chief and lick his face, covering him in slobber. "DOG MAN, MY OFFICE, NOW!" the Chief would yell almost every day. While Dog Man was great at catching criminals, he was also great at making a mess.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Petey's Perfect Plan</h3>

                <p class="mb-4">Meanwhile, Petey the cat was locked away in cat jail, but not for long. He used his sneaky cat skills to escape and immediately started planning his next big crime. "This time, they'll never catch me!" he cackled. His plan was brilliant and simple. He built a giant vacuum cleaner, big enough to suck up a whole building. He rolled it up to the First National Bank and flipped the switch. WHOOSH! The vacuum sucked up all the money, all the gold, and even the lollipops from the front desk. Petey was rich!</p>
                <p class="mb-6">But just as he was about to make his getaway, Dog Man arrived on the scene. The chase was on! Petey zoomed away in his getaway car, but Dog Man was right on his tail. Thinking fast, Petey pulled out another one of his inventions: Invisibility Spray. He sprayed himself and his car, and POOF! They vanished. The other cops were confused. "Where'd he go?" they asked. But Dog Man didn't need to see Petey. He could smell him! He followed his super-canine nose through the streets, sniffing out the trail of the invisible cat. He found Petey hiding behind a bush, and with one heroic pounce, he captured the evil cat and returned all the stolen money. The Chief was so happy he almost smiled. "Good job, Dog Man," he grunted. "You're a credit to the force."</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Rise of the Weenies</h3>

                <p class="mb-4">Just when the city seemed safe, a new villain emerged from the most unlikely of places. It was the Chief! Well, not really. It was Philly, the owner of a popular hot dog stand. He was angry because Dog Man had accidentally wrecked his stand during the big chase. "I'll get my revenge!" Philly shouted, shaking his fist. He went to his secret laboratory and used a special "living spray" to bring one of his hot dogs to life. But this was no ordinary hot dog. It grew and grew until it was a giant, evil monster with ketchup-and-mustard breath. It was the world's first Hot Dog Weenie Monster!</p>
                <p class="mb-6">The Weenie Monster stomped through the city, causing chaos and panic. It squirted mustard on buildings and knocked over cars with its powerful tail. Dog Man arrived to save the day, but the monster was too powerful. It swatted Dog Man away like a fly. The city was in big trouble. The Mayor called an emergency meeting. "We need a plan!" he cried. The scientists decided to build a giant robot to fight the giant hot dog. They built the Super-Duper Pooper Scooper 2000, a massive cleaning machine turned into a fighting robot. But when the robot faced the Weenie Monster, the monster just ate it in one big bite. The plan had failed!</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Smarter Kind of Hero</h3>

                <p class="mb-4">Everyone was panicking, but Dog Man had an idea. He noticed the Weenie Monster wasn't really evil; it just seemed to be looking for something. It was sniffing the air, as if it was hungry. Dog Man realized what the monster wanted: more mustard! So, Dog Man did the bravest thing a hero could do. He ran to the hot dog stand, jumped into the giant tub of mustard, and covered himself from head to toe. He was now the most delicious-smelling hero in the world.</p>
                <p class="mb-6">"Hey, Weenie!" he barked. The monster turned and saw him. Its eyes lit up! Dog Man ran as fast as he could, and the giant Hot Dog Weenie Monster chased after him, wanting to cover the hero in ketchup. Dog Man led the monster on a wild chase all the way to the edge of the city, right to the waterfront. With a mighty leap, Dog Man jumped into the water. The Weenie Monster, not looking where it was going, jumped in right after him. But everyone knows what happens to bread when it gets wet. The monster's hot dog bun got all soggy and gross, and it fell apart into a mushy mess. Dog Man had saved the city once again!</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Power of Words</h3>
                
                <p class="mb-4">Back in cat jail, Petey was feeling very bored. There was nothing to do but read. So he read every book in the prison library. He read about science, history, and engineering. All that reading made him super, super smart. His brain grew three sizes that day! With his new big brain, he built his most brilliant and evil invention yet: the Brain-Buster 2000. This machine could read words from a book and make them come to life!</p>
                <p class="mb-6">Petey wrote a book filled with evil words like "CRASH!", "SMASH!", and "KABOOM!" and then turned on his machine. All over the city, the words appeared in the air and became real! A giant "CRACK!" appeared on the side of a building, and a huge crack split it in two. A giant "SMASH!" fell on a car, flattening it like a pancake. It was chaos! How could anyone fight a word?</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Final Page</h3>

                <p class="mb-4">Dog Man knew he couldn't punch a word. He needed a different plan. He needed to erase them! He found a giant pencil at the local art museum, the kind artists use for big sculptures. It was perfect. With the giant pencil in hand, he raced through the city. When he saw the word "CRASH!", he flipped the pencil over and used its giant eraser to rub it out of existence. He erased every single evil word until the city was safe. He had defeated Petey's evil plan with the power of an eraser!</p>
                <p class="mb-6">With Petey back in jail and the city saved from evil words, the Chief called Dog Man into his office one last time. "Dog Man," he said, and for the first time, he was actually smiling. "You're messy, you're goofy, and you cover me in slobber. But you're the best cop this city has ever had." He pinned a medal on Dog Man's chest. Dog Man was a true hero, and it was all thanks to the amazing comics created by two best friends in a treehouse. They knew that as long as there were bad guys to fight, Dog Man would be there to save the day!</p>
            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Check out your reward
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-900 rounded-lg shadow-2xl" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-white bg-gray-800 p-4 rounded-xl border-2 border-yellow-400">
                <h1 class="text-3xl font-bold mb-2 game-font">Vault Hunter's Treasure</h1>
                <p class="text-gray-300">Use the arrow keys to move and the <strong class="text-yellow-400">E key</strong> to investigate for key fragments!</p>
                <div class="mt-4 text-xl">
                    Key Fragments Found: <span id="foundCount" class="font-bold text-yellow-400">0</span> / 3
                </div>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex-col items-center mt-6 w-full">
                <div class="grid grid-cols-3 gap-2 w-48">
                    <div class="col-span-1"></div>
                    <button id="up-btn" class="control-button">▲</button>
                    <div class="col-span-1"></div>
                    <button id="left-btn" class="control-button">◀</button>
                    <div class="col-span-1"></div>
                    <button id="right-btn" class="control-button">▶</button>
                    <div class="col-span-1"></div>
                    <button id="down-btn" class="control-button">▼</button>
                    <div class="col-span-1"></div>
                </div>
                <button id="investigateBtn" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full mt-6 hover:bg-yellow-500 transition duration-300 w-48">
                    Investigate
                </button>
            </div>

            <div id="end-game-message" class="message-box hidden text-white">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4">Congratulations, Vault Hunter!</h2>
                <div id="completed-key-container" class="mb-6 flex justify-center"></div>
                <p class="mb-6 text-lg sm:text-xl">You have successfully completed the vault key. What knowledge will you seek?</p>
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data
        const allQuestions = [{
            id: 'q1',
            questionText: 'How was Dog Man created?',
            options: [{
                value: 'A',
                text: 'He was a robot built by scientists.'
            }, {
                value: 'B',
                text: 'A nurse sewed a dog\'s head onto a cop\'s body.'
            }, {
                value: 'C',
                text: 'He was a normal man who was bitten by a radioactive dog.'
            }, {
                value: 'D',
                text: 'He was born that way.'
            }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What is the name of the main villain, who is also the world\'s most evil cat?',
            options: [{
                value: 'A',
                text: 'Chairman Meow'
            }, {
                value: 'B',
                text: 'Fluffy'
            }, {
                value: 'C',
                text: 'Petey'
            }, {
                value: 'D',
                text: 'Mr. Whiskers'
            }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'What invention did Petey use to rob the bank?',
            options: [{
                value: 'A',
                text: 'A giant magnet'
            }, {
                value: 'B',
                text: 'A teleportation device'
            }, {
                value: 'C',
                text: 'An army of robots'
            }, {
                value: 'D',
                text: 'A giant vacuum cleaner'
            }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'How did Dog Man find Petey after he used Invisibility Spray?',
            options: [{
                value: 'A',
                text: 'He used his super-hearing to hear Petey breathing.'
            }, {
                value: 'B',
                text: 'He followed Petey\'s footprints.'
            }, {
                value: 'C',
                text: 'He used his super-canine nose to smell him.'
            }, {
                value: 'D',
                text: 'He tricked Petey into talking.'
            }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'What giant food-based monster did Philly create to get revenge on Dog Man?',
            options: [{
                value: 'A',
                text: 'A giant taco'
            }, {
                value: 'B',
                text: 'A Hot Dog Weenie Monster'
            }, {
                value: 'C',
                text: 'A colossal cheeseburger'
            }, {
                value: 'D',
                text: 'A massive pizza'
            }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'How did Dog Man defeat the giant Hot Dog Weenie Monster?',
            options: [{
                value: 'A',
                text: 'He used a giant fork and knife.'
            }, {
                value: 'B',
                text: 'He led it into the water so its bun would get soggy.'
            }, {
                value: 'C',
                text: 'He built an even bigger robot to fight it.'
            }, {
                value: 'D',
                text: 'He ate the whole thing.'
            }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'What did Petey do in cat jail that made him super smart?',
            options: [{
                value: 'A',
                text: 'He exercised a lot.'
            }, {
                value: 'B',
                text: 'He watched educational TV shows.'
            }, {
                value: 'C',
                text: 'He read every book in the prison library.'
            }, {
                value: 'D',
                text: 'He solved a lot of puzzles.'
            }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'What did Petey\'s invention, the Brain-Buster 2000, do?',
            options: [{
                value: 'A',
                text: 'It could read people\'s minds.'
            }, {
                value: 'B',
                text: 'It could make people forget things.'
            }, {
                value: 'C',
                text: 'It could make words from books come to life.'
            }, {
                value: 'D',
                text: 'It could shoot laser beams from its eyes.'
            }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'How did Dog Man defeat the army of evil words that were attacking the city?',
            options: [{
                value: 'A',
                text: 'He used a giant fan to blow them away.'
            }, {
                value: 'B',
                text: 'He shouted nice words to cancel them out.'
            }, {
                value: 'C',
                text: 'He used a giant pencil with a giant eraser.'
            }, {
                value: 'D',
                text: 'He trapped them in a giant book.'
            }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'Who are the two best friends who are the "authors" of the Dog Man comics?',
            options: [{
                value: 'A',
                text: 'Officer Knight and Greg'
            }, {
                value: 'B',
                text: 'The Chief and The Mayor'
            }, {
                value: 'C',
                text: 'Philly and Petey'
            }, {
                value: 'D',
                text: 'George Beard and Harold Hutchins'
            }],
            type: 'radio'
        }];

        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "D",
            q4: "C",
            q5: "B",
            q6: "B",
            q7: "C",
            q8: "C",
            q9: "C",
            q10: "D"
        };

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');
        const investigateBtn = document.getElementById('investigateBtn');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box flex flex-col items-center';
            messageBox.innerHTML = `
                <p class="text-white text-lg sm:text-xl mb-4">${message}</p>
                <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // Game Logic for Vault Hunter's Treasure
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const foundCountEl = document.getElementById('foundCount');
        const messageBox = document.getElementById('end-game-message');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const completedKeyContainer = document.getElementById('completed-key-container');
        const upBtn = document.getElementById('up-btn');
        const downBtn = document.getElementById('down-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const hunterSize = 50;
        let hunterX, hunterY;
        const speed = 5;
        let foundKeys = 0;
        let isGameActive = false;
        let animationFrameId;

        const hunterSymbol = '🤠';
        const keyFragmentImages = [];
        let objects = [];
        const numObjects = 10;
        const objectSymbols = ['📦', '💰', '🛡️', '⚙️', '💎', '🧪'];

        const keys = {};

        // SVG functions
        function createDiamondFragmentSVG(fragmentIndex) {
            const svgWidth = 50;
            const svgHeight = 50;
            let svgPath = '';
            if (fragmentIndex === 0) {
                svgPath = `M${svgWidth / 2},0 L0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth},${svgHeight / 2} Z`;
            } else if (fragmentIndex === 1) {
                svgPath = `M0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L0,${svgHeight} Z`;
            } else if (fragmentIndex === 2) {
                svgPath = `M${svgWidth},${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L${svgWidth},${svgHeight} Z`;
            }
            return `<svg xmlns="http://www.w3.org/2000/svg" width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
                        <path d="${svgPath}" fill="#a855f7" stroke="#8b5cf6" stroke-width="2" />
                    </svg>`;
        }

        function createCompletedDiamondSVG() {
            return `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                        <path d="M50,0 L0,50 L50,100 L100,50 Z" fill="#a855f7" stroke="#8b5cf6" stroke-width="4" />
                    </svg>`;
        }

        function preloadKeyFragments() {
            for (let i = 0; i < 3; i++) {
                const keyFragImage = new Image();
                const svgString = createDiamondFragmentSVG(i);
                keyFragImage.src = 'data:image/svg+xml;base64,' + btoa(svgString);
                keyFragmentImages.push(keyFragImage);
            }
        }

        function showGameMessage() {
            completedKeyContainer.innerHTML = createCompletedDiamondSVG();
            messageBox.classList.remove('hidden');
        }

        function hideGameMessage() {
            messageBox.classList.add('hidden');
        }

        // Game state and object creation
        function createObjects() {
            objects = [];
            const keyLocations = new Set();
            while (keyLocations.size < 3) {
                keyLocations.add(Math.floor(Math.random() * numObjects));
            }

            for (let i = 0; i < numObjects; i++) {
                let x, y;
                let overlap;
                do {
                    overlap = false;
                    x = Math.random() * (canvas.width - 50);
                    y = Math.random() * (canvas.height - 50);

                    for (const obj of objects) {
                        const dist = Math.sqrt(Math.pow(x - obj.x, 2) + Math.pow(y - obj.y, 2));
                        if (dist < 100) {
                            overlap = true;
                            break;
                        }
                    }
                } while (overlap);

                objects.push({
                    x: x,
                    y: y,
                    isKey: keyLocations.has(i),
                    isFound: false,
                    symbol: objectSymbols[Math.floor(Math.random() * objectSymbols.length)]
                });
            }
        }

        function resetGame() {
            foundKeys = 0;
            foundCountEl.textContent = foundKeys;
            hunterX = canvas.width / 2 - hunterSize / 2;
            hunterY = canvas.height / 2 - hunterSize / 2;
            hideGameMessage();
            createObjects();
            isGameActive = true;
            if (!animationFrameId) {
                gameLoop();
            }
        }

        // Game drawing logic
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            objects.forEach(obj => {
                ctx.save();
                ctx.translate(obj.x, obj.y);
                if (obj.isFound) {
                    const foundKeyCount = objects.filter(o => o.isFound).length;
                    const fragIndex = obj.isKey ? objects.filter(o => o.isKey).indexOf(obj) : -1;
                    if (fragIndex !== -1 && keyFragmentImages[fragIndex]?.complete) {
                        ctx.drawImage(keyFragmentImages[fragIndex], 0, 0, 50, 50);
                    }
                } else {
                    ctx.font = '40px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(obj.symbol, 25, 25);
                }
                ctx.restore();
            });

            ctx.font = '50px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(hunterSymbol, hunterX + hunterSize / 2, hunterY + hunterSize / 2);
        }

        // Game logic
        function investigate() {
            if (!isGameActive) return;
            let foundSomething = false;
            objects.forEach(obj => {
                if (!obj.isFound &&
                    hunterX < obj.x + 50 &&
                    hunterX + hunterSize > obj.x &&
                    hunterY < obj.y + 50 &&
                    hunterY + hunterSize > obj.y) {
                    if (obj.isKey) {
                        obj.isFound = true;
                        foundKeys++;
                        foundSomething = true;
                        foundCountEl.textContent = foundKeys;
                        if (foundKeys === 3) {
                            showGameMessage();
                            isGameActive = false;
                        }
                    }
                }
            });
            draw();
        }

        function gameLoop() {
            if (!isGameActive) return;

            if (keys['ArrowUp']) hunterY -= speed;
            if (keys['ArrowDown']) hunterY += speed;
            if (keys['ArrowLeft']) hunterX -= speed;
            if (keys['ArrowRight']) hunterX += speed;

            hunterX = Math.max(0, Math.min(canvas.width - hunterSize, hunterX));
            hunterY = Math.max(0, Math.min(canvas.height - hunterSize, hunterY));

            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Event Listeners for game
        document.addEventListener('keydown', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
            if (e.key.toLowerCase() === 'e' || e.key === ' ') {
                investigate();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        // Touch/Mouse event listeners for new buttons
        const controlButtons = {
            'up-btn': 'ArrowUp',
            'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft',
            'right-btn': 'ArrowRight'
        };

        function startMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = true;
        }

        function stopMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = false;
        }

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('mousedown', startMovement);
            btn.addEventListener('mouseup', stopMovement);
            btn.addEventListener('mouseleave', stopMovement); // Prevents movement from getting stuck if cursor moves off button
            btn.addEventListener('touchstart', startMovement);
            btn.addEventListener('touchend', stopMovement);
        });

        investigateBtn.addEventListener('click', investigate);
        playAgainBtn.addEventListener('click', () => {
            // New logic to return to the quiz
            hideGameMessage(); // Hide the "You Win!" message box
            gameContainer.style.display = 'none'; // Hide the game section
            quizContainer.style.display = 'block'; // Show the quiz section
            renderQuiz(); // Reset the quiz and restart the timer
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            resetGame();
        }

        function initGame() {
            preloadKeyFragments();
            resizeCanvas();
            isGameActive = true;
            gameLoop();
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameContainer.style.display === 'flex') {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>

