<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peanuts: Heroes of History</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* --- GAME STYLES --- */
        #game-canvas {
            background: #87CEEB; /* Sky Blue */
            border-bottom: 60px solid #4ade80; /* Grass */
            border-left: 4px solid #3b82f6;
            border-right: 4px solid #3b82f6;
            border-top: 4px solid #3b82f6;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
            width: 100%;
            height: 100%;
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-3xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
            width: 80px;
            height: 80px;
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center; /* Corrected 'align: center' */
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Peanuts: The History Report</h1>
        <p class="text-gray-600 text-center mb-8">Charlie Brown and the gang learn about leaders who changed the world.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-base sm:text-lg border border-gray-200">
                
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 1: The Baseball Hero</h2>
                <p class="mb-4">It was a sunny afternoon at the baseball field, but Charlie Brown wasn't pitching. He was sitting on the pitcher's mound, reading a book. "Good grief," he sighed. "How can I pitch a game when I have a history report due tomorrow?" Franklin walked up, spinning a baseball in his hand. "What's the topic, Charlie Brown?" he asked.</p>
                <p class="mb-4">"Important Leaders," Charlie Brown replied. "I don't even know where to start." Franklin smiled and sat down next to him. "Why don't you start right here on the field? Have you ever heard of Jackie Robinson?" Charlie Brown shook his head. "Is he a pitcher?"</p>
                <p class="mb-4">"He was an infielder," Franklin explained. "But he was so much more. In 1947, he became the first African American to play in Major League Baseball in the modern era. Before him, black players had to play in separate leagues. Jackie faced a lot of mean people who shouted terrible things at him, but he never fought back with his fists. He fought back with his talent. He stole bases, hit home runs, and showed the world that everyone deserves a chance to play." Charlie Brown looked at his glove. "He sounds incredibly brave. I get nervous just standing on this mound."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 2: The Visionary Doctor</h2>
                <p class="mb-4">Later that day, Linus and Charlie Brown went to the library. Marcie was already there, adjusting her glasses. "Hello, Charles," she said. "Are you researching for the report? I'm reading about Dr. Patricia Bath." "Who is she?" Linus asked, clutching his blanket.</p>
                <p class="mb-4">"She was an amazing ophthalmologist—that's an eye doctor," Marcie said, pushing her own glasses up her nose. "She invented a special laser tool called the Laserphaco Probe. It helped cure blindness caused by cataracts. Because of her, thousands of people could see again."</p>
                <p class="mb-4">"Wow," Charlie Brown said. "That's like a superpower. Giving people their sight back." Marcie nodded. "She was also the first African American female doctor to receive a medical patent. She taught us that science is for everyone, and that we should always look for ways to help people see the beauty in the world."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 3: Unbought and Unbossed</h2>
                <p class="mb-4">Lucy marched over to their table, holding a biography. "You blockheads are missing the most important leader," she announced loudly. "Shirley Chisholm! She was the first African American woman elected to Congress. And in 1972, she ran for President of the United States!"</p>
                <p class="mb-4">"She ran for President?" Charlie Brown asked, amazed. "Did she win?" "She didn't win the election," Lucy admitted, "but she won something else. She opened the door for women and people of color in politics. Her slogan was 'Unbought and Unbossed.' She stood up for what she believed in, even when people told her to sit down."</p>
                <p class="mb-4">Lucy struck a pose. "I like her style. She was tough, like me. Maybe I'll run for President one day. My first law will be that all brothers must give up their blankets." Linus pulled his blanket tighter. "I think Shirley Chisholm believed in freedom, Lucy, not taking away blankets!"</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 4: The Peacemaker</h2>
                <p class="mb-4">Snoopy wandered into the library, wearing a suit and tie. He carried a briefcase and looked very official. "What's he doing?" Charlie Brown whispered. "I think he's pretending to be Ralph Bunche," Franklin observed. "Ralph Bunche was a diplomat. He worked for the United Nations."</p>
                <p class="mb-4">"A diplomat?" Linus asked. "What do they do?" "They make peace," Franklin said. "In 1950, Ralph Bunche became the first African American to win the Nobel Peace Prize. He helped stop a war in the Middle East by getting people to talk to each other instead of fighting. He believed that talking was always better than fighting."</p>
                <p class="mb-4">Snoopy nodded sagely and shook hands with Woodstock, sealing an imaginary peace treaty. "That's a good lesson," Charlie Brown said. "Maybe if we acted more like Ralph Bunche, Lucy wouldn't pull the football away from me." "Don't count on it, Charlie Brown," Lucy called out from the next aisle.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 5: The President</h2>
                <p class="mb-4">As the sun began to set, the gang sat on the library steps. "We have so much to write about," Charlie Brown said. "There's one more," Franklin said. "Barack Obama. He became the 44th President of the United States. He was the first African American President."</p>
                <p class="mb-4">"I remember my parents talking about that," Peppermint Patty said, joining them. "They said it was history in the making." "It was," Franklin agreed. "He proved that no matter where you come from or what you look like, you can reach the highest office in the land. He taught us to have hope and to believe that 'Yes We Can' change the world."</p>
                <p class="mb-4">Charlie Brown looked at his friends. He saw Franklin, Linus, Lucy, Marcie, and Peppermint Patty. They were all different, but they were all together. "These leaders," he said thoughtfully, "Jackie Robinson, Dr. Bath, Shirley Chisholm, Ralph Bunche, and President Obama... they didn't just do things for themselves. They did things to make the world better for everyone."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 6: The Report</h2>
                <p class="mb-4">The next day, Charlie Brown stood in front of the class. He held his index cards with shaking hands. But then he looked at Franklin, who gave him a thumbs up. He looked at Linus, who nodded. He took a deep breath.</p>
                <p class="mb-4">"My report is about Heroes of History," he began. His voice grew stronger. He told them about the baseball player who broke barriers, the doctor who restored sight, the woman who was unbought and unbossed, the diplomat who made peace, and the President who gave hope.</p>
                <p class="mb-4">When he finished, the room was quiet. Then, Miss Othmar's voice *wah-wah'd* approvingly. His friends clapped. Even Lucy didn't call him a blockhead. Charlie Brown walked back to his desk with a smile. He realized that history wasn't just about the past. It was about the courage to face the future. And maybe, just maybe, he had a little bit of that courage too.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 shadow-md hidden">
                    Congratulations! Play Snoopy's Word Catcher!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- --- GAME SECTION: Snoopy's Word Catcher --- -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            
            <div id="game-info" class="mb-4 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Snoopy's Word Catcher!</h1>
                <p class="text-gray-600">Catch 10 <span class="text-green-600 font-bold">GOOD</span> words (hope, peace, brave) to win! Avoid the <span class="text-red-600 font-bold">BAD</span> words (hate, fear, unfair)!</p>
            </div>

            <!-- Game Stats -->
            <div class="flex justify-between w-full max-w-xl mb-2 px-4 text-gray-800 game-font text-2xl">
                <div id="score-display">WORDS: 0/10</div>
                <div id="timer-display">TIME: 60</div>
            </div>

            <!-- Game Canvas -->
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-[4/3] overflow-hidden rounded-lg">
                 <canvas id="game-canvas"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex justify-center space-x-12 w-full mt-6">
                <button id="left-btn" class="control-button">◄</button>
                <button id="right-btn" class="control-button">►</button>
            </div>

            <!-- Game Over Modal -->
            <div id="game-over-modal" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 id="modal-title-text" class="text-3xl font-bold mb-4 text-yellow-700 header-font">Good Grief!</h2>
                    <p id="modal-body-text" class="text-gray-800 text-lg mb-6">Game Over!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- NEW QUIZ DATA (Based on History Story) ---
        const allQuestions = [
            {
                id: 'q1',
                questionText: "Which sport did Jackie Robinson play professionally?",
                options: [
                    { value: 'A', text: 'Basketball' },
                    { value: 'B', text: 'Baseball' },
                    { value: 'C', text: 'Football' },
                    { value: 'D', text: 'Soccer' }
                ],
                type: 'radio'
            },
            {
                id: 'q2',
                questionText: "What did Dr. Patricia Bath invent?",
                options: [
                    { value: 'A', text: 'A flying car.' },
                    { value: 'B', text: 'The Laserphaco Probe to treat cataracts.' },
                    { value: 'C', text: 'A new type of computer.' },
                    { value: 'D', text: 'A cure for the common cold.' }
                ],
                type: 'radio'
            },
            {
                id: 'q3',
                questionText: "What was Shirley Chisholm's famous slogan?",
                options: [
                    { value: 'A', text: 'Vote for Me.' },
                    { value: 'B', text: 'Unbought and Unbossed.' },
                    { value: 'C', text: 'Happy Days are Here.' },
                    { value: 'D', text: 'Go Team Go.' }
                ],
                type: 'radio'
            },
            {
                id: 'q4',
                questionText: "What important prize did Ralph Bunche win?",
                options: [
                    { value: 'A', text: 'The Super Bowl Trophy.' },
                    { value: 'B', text: 'The Nobel Peace Prize.' },
                    { value: 'C', text: 'An Oscar.' },
                    { value: 'D', text: 'A Gold Medal.' }
                ],
                type: 'radio'
            },
            {
                id: 'q5',
                questionText: "Who was the first African American President of the United States?",
                options: [
                    { value: 'A', text: 'Franklin.' },
                    { value: 'B', text: 'Barack Obama.' },
                    { value: 'C', text: 'George Washington.' },
                    { value: 'D', text: 'Ralph Bunche.' }
                ],
                type: 'radio'
            },
            {
                id: 'q6',
                questionText: "How did Jackie Robinson fight back against mean people?",
                options: [
                    { value: 'A', text: 'He yelled back at them.' },
                    { value: 'B', text: 'He quit the team.' },
                    { value: 'C', text: 'He fought with his talent and played well.' },
                    { value: 'D', text: 'He wore earplugs.' }
                ],
                type: 'radio'
            },
            {
                id: 'q7',
                questionText: "What did Dr. Bath's invention help people do?",
                options: [
                    { value: 'A', text: 'See again.' },
                    { value: 'B', text: 'Walk faster.' },
                    { value: 'C', text: 'Hear better.' },
                    { value: 'D', text: 'Sleep longer.' }
                ],
                type: 'radio'
            },
            {
                id: 'q8',
                questionText: "What office did Shirley Chisholm run for in 1972?",
                options: [
                    { value: 'A', text: 'Mayor.' },
                    { value: 'B', text: 'President of the United States.' },
                    { value: 'C', text: 'Principal.' },
                    { value: 'D', text: 'Governor.' }
                ],
                type: 'radio'
            },
            {
                id: 'q9',
                questionText: "What did Ralph Bunche believe was better than fighting?",
                options: [
                    { value: 'A', text: 'Running away.' },
                    { value: 'B', text: 'Talking to each other (diplomacy).' },
                    { value: 'C', text: 'Playing games.' },
                    { value: 'D', text: 'Ignoring the problem.' }
                ],
                type: 'radio'
            },
            {
                id: 'q10',
                questionText: "What lesson did Charlie Brown learn from his report?",
                options: [
                    { value: 'A', text: 'History is boring.' },
                    { value: 'B', text: 'History is about courage to face the future.' },
                    { value: 'C', text: 'Baseball is the only important thing.' },
                    { value: 'D', text: 'He should never do homework.' }
                ],
                type: 'radio'
            }
        ];

        // --- NEW Correct Answers ---
        const correctAnswers = {
            q1: "B",
            q2: "B",
            q3: "B",
            q4: "B",
            q5: "B",
            q6: "C",
            q7: "A",
            q8: "B",
            q9: "B",
            q10: "B"
        };


        // --- ALL SCRIPTING BELOW THIS LINE IS UNCHANGED ---

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            startGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- SNOOPY'S WORD CATCHER GAME LOGIC ---

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const gameTimerDisplay = document.getElementById('timer-display');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalBodyText = document.getElementById('modal-body-text');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');

        // Game constants
        const playerWidth = 60;
        const playerHeight = 60;
        const gravity = 0; // Not a jumping game
        const wordSpeed = 3;
        
        // Words data - Updated to catch GOOD values
        const goodWords = ["HOPE", "PEACE", "BRAVE", "JUSTICE", "EQUAL", "FREE", "DREAM", "TRUTH"];
        const badWords = ["HATE", "FEAR", "UNFAIR", "ANGRY", "MEAN", "STOP", "NO", "BAD"];

        // Game state variables
        let playerX;
        let playerY;
        let fallingWords = [];
        let score = 0;
        let timeLeft = 60;
        let gameLoop;
        let spawnInterval;
        let gameTimerInterval;
        let isMovingLeft = false;
        let isMovingRight = false;

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            playerY = canvas.height - playerHeight - 10;
        }

        // Initialize player position
        function initPlayer() {
            playerX = canvas.width / 2 - playerWidth / 2;
        }

        // Draw Snoopy (simplified as a white box with black ears for now, or text)
        function drawPlayer() {
            // Draw Snoopy-like shape
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth/2, playerY + playerHeight/2, playerWidth/2, playerHeight/3, 0, 0, Math.PI * 2);
            ctx.fill();
            // Ear
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.ellipse(playerX + 20, playerY + playerHeight/2, 10, 15, 0, 0, Math.PI * 2);
            ctx.fill();
            // Nose
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth - 10, playerY + playerHeight/2 - 5, 5, 5, 0, 0, Math.PI * 2);
            ctx.fill();
            // Collar
            ctx.fillStyle = "red";
            ctx.fillRect(playerX + playerWidth/2 - 5, playerY + playerHeight/2 + 10, 10, 5);
        }

        // Spawn a new word
        function spawnWord() {
            const isGood = Math.random() > 0.4; // 60% chance of good word
            const text = isGood ? goodWords[Math.floor(Math.random() * goodWords.length)] : badWords[Math.floor(Math.random() * badWords.length)];
            const x = Math.random() * (canvas.width - 100);
            
            fallingWords.push({
                x: x,
                y: -30,
                text: text,
                isGood: isGood,
                width: ctx.measureText(text).width + 20
            });
        }

        // Update and draw words
        function updateAndDrawWords() {
            ctx.font = "bold 20px 'Inter'";
            
            for (let i = fallingWords.length - 1; i >= 0; i--) {
                let word = fallingWords[i];
                word.y += wordSpeed;

                // Draw word background
                ctx.fillStyle = word.isGood ? "#dcfce7" : "#fee2e2";
                ctx.strokeStyle = word.isGood ? "#16a34a" : "#dc2626";
                ctx.lineWidth = 2;
                
                const textWidth = ctx.measureText(word.text).width;
                const boxWidth = textWidth + 20;
                const boxHeight = 30;
                
                ctx.fillRect(word.x, word.y - 20, boxWidth, boxHeight);
                ctx.strokeRect(word.x, word.y - 20, boxWidth, boxHeight);

                // Draw text
                ctx.fillStyle = word.isGood ? "#166534" : "#991b1b";
                ctx.fillText(word.text, word.x + 10, word.y);

                // Collision detection
                if (
                    playerX < word.x + boxWidth &&
                    playerX + playerWidth > word.x &&
                    playerY < word.y + boxHeight &&
                    playerY + playerHeight > word.y - 20
                ) {
                    // Collision!
                    if (word.isGood) {
                        score += 1;
                        scoreDisplay.textContent = `WORDS: ${score}/10`;
                        if (score >= 10) {
                            endGame(true); // Win
                        }
                    } else {
                        endGame(false); // Lose
                    }
                    fallingWords.splice(i, 1); // Remove word
                    continue;
                }

                // Remove if off screen
                if (word.y > canvas.height) {
                    fallingWords.splice(i, 1);
                }
            }
        }

        // Main game loop
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear sky
            
            // Draw grass
            ctx.fillStyle = '#4ade80';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

            // Move player
            if (isMovingLeft && playerX > 0) playerX -= 5;
            if (isMovingRight && playerX < canvas.width - playerWidth) playerX += 5;

            drawPlayer();
            updateAndDrawWords();
        }

        // End the game
        function endGame(didWin) {
            clearInterval(gameLoop);
            clearInterval(spawnInterval);
            clearInterval(gameTimerInterval);
            
            if (didWin) {
                modalTitleText.textContent = "You Won!";
                modalBodyText.textContent = "Great job catching all the good words!";
            } else {
                modalTitleText.textContent = "Good Grief!";
                modalBodyText.textContent = `You caught a bad word! Keep trying!`;
            }
            gameOverModal.classList.remove('hidden');
        }

        // Start a new game
        function startGame() {
            // Reset state
            if (gameLoop) clearInterval(gameLoop);
            if (spawnInterval) clearInterval(spawnInterval);
            if (gameTimerInterval) clearInterval(gameTimerInterval);

            resizeCanvas();
            initPlayer();
            fallingWords = [];
            score = 0;
            timeLeft = 60;
            
            scoreDisplay.textContent = `WORDS: 0/10`;
            gameTimerDisplay.textContent = `TIME: 60`;
            gameOverModal.classList.add('hidden');

            // Start intervals
            gameLoop = setInterval(updateGame, 1000 / 60); // 60 FPS
            spawnInterval = setInterval(spawnWord, 1500); // New word every 1.5s
            
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                gameTimerDisplay.textContent = `TIME: ${timeLeft}`;
                if (timeLeft <= 0) {
                    endGame(false); // Lose due to time
                }
            }, 1000);
        }

        // Handle keyboard input
        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = true;
            if (e.code === 'ArrowRight') isMovingRight = true;
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = false;
            if (e.code === 'ArrowRight') isMovingRight = false;
        });
        
        // Handle mobile button input
        leftBtn.addEventListener('mousedown', () => isMovingLeft = true);
        leftBtn.addEventListener('mouseup', () => isMovingLeft = false);
        leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingLeft = true; });
        leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingLeft = false; });

        rightBtn.addEventListener('mousedown', () => isMovingRight = true);
        rightBtn.addEventListener('mouseup', () => isMovingRight = false);
        rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingRight = true; });
        rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingRight = false; });

        playAgainBtn.addEventListener('click', startGame);

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameLoop) {
                    resizeCanvas();
                    initPlayer(); // Recenter player on resize just in case
                }
            });
        });
    </script>
</body>

</html>
