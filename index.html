<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Updated Title -->
    <title>Dog Man: For Whom the Ball Rolls Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* Game Styles (Unchanged) */
        #game-canvas {
            background-color: #e0f2fe; /* Light blue sky */
            border: 4px solid #0284c7; /* Sky blue border */
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: grid !important;
            }
        }
        
        /* Modal Styles (Unchanged) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link (Unchanged) -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="./Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <!-- Updated Title -->
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Dog Man: For Whom the Ball Rolls</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section (Unchanged) -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <!-- *** UPDATED AND EXPANDED PASSAGE *** -->
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: The Ball of Fear</h2>

                <p class="mb-4">Our story, once again brought to life by George and Harold's amazing comics, begins with Dog Man on patrol. He's the city's greatest hero, a perfect blend of man and dog... well, *almost* perfect. While chasing a robber, Dog Man is doing great until the crook, in a moment of genius, rolls a simple red ball across the street. Dog Man's doggy instincts take over completely. He forgets all about the robber and happily chases the ball, barking with joy. The robber, of course, gets away easily. Back at the police station, the Chief is furious. This isn't the first time Dog Man's obsession with balls has caused a problem. "This has to stop!" the Chief yells. Dog Man, feeling ashamed, knows he needs help.</p>
                <p class="mb-6">His best friends, Li'l Petey (the world's kindest kitten) and 80-HD (their super-smart robot), decide to form the Supa Buddies to help Dog Man. Their first mission: cure Dog Man of his ball-chasing habit. They try everything. They try reasoning with him, but Dog Man just tilts his head. They try hiding all the balls, but he just finds round things to chase, like apples and the Chief's bald head. Finally, Li'l Petey has an idea. He finds a spray bottle and fills it with water. "This is a 'Bad Habit' spray bottle," he explains. "Every time you chase a ball, you get a spray!" The training begins. Li'l Petey rolls a ball. Dog Man chases it. *PSSSSHT!* Dog Man gets a spray of water in the face. This goes on all day. Roll, chase, *PSSSSHT!* Roll, chase, *PSSSSHT!* It seems to be working! Dog Man stops chasing the ball.</p>
                <p class="mb-6">The only problem is... it works *too* well. The next day, when the Chief throws a ball, Dog Man doesn't just ignore it. He screams in terror, leaps into the air, and crashes onto the Chief's desk, trembling. The training didn't just stop his habit; it replaced it with a deep, paralyzing fear. Now, even the *word* "ball" (or "call," "fall," or "mall") is enough to send him into a panic. Dog Man, the city's hero, is now afraid of balls.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Life and an Old Grudge</h3>

                <p class="mb-4">While Dog Man is dealing with his new phobia, his old enemy, Petey the Cat, is having the best day of his life. Because he helped save the city in the last adventure (from the giant Robo-Pants and the Supa-Soup Monster), the Mayor officially pardons him of all his crimes. Petey is finally a free cat! He joyfully leaves cat jail, ready to start a new life as a good guy and, most importantly, as a full-time dad to Li'l Petey. He takes Li'l Petey to his amazing secret lair, a giant hollowed-out volcano filled with cool inventions and comfy furniture. Petey is excited to be a real family. "No more evil schemes for me!" he declares. "From now on, I'm just going to be a good dad."</p>
                <p class="mb-6">Li'l Petey is happy, but he notices something. Whenever Petey talks about his own childhood, he gets quiet and sad. Li'l Petey, being the curious and kind kitten he is, asks 80-HD to do some research. The robot's computer brain quickly finds the secret: a long time ago, Petey's father, a mean-looking cat named Grampa, abandoned Petey when he was just a little kitten, leaving him all alone. Li'l Petey, with his pure heart, thinks, "If Petey is sad about his dad, then maybe finding his dad will make him happy!" This turns out to be a very bad idea. Without telling Petey, Li'l Petey uses 80-HD's technology to find Grampa's location and sends him an invitation for a family reunion at the secret lair.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Villain Rolls In</h3>

                <p class="mb-4">The next day, the doorbell rings. It's Grampa. And he is *not* a nice cat. He's rude, grumpy, and selfish. He immediately makes fun of Petey's lair, criticizes Petey for being "soft," and is a terrible influence on Li'l Petey, trying to teach him how to lie and steal. Petey is miserable. He's trying so hard to be a good dad, but his own mean father is making it impossible. The family reunion is a disaster. Grampa just sits on the couch, complaining and insulting everyone.</p>
                <p class="mb-6">While Petey's family drama unfolds, a new supervillain is watching the city. His name is Dr. Scum, and he has a brilliant, evil plan. From his blimp high above the city, he's been watching Dog Man. He sees Dog Man run in terror from a basketball, a gumball, and even a meatball. Dr. Scum cackles. "If the hero is afraid of balls," he says, "then I shall build an army of... BALLS!" He gets to work, and soon he unleashes his newest invention: the "Burgle Balls." These are high-tech, robotic spheres that roll through the city at high speed.  They smash into the jewelry store and steal all the diamonds. They roll into the bank and steal all the money. They even roll into the joke shop and steal every single whoopee cushion! The city is in chaos. Alarms are ringing everywhere. And where is Dog Man? He's hiding under his desk, too scared of the round, rolling villains to do anything to stop them.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Commander Cupcake?</h3>

                <p class="mb-4">With Dog Man out of action, the city is defenseless. Or is it? Elsewhere, the city's tiniest villains, the FLEAS (Piggy, Bub, and Crunky), are hatching their own plot. They've been trying to create a new supervillain, but all their plans fail. Then, they find Big Jim, a big, tough-looking (but not very smart) character. Using a "Hypno-Hat," they hypnotize him. "You are now... Commander Cupcake!" they declare. "Your mission is to... uh... do... evil things! But first, you have an uncontrollable craving for cupcakes!" Their plan is to use him to steal for them, but it immediately backfires. Commander Cupcake isn't evil; he's just obsessed with finding and eating cupcakes.</p>
                <p class="mb-6">He bumbles around the city, following the scent of sugary snacks. Just as Dr. Scum's Burgle Balls are finishing their robbery, Commander Cupcake spots a cupcake truck across the street. He runs straight towards it, accidentally crashing right through the Burgle Balls, smashing them to pieces. *CRASH!* *BAM!* The famous news reporter, Sarah Hatoff, arrives on the scene just in time to see the broken robots and Commander Cupcake standing among them, holding a cupcake. "Amazing!" she reports. "A new hero named Commander Cupcake has saved the city!" The next day, the newspaper headline reads: "COMMANDER CUPCAKE DEFEATS BURGLE BALLS! Dog Man Was 'Too Scared' to Help." Dog Man feels lower than ever. He failed, and an accidental "hero" got all the credit.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Being Good vs. Doing Good</h3>

                <p class="mb-4">Back at the volcano lair, things are even worse for Petey. While he's trying to cope with his terrible father, Grampa plays one last, cruel trick. He tells Petey he wants to "help him" load up his old, "junky" inventions into a truck to take them to the dump. But as soon as the truck is full of Petey's most valuable gadgets, Grampa hops in the driver's seat. "You'll never change, Petey!" Grampa sneers. "You were born a bad guy, and you'll always be a bad guy! So long, loser!" And he drives off, stealing everything. Petey is heartbroken. He falls to his knees, believing his father is right. Maybe he really is just a bad guy.</p>
                <p class="mb-6">But Li'l Petey, who sees the whole thing, runs up to his dad and gives him a hug. "That's not true, Papa!" he says. "You're a good dad! But Grampa doesn't get it." Then, Li'l Petey says the most important words in the whole book: **"It's not enough to just *be* good... you gotta *do* good!"** This simple sentence clicks in Petey's brain. It's like a lightbulb turning on. He's right. It's not about what his father says he is; it's about what he *chooses* to do. At that very same moment, Dog Man is at the police station, feeling sorry for himself. He hears Li'l Petey's voice (over a communicator) and has the exact same realization. He can't let his fear *stop* him from *doing* good. He's a police officer, and his friends are in danger.</p>
                <p class="mb-6">Just then, Dr. Scum returns, and he is furious. His Burgle Balls are gone, so he's back with his ultimate weapon: a giant, flying "Death Sphere" (which, of course, is just a giant, terrifying ball).  It hovers over the city, threatening to destroy everything. Commander Cupcake tries to "fight" it by throwing cupcakes, which does nothing. The city is doomed. But then, a blue and red streak flies through the sky. It's Dog Man! He is visibly shaking with fear, but he's flying straight towards the giant ball. Remembering Li'l Petey's words, he bravely faces his fear to *do* good. He lands on the sphere, finds Dr. Scum, and after a long fight, he and 80-HD manage to defeat the villain and save the city for real! </p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A True Hero, A True Dad</h3>
                
                <p class="mb-4">At the exact same time, Petey *does* good, too. He catches up to Grampa's truck. But instead of fighting his father, he uses a clever invention to non-violently stop the truck and get his stuff back. He looks at his mean old dad, who is now helpless. Petey has a choice: he could get revenge, or he could just be a good dad to Li'l Petey. He chooses his son. He lets Grampa go, telling him he just feels sorry for him. Petey has finally broken the cycle. He proved he isn't a bad guy; he's a good dad.</p>
                <p class="mb-6">In the end, Dog Man is celebrated as the true hero he is, having overcome his fear when it mattered most. Sarah Hatoff corrects the newspaper, giving Dog Man the credit he deserves. And Petey? He and Li'l Petey return to their lair (what's left of it) happier than ever, knowing they are a real family. The story ends with Dog Man, Petey, and Li'l Petey all understanding that being a hero isn't about *being* fearless; it's about *doing* good, even when you're scared. (And as for Commander Cupcake? The last we see him, he's happily found and is eating all the stolen whoopee cushions, still as clueless as ever.)</p>
            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Play the Chase Game!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section (Unchanged) -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Dog Man Chase!</h1>
                <p class="text-gray-600">Use the arrow keys or buttons to help Dog Man catch Petey! Dodge the bombs!</p>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                 <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>
            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden grid grid-cols-3 gap-2 w-48 mt-6">
                <div></div> <!-- Top-left empty -->
                <button id="up-btn" class="control-button w-full">â–²</button>
                <div></div> <!-- Top-right empty -->
                
                <button id="left-btn" class="control-button w-full">â—€</button>
                <div></div> <!-- Middle-center empty -->
                <button id="right-btn" class="control-button w-full">â–¶</button>
                
                <div></div> <!-- Bottom-left empty -->
                <button id="down-btn" class="control-button w-full">â–¼</button>
                <div></div> <!-- Bottom-right empty -->
            </div>


            <div id="win-message" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 class="text-3xl font-bold mb-4 text-yellow-700 header-font">You Caught Petey!</h2>
                    <p class="text-gray-800 text-lg mb-6">Great job, hero!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Updated Quiz Data (Still relevant to the expanded story) ---
        const allQuestions = [{
            id: 'q1',
            questionText: 'What is Dog Man\'s big problem at the beginning of the story?',
            options: [{ value: 'A', text: 'He is afraid of water.' }, { value: 'B', text: 'He cannot resist chasing balls.' }, { value: 'C', text: 'He is allergic to cats.' }, { value: 'D', text: 'He lost his police badge.' }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What happens after Li\'l Petey sprays Dog Man with water for chasing balls?',
            options: [{ value: 'A', text: 'Dog Man learns to fetch perfectly.' }, { value: 'B', text: 'Dog Man becomes terrified of balls.' }, { value: 'C', text: 'Dog Man gets angry at Li\'l Petey.' }, { value: 'D', text: 'Dog Man learns to talk.' }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'Who is the new supervillain that attacks the city?',
            options: [{ value: 'A', text: 'Grampa' }, { value: 'B', text: 'Commander Cupcake' }, { value: 'C', text: 'Dr. Scum' }, { value: 'D', text: 'Big Jim' }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'What evil invention does Dr. Scum use to steal things?',
            options: [{ value: 'A', text: 'Robotic Burgle Balls' }, { value: 'B', text: 'A giant magnet' }, { value: 'C', text: 'An invisibility spray' }, { value: 'D', text: 'Hypnotized birds' }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'Why is Dr. Scum\'s invention so successful at first?',
            options: [{ value: 'A', text: 'The balls are too fast for Dog Man.' }, { value: 'B', text: 'Dog Man is too scared of the balls to fight them.' }, { value: 'C', text: 'The police are on vacation.' }, { value: 'D', text: 'Petey helps the villain.' }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What good thing happens to Petey near the start of the book?',
            options: [{ value: 'A', text: 'He learns to build a robot.' }, { value: 'B', text: 'He is pardoned and set free from jail.' }, { value: 'C', text: 'He finds a hidden treasure.' }, { value: 'D', text: 'He becomes the new police chief.' }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'Who does Li\'l Petey find and invite to the secret lair?',
            options: [{ value: 'A', text: 'Sarah Hatoff, the reporter' }, { value: 'B', text: 'The Mayor' }, { value: 'C', text: 'Petey\'s father, Grampa' }, { value: 'D', text: 'Dog Man' }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'Who are the tiny villains that create Commander Cupcake?',
            options: [{ value: 'A', text: 'Dr. Scum\'s robots' }, { value: 'B', text: 'Petey and Li\'l Petey' }, { value: 'C', text: 'The FLEAS (Piggy, Bub, and Crunky)' }, { value: 'D', text: 'The Supa Buddies' }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'What important lesson does Li\'l Petey teach Petey and Dog Man?',
            options: [{ value: 'A', text: 'That crime always pays.' }, { value: 'B', text: 'That balls are not scary.' }, { value: 'C', text: 'That it\'s not enough to "be good," you have to "do good."' }, { value: 'D', text: 'How to build a better robot.' }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'What does Grampa (Petey\'s father) do at the end of the story?',
            options: [{ value: 'A', text: 'He apologizes to Petey.' }, { value: 'B', text: 'He helps Dog Man fight Dr. Scum.' }, { value: 'C', text: 'He becomes a good guy.' }, { value: 'D', text: 'He steals Petey\'s inventions and furniture.' }],
            type: 'radio'
        }];

        // --- Updated Correct Answers ---
        const correctAnswers = {
            q1: "B",
            q2: "B",
            q3: "C",
            q4: "A",
            q5: "B",
            q6: "B",
            q7: "C",
            q8: "C",
            q9: "C",
            q10: "D"
        };

        // --- Unchanged JavaScript Logic Below ---

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            // *** THIS IS THE CORRECTED LINE ***
            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- DOG MAN CHASE GAME LOGIC (Unchanged) ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const winMessage = document.getElementById('win-message');
        const playAgainBtn = document.getElementById('playAgainBtn');

        let isGameActive = false;
        let animationFrameId;
        const keys = {};

        const player = { x: 0, y: 0, width: 40, height: 40, speed: 4, symbol: 'ðŸ¶' };
        const petey = { x: 0, y: 0, width: 40, height: 40, speed: 2, symbol: 'ðŸ±' };
        const obstacles = [];
        const obstacleSize = 20;
        let peteyThrowInterval;

        function resetGame() {
            // Stop any active game processes
            isGameActive = false;
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            clearInterval(peteyThrowInterval);

            // Hide win message and clear obstacles
            winMessage.classList.add('hidden');
            obstacles.length = 0;

            // Set initial positions for drawing during countdown
            player.x = 50;
            player.y = canvas.height / 2 - player.height / 2;
            petey.x = canvas.width - 50 - petey.width;
            petey.y = canvas.height / 2 - petey.height / 2;

            function drawStaticFrame() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#65a30d'; // Grassy green
                ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
                ctx.font = '40px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
                ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            }

            function drawCountdownText(text) {
                drawStaticFrame(); // Draw the background first
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.font = 'bold 96px Bangers, cursive';
                ctx.fillStyle = '#ffffff';
                ctx.strokeStyle = '#27272a';
                ctx.lineWidth = 6;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeText(text, canvas.width / 2, canvas.height / 2);
                ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            }

            let count = 3;
            drawCountdownText(count); // Draw initial "3"

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    drawCountdownText(count);
                } else if (count === 0) {
                    drawCountdownText('GO!');
                } else {
                    clearInterval(countdownInterval);
                    // --- START THE ACTUAL GAME ---
                    isGameActive = true;
                    if (!animationFrameId) {
                        gameLoop();
                    }
                    peteyThrowInterval = setInterval(() => {
                        if (!isGameActive) return;
                        obstacles.push({
                            x: petey.x,
                            y: petey.y + petey.height / 2,
                            width: obstacleSize,
                            height: obstacleSize,
                            speed: 5,
                            symbol: 'ðŸ’£'
                        });
                    }, 1200);
                }
            }, 1000);
        }
        
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function gameLoop() {
            if (!isGameActive) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                return;
            }

            // Update player position
            if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
            if (keys['ArrowDown'] && player.y < canvas.height - player.height) player.y += player.speed;
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;

            // Update Petey's position (simple AI)
            if (player.y < petey.y && petey.y > 0) {
                petey.y -= petey.speed;
            } else if (player.y > petey.y && petey.y < canvas.height - petey.height) {
                petey.y += petey.speed;
            }

            // Update obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.x -= obstacle.speed;
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1); // Remove obstacle if it's off-screen
                }
            }

            // Check for collisions
            // 1. Dog Man hits a bomb
            for (const obstacle of obstacles) {
                if (checkCollision(player, obstacle)) {
                    resetGame(); // Restart the game
                    return; // Exit loop for this frame
                }
            }
            // 2. Dog Man catches Petey
            if (checkCollision(player, petey)) {
                isGameActive = false;
                winMessage.classList.remove('hidden');
            }

            // --- DRAW EVERYTHING ---
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw ground
            ctx.fillStyle = '#65a30d'; // Grassy green
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // Draw characters and obstacles
            ctx.font = '40px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
            ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            
            ctx.font = '20px sans-serif';
            obstacles.forEach(obstacle => {
                 ctx.fillText(obstacle.symbol, obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2);
            });


            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // --- EVENT LISTENERS FOR GAME ---
        document.addEventListener('keydown', e => {
             if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
        });
        document.addEventListener('keyup', e => { keys[e.key] = false; });
        
        playAgainBtn.addEventListener('click', resetGame);

        // Mobile Controls
        const controlButtons = {
            'up-btn': 'ArrowUp', 'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft', 'right-btn': 'ArrowRight'
        };

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            const key = controlButtons[id];
            btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mouseleave', (e) => { keys[key] = false; });
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            const size = container.clientWidth;
            canvas.width = size;
            canvas.height = size;
            if (isGameActive) {
                resetGame();
            }
        }

        function initGame() {
            resizeCanvas();
            resetGame();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', resizeCanvas);
        });
    </script>
</body>

</html>

