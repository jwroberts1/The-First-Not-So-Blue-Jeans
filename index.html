<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peanuts: Heroes of History</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* --- NEW GAME STYLES --- */
        #game-canvas {
            background: #87CEEB; /* Sky Blue */
            border-bottom: 60px solid #4ade80; /* Grass */
            border-left: 4px solid #3b82f6;
            border-right: 4px solid #3b82f6;
            border-top: 4px solid #3b82f6;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
            width: 100%;
            height: 100%;
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-3xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
            width: 80px;
            height: 80px;
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center; /* Corrected 'align: center' */
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Peanuts: Heroes of History</h1>
        <p class="text-gray-600 text-center mb-8">Charlie Brown and friends learn about the giants of the Civil Rights Movement.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-base sm:text-lg border border-gray-200">
                
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 1: The Assignment</h2>
                <p class="mb-4">It was a rainy Tuesday, and the mood in the classroom was gray. But then, Franklin stood up to give his report. He didn't talk about baseball or comics. He talked about history. "The Civil Rights Movement changed everything," Franklin said, holding up a picture of a man. "It wasn't just one person. It was many brave people fighting for fairness."</p>
                <p class="mb-4">Charlie Brown leaned forward. Usually, he worried about lunch or spelling tests, but this was interesting. Franklin talked about Dr. Martin Luther King Jr., a man who used words like swords to fight injustice. He talked about how Dr. King had a dream that people would be judged by their character, not the color of their skin. "That sounds like a good rule for everyone," Linus whispered, clutching his blanket.</p>
                <p class="mb-4">After class, the gang gathered at the wall. "I never knew there were so many leaders," Charlie Brown said. "I thought it was just speeches." "Oh no, Charlie Brown," Franklin said. "It was marching, and sitting in at lunch counters, and being brave when people were mean. There were other leaders too, like Malcolm X and Fred Hampton. They had different ideas on how to get freedom, but they all wanted the same thing: respect."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 2: Different Voices</h2>
                <p class="mb-4">"Malcolm X?" Lucy asked, looking up from her comic book. "That sounds like a superhero name." "He was a hero to many," Franklin explained. "He believed that you shouldn't just wait for people to be nice to you. You have to stand up for yourself. He was very strong and spoke with power."</p>
                <p class="mb-4">Linus adjusted his glasses. "And Fred Hampton," he added, having done some reading of his own in the library. "He was very young, not much older than a teenager when he started leading. He believed in bringing everyone together—the 'Rainbow Coalition.' He wanted to feed hungry kids and make sure everyone had doctors."</p>
                <p class="mb-4">Snoopy, who had been sleeping on top of his doghouse nearby, pricked up his ears at the word "feed." He hopped down and marched over, pretending to hold a sign. He did a little march back and forth. "Look at that beagle," Charlie Brown sighed. "Even my dog wants to join the movement." "He's practicing civil disobedience," Linus noted. "Or maybe he just wants supper."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 3: The Library Project</h2>
                <p class="mb-4">The teacher, Miss Othmar (or *Wah-Wah-Wah* as she sounded to the kids), assigned a group project. They had to make a display about these heroes. Charlie Brown, Linus, Franklin, and Peppermint Patty were in a group. "We need to make this great," Peppermint Patty said, slamming her fist on the table. "We need action! Drama! A slide rule!" "I think you mean a slide show, Sir," Marcie corrected gently.</p>
                <p class="mb-4">They went to the library. Charlie Brown was in charge of cutting out letters for the poster. He was nervous. "What if I spell 'Freedom' wrong?" he worried. "What if I glue my hand to the paper?" "Just do your best, Chuck," Peppermint Patty encouraged him. "Think about how brave these people were. Dr. King marched in front of thousands. You can handle some glue."</p>
                <p class="mb-4">They learned that it wasn't easy. Dr. King was arrested many times for peaceful protests. Malcolm X had a hard life before he became a leader. Fred Hampton faced great danger for his beliefs. "They were really brave," Charlie Brown said quietly. "I get scared just trying to kick a football." "That's why they are heroes, Charlie Brown," Linus said. "Bravery isn't not being scared. It's being scared and doing the right thing anyway."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 4: The School Play</h2>
                <p class="mb-4">Instead of just a poster, the gang decided to put on a small play. Franklin played Dr. King. He stood on a box and spoke in a deep, steady voice. "I have a dream!" he shouted. The other kids cheered. Then Linus stood up. He played a young student marching for rights. He held a sign that said "Justice for All."</p>
                <p class="mb-4">Even Lucy got involved. She played a reporter interviewing the leaders. "So, Mr. Malcolm X," she said into a pretend microphone (which was actually a hairbrush), "tell us why education is so important." She used her loudest, bossiest voice, but it fit the part perfectly.</p>
                <p class="mb-4">Snoopy had the best role of all. He didn't have any lines, but he wore a little hat and carried a basket of food, representing Fred Hampton's "Free Breakfast for Children" program. He handed out imaginary toast to Woodstock and his bird friends. It was a serious topic, but Snoopy made everyone smile, showing that helping people can be joyful.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 5: Lessons Learned</h2>
                <p class="mb-4">After the play, the kids sat in a circle. "I learned a lot," Sally said. "I learned that history isn't just boring dates. It's about real people." "And it's about fairness," Schroeder added. "Like how everyone should get a turn to play the piano, no matter who they are."</p>
                <p class="mb-4">Charlie Brown looked at Franklin. "Thanks for telling us about this, Franklin. I didn't know about Fred Hampton or how many different people fought for rights." Franklin smiled. "That's why we share stories, Charlie Brown. So we don't forget. And so we know what to do next."</p>
                <p class="mb-4">"What do we do next?" Charlie Brown asked. "We be kind," Linus said simply. "We stand up for each other. If someone is being mean to Franklin, or you, or anyone, we say 'Stop it.' That's what Dr. King would want."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 6: A Better Tomorrow</h2>
                <p class="mb-4">That evening, the sun set over the neighborhood, painting the sky pink and purple. Charlie Brown and Linus leaned against their brick wall. "You know, Linus," Charlie Brown said, "I think I can be a little braver now. Maybe I won't lead a march tomorrow, but I can be brave enough to talk to the Little Red-Haired Girl."</p>
                <p class="mb-4">"That's a start, Charlie Brown," Linus said, wrapping his blanket around his shoulders. "Every big change starts with a small step." Snoopy hopped up onto the wall and sat between them, looking at the moon. He thought about the heroes they learned about. He decided that tomorrow, he would be a better beagle. Maybe he would even share his supper dish with the cat next door. (Well, maybe not the *whole* dish).</p>
                <p class="mb-4">The world seemed a little bigger, a little more complicated, but also a little more hopeful. The Peanuts gang knew that they were just kids, but they also knew that kids could change the world. They sat together in silence, grateful for the heroes of the past who paved the way for their friendship today.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 shadow-md hidden">
                    Congratulations! Play Snoopy's Word Catcher!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- --- GAME SECTION: Snoopy's Word Catcher --- -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            
            <div id="game-info" class="mb-4 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Snoopy's Word Catcher!</h1>
                <p class="text-gray-600">Catch 10 <span class="text-green-600 font-bold">GOOD</span> words (freedom, justice, peace) to win! Avoid the <span class="text-red-600 font-bold">BAD</span> words (hate, fear, unfair)!</p>
            </div>

            <!-- Game Stats -->
            <div class="flex justify-between w-full max-w-xl mb-2 px-4 text-gray-800 game-font text-2xl">
                <div id="score-display">WORDS: 0/10</div>
                <div id="timer-display">TIME: 60</div>
            </div>

            <!-- Game Canvas -->
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-[4/3] overflow-hidden rounded-lg">
                 <canvas id="game-canvas"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex justify-center space-x-12 w-full mt-6">
                <button id="left-btn" class="control-button">◄</button>
                <button id="right-btn" class="control-button">►</button>
            </div>

            <!-- Game Over Modal -->
            <div id="game-over-modal" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 id="modal-title-text" class="text-3xl font-bold mb-4 text-yellow-700 header-font">Good Grief!</h2>
                    <p id="modal-body-text" class="text-gray-800 text-lg mb-6">Game Over!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- NEW QUIZ DATA (Based on Civil Rights Story) ---
        const allQuestions = [
            {
                id: 'q1',
                questionText: "Who gave the report about the Civil Rights Movement?",
                options: [
                    { value: 'A', text: 'Charlie Brown.' },
                    { value: 'B', text: 'Franklin.' },
                    { value: 'C', text: 'Lucy.' },
                    { value: 'D', text: 'Snoopy.' }
                ],
                type: 'radio'
            },
            {
                id: 'q2',
                questionText: "What was Dr. Martin Luther King Jr.'s dream?",
                options: [
                    { value: 'A', text: 'To become a famous baseball player.' },
                    { value: 'B', text: 'That people would be judged by their character, not their skin color.' },
                    { value: 'C', text: 'To fly to the moon.' },
                    { value: 'D', text: 'To write a comic book.' }
                ],
                type: 'radio'
            },
            {
                id: 'q3',
                questionText: "What did Malcolm X believe people should do?",
                options: [
                    { value: 'A', text: 'Wait quietly.' },
                    { value: 'B', text: 'Stand up for themselves and speak with power.' },
                    { value: 'C', text: 'Hide from problems.' },
                    { value: 'D', text: 'Only write letters.' }
                ],
                type: 'radio'
            },
            {
                id: 'q4',
                questionText: "What was Fred Hampton's goal?",
                options: [
                    { value: 'A', text: 'To start a band.' },
                    { value: 'B', text: 'To bring everyone together and feed hungry children.' },
                    { value: 'C', text: 'To become a doctor.' },
                    { value: 'D', text: 'To build a big house.' }
                ],
                type: 'radio'
            },
            {
                id: 'q5',
                questionText: "What did Snoopy do during the lesson?",
                options: [
                    { value: 'A', text: 'He slept the whole time.' },
                    { value: 'B', text: 'He chased a cat.' },
                    { value: 'C', text: 'He marched like he was in a protest.' },
                    { value: 'D', text: 'He flew his doghouse.' }
                ],
                type: 'radio'
            },
            {
                id: 'q6',
                questionText: "What role did Snoopy play in the school play?",
                options: [
                    { value: 'A', text: 'A reporter.' },
                    { value: 'B', text: 'Dr. King.' },
                    { value: 'C', text: 'Someone handing out free breakfast.' },
                    { value: 'D', text: 'A tree.' }
                ],
                type: 'radio'
            },
            {
                id: 'q7',
                questionText: "Why was Charlie Brown nervous about the project?",
                options: [
                    { value: 'A', text: 'He thought he would spell "Freedom" wrong or glue his hand.' },
                    { value: 'B', text: 'He didn\'t like history.' },
                    { value: 'C', text: 'He was afraid of Lucy.' },
                    { value: 'D', text: 'He wanted to play baseball instead.' }
                ],
                type: 'radio'
            },
            {
                id: 'q8',
                questionText: "What did Linus say bravery is?",
                options: [
                    { value: 'A', text: 'Never being scared.' },
                    { value: 'B', text: 'Being the strongest person.' },
                    { value: 'C', text: 'Being scared but doing the right thing anyway.' },
                    { value: 'D', text: 'Running away fast.' }
                ],
                type: 'radio'
            },
            {
                id: 'q9',
                questionText: "What did the kids decide to do next to honor the heroes?",
                options: [
                    { value: 'A', text: 'Go to sleep.' },
                    { value: 'B', text: 'Be kind and stand up for each other.' },
                    { value: 'C', text: 'Watch TV.' },
                    { value: 'D', text: 'Eat more pizza.' }
                ],
                type: 'radio'
            },
            {
                id: 'q10',
                questionText: "What is the main theme of the story?",
                options: [
                    { value: 'A', text: 'Winter is cold.' },
                    { value: 'B', text: 'History is just boring dates.' },
                    { value: 'C', text: 'Learning about heroes inspires us to be better.' },
                    { value: 'D', text: 'School plays are hard work.' }
                ],
                type: 'radio'
            }
        ];

        // --- NEW Correct Answers ---
        const correctAnswers = {
            q1: "B",
            q2: "B",
            q3: "B",
            q4: "B",
            q5: "C",
            q6: "C",
            q7: "A",
            q8: "C",
            q9: "B",
            q10: "C"
        };


        // --- ALL SCRIPTING BELOW THIS LINE IS UNCHANGED ---

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            startGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- SNOOPY'S WORD CATCHER GAME LOGIC ---

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const gameTimerDisplay = document.getElementById('timer-display');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalBodyText = document.getElementById('modal-body-text');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');

        // Game constants
        const playerWidth = 60;
        const playerHeight = 60;
        const gravity = 0; // Not a jumping game
        const wordSpeed = 3;
        
        // Words data - Updated to catch GOOD values
        const goodWords = ["FREEDOM", "JUSTICE", "PEACE", "HOPE", "LOVE", "TRUTH", "DREAM", "RIGHTS"];
        const badWords = ["HATE", "FEAR", "UNFAIR", "ANGRY", "MEAN", "STOP", "NO", "BAD"];

        // Game state variables
        let playerX;
        let playerY;
        let fallingWords = [];
        let score = 0;
        let timeLeft = 60;
        let gameLoop;
        let spawnInterval;
        let gameTimerInterval;
        let isMovingLeft = false;
        let isMovingRight = false;

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            playerY = canvas.height - playerHeight - 10;
        }

        // Initialize player position
        function initPlayer() {
            playerX = canvas.width / 2 - playerWidth / 2;
        }

        // Draw Snoopy (simplified as a white box with black ears for now, or text)
        function drawPlayer() {
            // Draw Snoopy-like shape
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth/2, playerY + playerHeight/2, playerWidth/2, playerHeight/3, 0, 0, Math.PI * 2);
            ctx.fill();
            // Ear
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.ellipse(playerX + 20, playerY + playerHeight/2, 10, 15, 0, 0, Math.PI * 2);
            ctx.fill();
            // Nose
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth - 10, playerY + playerHeight/2 - 5, 5, 5, 0, 0, Math.PI * 2);
            ctx.fill();
            // Collar
            ctx.fillStyle = "red";
            ctx.fillRect(playerX + playerWidth/2 - 5, playerY + playerHeight/2 + 10, 10, 5);
        }

        // Spawn a new word
        function spawnWord() {
            const isGood = Math.random() > 0.4; // 60% chance of good word
            const text = isGood ? goodWords[Math.floor(Math.random() * goodWords.length)] : badWords[Math.floor(Math.random() * badWords.length)];
            const x = Math.random() * (canvas.width - 100);
            
            fallingWords.push({
                x: x,
                y: -30,
                text: text,
                isGood: isGood,
                width: ctx.measureText(text).width + 20
            });
        }

        // Update and draw words
        function updateAndDrawWords() {
            ctx.font = "bold 20px 'Inter'";
            
            for (let i = fallingWords.length - 1; i >= 0; i--) {
                let word = fallingWords[i];
                word.y += wordSpeed;

                // Draw word background
                ctx.fillStyle = word.isGood ? "#dcfce7" : "#fee2e2";
                ctx.strokeStyle = word.isGood ? "#16a34a" : "#dc2626";
                ctx.lineWidth = 2;
                
                const textWidth = ctx.measureText(word.text).width;
                const boxWidth = textWidth + 20;
                const boxHeight = 30;
                
                ctx.fillRect(word.x, word.y - 20, boxWidth, boxHeight);
                ctx.strokeRect(word.x, word.y - 20, boxWidth, boxHeight);

                // Draw text
                ctx.fillStyle = word.isGood ? "#166534" : "#991b1b";
                ctx.fillText(word.text, word.x + 10, word.y);

                // Collision detection
                if (
                    playerX < word.x + boxWidth &&
                    playerX + playerWidth > word.x &&
                    playerY < word.y + boxHeight &&
                    playerY + playerHeight > word.y - 20
                ) {
                    // Collision!
                    if (word.isGood) {
                        score += 1;
                        scoreDisplay.textContent = `WORDS: ${score}/10`;
                        if (score >= 10) {
                            endGame(true); // Win
                        }
                    } else {
                        endGame(false); // Lose
                    }
                    fallingWords.splice(i, 1); // Remove word
                    continue;
                }

                // Remove if off screen
                if (word.y > canvas.height) {
                    fallingWords.splice(i, 1);
                }
            }
        }

        // Main game loop
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear sky
            
            // Draw grass
            ctx.fillStyle = '#4ade80';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

            // Move player
            if (isMovingLeft && playerX > 0) playerX -= 5;
            if (isMovingRight && playerX < canvas.width - playerWidth) playerX += 5;

            drawPlayer();
            updateAndDrawWords();
        }

        // End the game
        function endGame(didWin) {
            clearInterval(gameLoop);
            clearInterval(spawnInterval);
            clearInterval(gameTimerInterval);
            
            if (didWin) {
                modalTitleText.textContent = "You Won!";
                modalBodyText.textContent = "Great job catching all the good words!";
            } else {
                modalTitleText.textContent = "Good Grief!";
                modalBodyText.textContent = `You caught a bad word! Keep trying!`;
            }
            gameOverModal.classList.remove('hidden');
        }

        // Start a new game
        function startGame() {
            // Reset state
            if (gameLoop) clearInterval(gameLoop);
            if (spawnInterval) clearInterval(spawnInterval);
            if (gameTimerInterval) clearInterval(gameTimerInterval);

            resizeCanvas();
            initPlayer();
            fallingWords = [];
            score = 0;
            timeLeft = 60;
            
            scoreDisplay.textContent = `WORDS: 0/10`;
            gameTimerDisplay.textContent = `TIME: 60`;
            gameOverModal.classList.add('hidden');

            // Start intervals
            gameLoop = setInterval(updateGame, 1000 / 60); // 60 FPS
            spawnInterval = setInterval(spawnWord, 1500); // New word every 1.5s
            
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                gameTimerDisplay.textContent = `TIME: ${timeLeft}`;
                if (timeLeft <= 0) {
                    endGame(false); // Lose due to time
                }
            }, 1000);
        }

        // Handle keyboard input
        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = true;
            if (e.code === 'ArrowRight') isMovingRight = true;
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = false;
            if (e.code === 'ArrowRight') isMovingRight = false;
        });
        
        // Handle mobile button input
        leftBtn.addEventListener('mousedown', () => isMovingLeft = true);
        leftBtn.addEventListener('mouseup', () => isMovingLeft = false);
        leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingLeft = true; });
        leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingLeft = false; });

        rightBtn.addEventListener('mousedown', () => isMovingRight = true);
        rightBtn.addEventListener('mouseup', () => isMovingRight = false);
        rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingRight = true; });
        rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingRight = false; });

        playAgainBtn.addEventListener('click', startGame);

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameLoop) {
                    resizeCanvas();
                    initPlayer(); // Recenter player on resize just in case
                }
            });
        });
    </script>
</body>

</html>
