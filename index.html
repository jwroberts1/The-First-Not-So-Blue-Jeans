<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Children of the Vault and the Great Vault Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* Styles for the Vault Hunter's game */
        #game-canvas {
            background-color: #333;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        #game-info {
            background-color: #222;
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #555;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(34, 34, 34, 0.95);
            padding: 2.5rem;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            text-align: center;
            z-index: 1000;
            border-radius: 15px;
        }

        .message-box button {
            background-color: #f59e0b;
            color: #1a1a1a;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .message-box button:hover {
            background-color: #d97706;
            transform: scale(1.05);
        }

        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent;
            /* Removes blue highlight on tap */
        }

        /* Media query to show controls on screens smaller than large desktops */
        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Children of the Vault and the Great Vault Quiz</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: The Calypso Twins and the Great Vault</h2>

                <p class="mb-4">Many years had passed since the brave Vault Hunters defeated Handsome Jack and saved the world of Pandora. The planet was still a dangerous place, full of strange creatures and wild bandits, but it was safe from Jack's evil plans. However, a new and different kind of trouble was beginning to bubble up. Across the galaxy, a new group called the Children of the Vault, or COV for short, was growing. They were a massive cult of bandits, all united by their leaders: the Calypso Twins, Troy and Tyreen.</p>
                <p class="mb-6">Troy and Tyreen were not like any villains the galaxy had seen before. They were famous streamers, using the ECHOnet to broadcast their wild adventures and powerful abilities to millions of followers. They were both Sirens, people born with incredible magical powers. Their special Siren power was the most dangerous of all: they could drain the life force and even the powers from other living things, making themselves stronger. Their goal was to find the legendary "Great Vault," a place rumored to hold a power so immense it could turn them into gods. With all the bandit clans of Pandora now following their every command, they were closer than ever to achieving their goal.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Call for New Heroes</h3>

                <p class="mb-4">Back on Pandora, Lilith, the legendary Vault Hunter known as the Firehawk, knew something had to be done. She was the commander of the Crimson Raiders, a group of heroes dedicated to protecting the innocent. Realizing the Calypso Twins were too great a threat to ignore, she sent out a call across the galaxy for new Vault Hunters to join her cause. Four new heroes answered the call: Amara, a Siren who could summon giant magical fists; Zane, a super-spy with an army of gadgets; Moze, a soldier with a giant walking mech named Iron Bear; and FL4K, a robot beastmaster with loyal pet monsters.</p>
                <p class="mb-6">The new Vault Hunters arrived on Pandora and quickly met up with Lilith. But their first mission went terribly wrong. The Calypso Twins ambushed them. In a shocking display of power, Tyreen Calypso used her ability to drain Lilith completely, stealing her amazing Siren powers and leaving her helpless. The Crimson Raiders were defeated and forced to run. It was a terrible loss, but it gave them a new mission and a new home. They escaped Pandora on an old spaceship called Sanctuary III. After some repairs, this ship became their flying base of operations, a home from which they could travel the stars and take the fight to the Calypsos.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Galaxy-Spanning Hunt</h3>

                <p class="mb-4">From the bridge of Sanctuary III, the Crimson Raiders learned the Calypsos' plan. To open the Great Vault, they needed to find four special Vault Keys, each one hidden on a different planet. The race was on. The Vault Hunters' first stop was the planet Promethea, a giant city covered in futuristic skyscrapers and flying vehicles. But when they arrived, they found a planet at war. The Maliwan corporation, with its army of high-tech soldiers, was attacking the Atlas corporation, which was led by an old friend, Rhys Strongfork.</p>
                <p class="mb-4">The Vault Hunters had to fight their way through the war-torn streets, helping Rhys defend his company while searching for the first Vault Key. They eventually found it, but their victory came at a heartbreaking cost. Maya, one of the original Vault Hunters and a wise Siren, was mentoring a young girl named Ava. When the Calypso Twins arrived to take the key, Maya fought bravely to protect her student. But in the chaos, Troy Calypso managed to grab Maya and use his newfound power to drain her life force, killing her instantly and stealing her powers. The loss of Maya was a dark moment for the Crimson Raiders, but it made them even more determined to stop the twins.</p>
                <p class="mb-6">Their quest continued across the galaxy. They traveled to the quiet, peaceful planet of Athenas, where an order of monks protected another secret. Then, they flew to the swampy jungle world of Eden-6. This planet was home to the famous Jakobs corporation, known for making powerful, old-fashioned guns. There, they met Wainwright Jakobs, the brave new leader of the company, and helped him fight off both ravenous dinosaurs and COV bandits who were trying to steal his family's secrets. On these new worlds, they reunited with old allies like the ninja assassin Zer0 and made new ones, all of whom joined the growing fight against the Calypsos.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Final Key and a Daring Rescue</h3>

                <p class="mb-4">The Crimson Raiders' own super-scientist, Patricia Tannis, had been helping them all along. Tannis had been studying the Eridians, the ancient aliens who built the Vaults, for years. She was the only one smart enough to figure out how to use the key fragments they had collected. But the Calypso Twins knew how important she was. They staged a surprise attack and captured Tannis, taking her back to their main fortress on Pandora.</p>
                <p class="mb-6">The Vault Hunters knew they had to get her back. They launched a massive assault on the COV headquarters. The battle was fierce, but they fought their way deep into the enemy base and rescued Tannis. While escaping, they discovered the location of the final Vault Key fragment. With all four pieces now in their possession, Tannis was able to combine them. The completed Vault Key showed them a secret map, revealing the hidden location of the Great Vault, right back where their journey began: on Pandora.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Great Vault Opens</h3>

                <p class="mb-4">Returning to Pandora, the Vault Hunters followed the map to a deep, hidden Eridian ruin. They fought through the last of the Calypsos' guards and confronted the twins at the entrance to the Great Vault. It was then that the horrible truth was revealed. The Great Vault was not a treasure chest filled with weapons or gold. It was a cosmic prison, built to contain a monster of unimaginable power: the Destroyer, the same creature the first Vault Hunters had fought years ago, now even more powerful.</p>
                <p class="mb-6">The Calypsos' insane plan was finally clear. They didn't want what was inside the Vault; they wanted to become the Vault's monster. By opening the prison and merging with the Destroyer, they believed they would gain ultimate power and become living gods. In a final battle, the Vault Hunters managed to defeat Troy, but it was too late. Tyreen completed the ritual and merged with the Destroyer, transforming into a colossal, terrifying monster: Tyreen the Destroyer.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Siren's Ultimate Sacrifice</h3>

                <p class="mb-4">The final battle for the fate of the galaxy had begun. The Vault Hunters threw everything they had at the giant monster. The fight was long and brutal, shaking the entire planet of Pandora to its core. But working together, using all of their skills and weapons, they finally did the impossible: they defeated Tyreen the Destroyer. However, the danger was not over. The Great Vault was still open and unstable. Its raw energy threatened to tear Pandora apart.</p>
                <p class="mb-6">At that moment, Lilith, who had slowly been regaining her Siren abilities, knew what she had to do. There was only one way to close the Vault and save the planet. In a final, heroic act, she said goodbye to her friends, the family she had fought alongside for so long. She flew into the sky, glowing with the power of the Firehawk one last time. She flew straight towards Pandora's moon, Elpis, and with a final, massive burst of Siren energy, she phased it into the entrance of the Great Vault, sealing it forever. Lilith was gone, but she had saved everyone. As a final message to her friends, she left a giant, burning Firehawk symbol on the face of the moon, a permanent reminder of her bravery and sacrifice.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Beginning</h3>

                <p class="mb-4">With the Calypso Twins defeated and Pandora safe, the war was over. But the adventure was not. After the battle, Tannis discovered that the Vault Key contained one last secret. It wasn't just a key; it was also a map. It showed the locations of hundreds of other Vaults, scattered all across the galaxy on unknown worlds. The Vault Hunters stood aboard Sanctuary III, looking out at the stars. They had lost friends and leaders, but they had saved the day. And now, they had a map to countless new adventures. The hunt for the Vaults was only just beginning.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Check out your reward
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-900 rounded-lg shadow-2xl" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-white bg-gray-800 p-4 rounded-xl border-2 border-yellow-400">
                <h1 class="text-3xl font-bold mb-2 game-font">Vault Hunter's Treasure</h1>
                <p class="text-gray-300">Use the arrow keys to move and the <strong class="text-yellow-400">E key</strong> to investigate for key fragments!</p>
                <div class="mt-4 text-xl">
                    Key Fragments Found: <span id="foundCount" class="font-bold text-yellow-400">0</span> / 3
                </div>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex-col items-center mt-6 w-full">
                <div class="grid grid-cols-3 gap-2 w-48">
                    <div class="col-span-1"></div>
                    <button id="up-btn" class="control-button">▲</button>
                    <div class="col-span-1"></div>
                    <button id="left-btn" class="control-button">◀</button>
                    <div class="col-span-1"></div>
                    <button id="right-btn" class="control-button">▶</button>
                    <div class="col-span-1"></div>
                    <button id="down-btn" class="control-button">▼</button>
                    <div class="col-span-1"></div>
                </div>
                <button id="investigateBtn" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full mt-6 hover:bg-yellow-500 transition duration-300 w-48">
                    Investigate
                </button>
            </div>

            <div id="end-game-message" class="message-box hidden text-white">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4">Congratulations, Vault Hunter!</h2>
                <div id="completed-key-container" class="mb-6 flex justify-center"></div>
                <p class="mb-6 text-lg sm:text-xl">You have successfully completed the vault key. What knowledge will you seek?</p>
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data
        const allQuestions = [{
            id: 'q1',
            questionText: 'Who are the main villains leading the Children of the Vault cult?',
            options: [{
                value: 'A',
                text: 'Handsome Jack and Angel'
            }, {
                value: 'B',
                text: 'The Calypso Twins'
            }, {
                value: 'C',
                text: 'The Atlas Corporation'
            }, {
                value: 'D',
                text: 'The Crimson Raiders'
            }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What is the name of the Crimson Raiders\' spaceship headquarters?',
            options: [{
                value: 'A',
                text: 'Helios'
            }, {
                value: 'B',
                text: 'Promethea'
            }, {
                value: 'C',
                text: 'Sanctuary III'
            }, {
                value: 'D',
                text: 'The Great Vault'
            }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'What special ability do the Calypso Twins have?',
            options: [{
                value: 'A',
                text: 'The ability to become invisible'
            }, {
                value: 'B',
                text: 'The ability to control robots'
            }, {
                value: 'C',
                text: 'The ability to drain life from others'
            }, {
                value: 'D',
                text: 'The ability to travel through time'
            }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'Which veteran Vault Hunter is tragically killed by the Calypso Twins on Promethea?',
            options: [{
                value: 'A',
                text: 'Lilith'
            }, {
                value: 'B',
                text: 'Zer0'
            }, {
                value: 'C',
                text: 'Maya'
            }, {
                value: 'D',
                text: 'Tannis'
            }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'What is the Calypso Twins\' ultimate goal?',
            options: [{
                value: 'A',
                text: 'To destroy all the other corporations'
            }, {
                value: 'B',
                text: 'To bring peace to the galaxy'
            }, {
                value: 'C',
                text: 'To open the Great Vault and become gods'
            }, {
                value: 'D',
                text: 'To find all the Eridian writings'
            }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What monster is imprisoned inside the Great Vault?',
            options: [{
                value: 'A',
                text: 'The Warrior'
            }, {
                value: 'B',
                text: 'The Sentinel'
            }, {
                value: 'C',
                text: 'The Destroyer'
            }, {
                value: 'D',
                text: 'The Rampager'
            }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'What planet is home to the Jakobs corporation?',
            options: [{
                value: 'A',
                text: 'Pandora'
            }, {
                value: 'B',
                text: 'Eden-6'
            }, {
                value: 'C',
                text: 'Promethea'
            }, {
                value: 'D',
                text: 'Athenas'
            }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'What does Lilith do at the end of the story to save Pandora?',
            options: [{
                value: 'A',
                text: 'She destroys the Great Vault Key.'
            }, {
                value: 'B',
                text: 'She sacrifices herself to seal the Great Vault.'
            }, {
                value: 'C',
                text: 'She becomes the new leader of the Children of the Vault.'
            }, {
                value: 'D',
                text: 'She finds a way to close the vault without any sacrifice.'
            }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'Who loses their Siren powers to Tyreen Calypso at the beginning of the game?',
            options: [{
                value: 'A',
                text: 'Maya'
            }, {
                value: 'B',
                text: 'Tannis'
            }, {
                value: 'C',
                text: 'Lilith'
            }, {
                value: 'D',
                text: 'Amara'
            }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'What symbol does Lilith leave on Pandora\'s moon?',
            options: [{
                value: 'A',
                text: 'A Vault symbol'
            }, {
                value: 'B',
                text: 'A Crimson Raider logo'
            }, {
                value: 'C',
                text: 'A Firehawk symbol'
            }, {
                value: 'D',
                text: 'A Calypso Twin mask'
            }],
            type: 'radio'
        }];

        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "C",
            q4: "C",
            q5: "C",
            q6: "C",
            q7: "B",
            q8: "B",
            q9: "C",
            q10: "C"
        };

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');
        const investigateBtn = document.getElementById('investigateBtn');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box flex flex-col items-center';
            messageBox.innerHTML = `
                <p class="text-white text-lg sm:text-xl mb-4">${message}</p>
                <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // Game Logic for Vault Hunter's Treasure
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const foundCountEl = document.getElementById('foundCount');
        const messageBox = document.getElementById('end-game-message');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const completedKeyContainer = document.getElementById('completed-key-container');
        const upBtn = document.getElementById('up-btn');
        const downBtn = document.getElementById('down-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const hunterSize = 50;
        let hunterX, hunterY;
        const speed = 5;
        let foundKeys = 0;
        let isGameActive = false;
        let animationFrameId;

        const hunterSymbol = '🤠';
        const keyFragmentImages = [];
        let objects = [];
        const numObjects = 10;
        const objectSymbols = ['📦', '💰', '🛡️', '⚙️', '💎', '🧪'];

        const keys = {};

        // SVG functions
        function createDiamondFragmentSVG(fragmentIndex) {
            const svgWidth = 50;
            const svgHeight = 50;
            let svgPath = '';
            if (fragmentIndex === 0) {
                svgPath = `M${svgWidth / 2},0 L0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth},${svgHeight / 2} Z`;
            } else if (fragmentIndex === 1) {
                svgPath = `M0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L0,${svgHeight} Z`;
            } else if (fragmentIndex === 2) {
                svgPath = `M${svgWidth},${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L${svgWidth},${svgHeight} Z`;
            }
            return `<svg xmlns="http://www.w3.org/2000/svg" width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
                        <path d="${svgPath}" fill="#a855f7" stroke="#8b5cf6" stroke-width="2" />
                    </svg>`;
        }

        function createCompletedDiamondSVG() {
            return `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                        <path d="M50,0 L0,50 L50,100 L100,50 Z" fill="#a855f7" stroke="#8b5cf6" stroke-width="4" />
                    </svg>`;
        }

        function preloadKeyFragments() {
            for (let i = 0; i < 3; i++) {
                const keyFragImage = new Image();
                const svgString = createDiamondFragmentSVG(i);
                keyFragImage.src = 'data:image/svg+xml;base64,' + btoa(svgString);
                keyFragmentImages.push(keyFragImage);
            }
        }

        function showGameMessage() {
            completedKeyContainer.innerHTML = createCompletedDiamondSVG();
            messageBox.classList.remove('hidden');
        }

        function hideGameMessage() {
            messageBox.classList.add('hidden');
        }

        // Game state and object creation
        function createObjects() {
            objects = [];
            const keyLocations = new Set();
            while (keyLocations.size < 3) {
                keyLocations.add(Math.floor(Math.random() * numObjects));
            }

            for (let i = 0; i < numObjects; i++) {
                let x, y;
                let overlap;
                do {
                    overlap = false;
                    x = Math.random() * (canvas.width - 50);
                    y = Math.random() * (canvas.height - 50);

                    for (const obj of objects) {
                        const dist = Math.sqrt(Math.pow(x - obj.x, 2) + Math.pow(y - obj.y, 2));
                        if (dist < 100) {
                            overlap = true;
                            break;
                        }
                    }
                } while (overlap);

                objects.push({
                    x: x,
                    y: y,
                    isKey: keyLocations.has(i),
                    isFound: false,
                    symbol: objectSymbols[Math.floor(Math.random() * objectSymbols.length)]
                });
            }
        }

        function resetGame() {
            foundKeys = 0;
            foundCountEl.textContent = foundKeys;
            hunterX = canvas.width / 2 - hunterSize / 2;
            hunterY = canvas.height / 2 - hunterSize / 2;
            hideGameMessage();
            createObjects();
            isGameActive = true;
            if (!animationFrameId) {
                gameLoop();
            }
        }

        // Game drawing logic
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            objects.forEach(obj => {
                ctx.save();
                ctx.translate(obj.x, obj.y);
                if (obj.isFound) {
                    const foundKeyCount = objects.filter(o => o.isFound).length;
                    const fragIndex = obj.isKey ? objects.filter(o => o.isKey).indexOf(obj) : -1;
                    if (fragIndex !== -1 && keyFragmentImages[fragIndex]?.complete) {
                        ctx.drawImage(keyFragmentImages[fragIndex], 0, 0, 50, 50);
                    }
                } else {
                    ctx.font = '40px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(obj.symbol, 25, 25);
                }
                ctx.restore();
            });

            ctx.font = '50px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(hunterSymbol, hunterX + hunterSize / 2, hunterY + hunterSize / 2);
        }

        // Game logic
        function investigate() {
            if (!isGameActive) return;
            let foundSomething = false;
            objects.forEach(obj => {
                if (!obj.isFound &&
                    hunterX < obj.x + 50 &&
                    hunterX + hunterSize > obj.x &&
                    hunterY < obj.y + 50 &&
                    hunterY + hunterSize > obj.y) {
                    if (obj.isKey) {
                        obj.isFound = true;
                        foundKeys++;
                        foundSomething = true;
                        foundCountEl.textContent = foundKeys;
                        if (foundKeys === 3) {
                            showGameMessage();
                            isGameActive = false;
                        }
                    }
                }
            });
            draw();
        }

        function gameLoop() {
            if (!isGameActive) return;

            if (keys['ArrowUp']) hunterY -= speed;
            if (keys['ArrowDown']) hunterY += speed;
            if (keys['ArrowLeft']) hunterX -= speed;
            if (keys['ArrowRight']) hunterX += speed;

            hunterX = Math.max(0, Math.min(canvas.width - hunterSize, hunterX));
            hunterY = Math.max(0, Math.min(canvas.height - hunterSize, hunterY));

            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Event Listeners for game
        document.addEventListener('keydown', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
            if (e.key.toLowerCase() === 'e' || e.key === ' ') {
                investigate();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        // Touch/Mouse event listeners for new buttons
        const controlButtons = {
            'up-btn': 'ArrowUp',
            'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft',
            'right-btn': 'ArrowRight'
        };

        function startMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = true;
        }

        function stopMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = false;
        }

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('mousedown', startMovement);
            btn.addEventListener('mouseup', stopMovement);
            btn.addEventListener('mouseleave', stopMovement); // Prevents movement from getting stuck if cursor moves off button
            btn.addEventListener('touchstart', startMovement);
            btn.addEventListener('touchend', stopMovement);
        });

        investigateBtn.addEventListener('click', investigate);
        playAgainBtn.addEventListener('click', () => {
            // New logic to return to the quiz
            hideGameMessage(); // Hide the "You Win!" message box
            gameContainer.style.display = 'none'; // Hide the game section
            quizContainer.style.display = 'block'; // Show the quiz section
            renderQuiz(); // Reset the quiz and restart the timer
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            resetGame();
        }

        function initGame() {
            preloadKeyFragments();
            resizeCanvas();
            isGameActive = true;
            gameLoop();
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameContainer.style.display === 'flex') {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>

