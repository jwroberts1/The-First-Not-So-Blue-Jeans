<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peanuts: Back to School Blues & Bright Spots</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* --- NEW GAME STYLES --- */
        #game-canvas {
            background: #87CEEB; /* Sky Blue */
            border-bottom: 60px solid #4ade80; /* Grass */
            border-left: 4px solid #3b82f6;
            border-right: 4px solid #3b82f6;
            border-top: 4px solid #3b82f6;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
            width: 100%;
            height: 100%;
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-3xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
            width: 80px;
            height: 80px;
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center; /* Corrected 'align: center' */
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Peanuts Gang: Back to School!</h1>
        <p class="text-gray-600 text-center mb-8">A story about winter break ending and finding the courage to learn.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-base sm:text-lg border border-gray-200">
                
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 1: The End of Hibernation</h2>
                <p class="mb-4">The snow was still piled high on the roofs of the neighborhood, but something had changed in the air. It wasn't the smell of pine trees or hot cocoa anymore. It was the smell of sharpened pencils and eraser dust. Winter break was over. For Charlie Brown, this realization hit him like a snowball to the face.</p>
                <p class="mb-4">"I can't believe it," he groaned, leaning against the brick wall. "Two whole weeks of freedom, gone. Poof! Just like that." Linus, standing next to him with his blue blanket wrapped securely around his shoulders, nodded wisely. "It is the inevitable passage of time, Charlie Brown. Seasons change, holidays end, and the school bell rings for us all."</p>
                <p class="mb-4">"I'm just not ready," Charlie Brown sighed. "I haven't even finished reading the book we were assigned! I read the first page, then I got hungry, then Snoopy stole my bookmark, and now... well, now it's Monday morning." He looked down at his shoes. "I feel like I'm going to fail before I even start."</p>
                <p class="mb-4">Just then, Lucy marched up to them. She was wearing a new winter coat and holding a shiny red apple. "Move it, blockhead!" she commanded. "We're going to be late! Do you know what happens if you're late on the first day back? It goes on your Permanent Record! It will follow you for the rest of your life!" Charlie Brown shuddered. "Good grief," he whispered. "The pressure is starting already."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 2: The Bus Ride</h2>
                <p class="mb-4">The yellow school bus rumbled down the street, its brakes squealing as it stopped. The gang piled on. Peppermint Patty was already in the back, snoring loudly with her mouth open. Marcie sat next to her, reading a thick book about physics. "Sir is resting," Marcie whispered as Charlie Brown walked by. "She practiced hockey all break."</p>
                <p class="mb-4">Charlie Brown sat next to Franklin. "How was your break?" Franklin asked cheerfully. "My family went to the museum. We saw dinosaur bones!" Charlie Brown tried to smile. "That sounds great. I... I mostly watched my dog sleep on top of his doghouse. And I tried to fly a kite in a blizzard." Franklin raised an eyebrow. "How did that go?" "I lost the kite," Charlie Brown admitted.</p>
                <p class="mb-4">Across the aisle, Sally was panicking. "I forgot how to write!" she wailed. "I can't remember if a 'Q' has a tail or a hat! I'm going to have to start kindergarten all over again!" Linus patted her arm gently. "Don't worry, Sally. It will come back to you. Learning is like riding a bike. You never truly forget." Sally sniffled. "But I don't know how to ride a bike either!"</p>
                <p class="mb-4">By the time the bus pulled up to the school, the mood was mixed. Some kids, like Lucy and Schroeder, marched off with confidence. Others, like Charlie Brown and Sally, walked slowly, dragging their feet through the slush. The big brick building loomed over them. "Here goes nothing," Charlie Brown murmured.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 3: The Empty Desk</h2>
                <p class="mb-4">The classroom smelled like floor wax and old paper. The teacher, Miss Othmar, was standing at the front. (Or at least, the kids assumed she was there; all they heard was a muffled *wah-wah-wah* sound when she spoke). Charlie Brown found his desk. It felt smaller than he remembered. He sat down and opened his notebook. The page was blank and white, staring at him.</p>
                <p class="mb-4">"Alright, class," the teacher's voice *wah-wah'd*. "Please take out your homework from the break." Charlie Brown froze. Homework? He frantically searched his memory. Was there homework? He looked at Linus. Linus was calmly placing a neat stack of papers on his desk. He looked at Lucy. She slammed down a thick report with a confident grin. He looked at Pig-Pen. even Pig-Pen had a piece of paper, though it was covered in a dusty fingerprint.</p>
                <p class="mb-4">Charlie Brown raised his hand slowly. "Ma'am?" he squeaked. "I... I think my dog ate my homework." The class giggled. It was the oldest excuse in the book. But in Charlie Brown's case, it was actually possible. He remembered Snoopy chewing on something that looked like a math worksheet yesterday. He put his head on his desk. This was it. He was doomed. The year was ruined.</p>
                <p class="mb-4">But then, he felt a tap on his shoulder. It was the Little Red-Haired Girl. She smiled at him. "Don't worry, Charlie Brown," she whispered. "That assignment was optional for extra credit. You didn't have to do it." Charlie Brown lifted his head. His heart did a little flip-flop. "Really?" he whispered back. She nodded. Suddenly, the classroom didn't seem so scary anymore.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 4: Lunchtime Philosophy</h2>
                <p class="mb-4">At lunch, the gang gathered at their usual table. Charlie Brown opened his brown paper bag. "Peanut butter and jelly," he announced. "Again." "I have a gourmet sandwich with imported cheese," Lucy bragged. "It helps my brain grow so I can be the queen of the world one day."</p>
                <p class="mb-4">Linus took a bite of his apple. "You know," he said thoughtfully, "school isn't just about grades or homework. It's about expanding our horizons. It's about understanding the world around us." Peppermint Patty groaned from the next table. "It's about staying awake during math! How does anyone do it? The numbers just float around like little butterflies!"</p>
                <p class="mb-4">"You have to focus, Patty," Marcie said, pushing up her glasses. "Try to find the fun in it. Numbers are like puzzles." Peppermint Patty sighed. "The only puzzle I want to solve is how to get more recess time."</p>
                <p class="mb-4">Charlie Brown looked around the cafeteria. He saw his friends laughing, arguing, and trading snacks. He realized he had missed this. Being home alone was safe, but being here was... lively. "Maybe school isn't so bad," he said quietly. "It's better than sitting on the porch worrying." "That's the spirit, Charlie Brown!" Linus said. "Besides, we have Art class next. You're good at drawing circles!" "They're usually supposed to be faces," Charlie Brown admitted, "but thanks, Linus."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 5: Snoopy's Surprise</h2>
                <p class="mb-4">During afternoon recess, the kids ran out to the playground. The air was cold, but the sun was shining. Charlie Brown saw a crowd gathering near the baseball field. "What's going on?" he asked. He pushed through the crowd and gasped.</p>
                <p class="mb-4">There, sitting on the pitcher's mound, was Snoopy. But he wasn't just sitting. He was wearing a college sweater and reading a thick textbook. He had a pair of glasses perched on his nose. "What is that dog doing?" Lucy demanded. "He doesn't even go here!"</p>
                <p class="mb-4">Snoopy looked up, closed his book with a snap, and hopped down. He pulled a chalkboard out from behind his back. On it, he had written a complex equation: *E = mc^2*. Then he erased it and drew a picture of a dog bone. The kids laughed and cheered. Snoopy bowed dramatically, his ears flopping.</p>
                <p class="mb-4">"Even my dog is smarter than me," Charlie Brown sighed. But he was smiling. Snoopy ran over and nudged Charlie Brown's hand. It was a reminder: don't take things too seriously. School is important, but so is having fun. Charlie Brown patted Snoopy's head. "Good dog," he said. "You're right. I should just do my best."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 6: A Good Grade</h2>
                <p class="mb-4">The last period of the day was a spelling test. Charlie Brown's hands were sweating. He hated tests. He always got the letters mixed up. "I before E except after C," he muttered to himself. "Or is it E before I?" He looked at the first word: *Neighbor*.</p>
                <p class="mb-4">He closed his eyes. He thought about Linus, his neighbor who moved in next door. He thought about how kind Linus was. *N-E-I-G-H-B-O-R*. He wrote it down. The next word was *Friend*. He looked at the Little Red-Haired Girl. *F-R-I-E-N-D*. He wrote it down. One by one, he went through the list. He didn't rush. He didn't panic. He just thought about the words and what they meant to him.</p>
                <p class="mb-4">When Miss Othmar handed the papers back at the end of the day, Charlie Brown was afraid to look. He slowly peeled back the corner of the page. There, in red ink, was a shiny star. He hadn't gotten a perfect score, but he had passed! He had done well!</p>
                <p class="mb-4">"I did it!" he shouted, running out the school doors. "I passed the spelling test!" Linus was waiting by the bus. "I knew you could do it, Charlie Brown," he said. "You just needed to believe in yourself."</p>
                <p class="mb-4">The walk home felt different than the walk to the bus stop that morning. The snow seemed brighter. The air felt crisper. Charlie Brown wasn't dragging his feet anymore. He was walking tall. He realized that going back to school wasn't about being perfect. It was about showing up, trying your hardest, and knowing that your friends—and your dog—would be there to cheer you on. "It's going to be a good year," Charlie Brown said, looking up at the sky. And for once, he really believed it.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 shadow-md hidden">
                    Congratulations! Play Snoopy's Word Catcher!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- --- NEW GAME SECTION: Snoopy's Word Catcher --- -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            
            <div id="game-info" class="mb-4 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Snoopy's Word Catcher!</h1>
                <p class="text-gray-600">Catch 10 <span class="text-green-600 font-bold">GOOD</span> words (friend, hope, brave) to win! Avoid the <span class="text-red-600 font-bold">BAD</span> words!</p>
            </div>

            <!-- Game Stats -->
            <div class="flex justify-between w-full max-w-xl mb-2 px-4 text-gray-800 game-font text-2xl">
                <div id="score-display">WORDS: 0/10</div>
                <div id="timer-display">TIME: 60</div>
            </div>

            <!-- Game Canvas -->
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-[4/3] overflow-hidden rounded-lg">
                 <canvas id="game-canvas"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex justify-center space-x-12 w-full mt-6">
                <button id="left-btn" class="control-button">◄</button>
                <button id="right-btn" class="control-button">►</button>
            </div>

            <!-- Game Over Modal -->
            <div id="game-over-modal" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 id="modal-title-text" class="text-3xl font-bold mb-4 text-yellow-700 header-font">Good Grief!</h2>
                    <p id="modal-body-text" class="text-gray-800 text-lg mb-6">Game Over!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- NEW QUIZ DATA (Based on Back to School Story) ---
        const allQuestions = [
            {
                id: 'q1',
                questionText: "How did Charlie Brown feel about winter break ending?",
                options: [
                    { value: 'A', text: 'He was excited to see his friends.' },
                    { value: 'B', text: 'He was sad and felt unprepared.' },
                    { value: 'C', text: 'He didn\'t care at all.' },
                    { value: 'D', text: 'He was angry at Snoopy.' }
                ],
                type: 'radio'
            },
            {
                id: 'q2',
                questionText: "What did Lucy say would happen if they were late on the first day?",
                options: [
                    { value: 'A', text: 'They would miss lunch.' },
                    { value: 'B', text: 'They would get extra homework.' },
                    { value: 'C', text: 'It would go on their Permanent Record.' },
                    { value: 'D', text: 'The bus would leave without them.' }
                ],
                type: 'radio'
            },
            {
                id: 'q3',
                questionText: "What was Sally worried about on the bus?",
                options: [
                    { value: 'A', text: 'She forgot her lunch.' },
                    { value: 'B', text: 'She forgot how to write and feared starting kindergarten over.' },
                    { value: 'C', text: 'She didn\'t like her new shoes.' },
                    { value: 'D', text: 'She lost her library book.' }
                ],
                type: 'radio'
            },
            {
                id: 'q4',
                questionText: "Why did Charlie Brown think he was in trouble when class started?",
                options: [
                    { value: 'A', text: 'He thought there was homework due that he hadn\'t done.' },
                    { value: 'B', text: 'He fell asleep at his desk.' },
                    { value: 'C', text: 'He forgot his pencil.' },
                    { value: 'D', text: 'Snoopy followed him into class.' }
                ],
                type: 'radio'
            },
            {
                id: 'q5',
                questionText: "Who told Charlie Brown that the assignment was optional?",
                options: [
                    { value: 'A', text: 'Linus.' },
                    { value: 'B', text: 'Lucy.' },
                    { value: 'C', text: 'Peppermint Patty.' },
                    { value: 'D', text: 'The Little Red-Haired Girl.' }
                ],
                type: 'radio'
            },
            {
                id: 'q6',
                questionText: "What does Linus think school is really about?",
                options: [
                    { value: 'A', text: 'Getting good grades.' },
                    { value: 'B', text: 'Eating lunch.' },
                    { value: 'C', text: 'Expanding horizons and understanding the world.' },
                    { value: 'D', text: 'Playing recess.' }
                ],
                type: 'radio'
            },
            {
                id: 'q7',
                questionText: "What was Snoopy doing on the playground?",
                options: [
                    { value: 'A', text: 'Chasing a ball.' },
                    { value: 'B', text: 'Sleeping on the pitcher\'s mound.' },
                    { value: 'C', text: 'Wearing a sweater, reading a textbook, and doing math.' },
                    { value: 'D', text: 'Flying his doghouse.' }
                ],
                type: 'radio'
            },
            {
                id: 'q8',
                questionText: "How did Charlie Brown help himself during the spelling test?",
                options: [
                    { value: 'A', text: 'He copied off Linus.' },
                    { value: 'B', text: 'He guessed every word.' },
                    { value: 'C', text: 'He thought about what the words meant to him and his friends.' },
                    { value: 'D', text: 'He asked the teacher for help.' }
                ],
                type: 'radio'
            },
            {
                id: 'q9',
                questionText: "What did Charlie Brown get on his spelling test?",
                options: [
                    { value: 'A', text: 'A failing grade.' },
                    { value: 'B', text: 'A shiny star for passing.' },
                    { value: 'C', text: 'A perfect score.' },
                    { value: 'D', text: 'No grade at all.' }
                ],
                type: 'radio'
            },
            {
                id: 'q10',
                questionText: "What is the main lesson Charlie Brown learned?",
                options: [
                    { value: 'A', text: 'School is scary and you should stay home.' },
                    { value: 'B', text: 'Only perfect grades matter.' },
                    { value: 'C', text: 'Winter break is too short.' },
                    { value: 'D', text: 'Doing your best and having friends makes school okay.' }
                ],
                type: 'radio'
            }
        ];

        // --- NEW Correct Answers ---
        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "B",
            q4: "A",
            q5: "D",
            q6: "C",
            q7: "C",
            q8: "C",
            q9: "B",
            q10: "D"
        };


        // --- ALL SCRIPTING BELOW THIS LINE IS UNCHANGED ---

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            startGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- SNOOPY'S WORD CATCHER GAME LOGIC ---

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const gameTimerDisplay = document.getElementById('timer-display');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalBodyText = document.getElementById('modal-body-text');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');

        // Game constants
        const playerWidth = 60;
        const playerHeight = 60;
        const gravity = 0; // Not a jumping game
        const wordSpeed = 3;
        
        // Words data
        const goodWords = ["FRIEND", "HOPE", "BRAVE", "KIND", "HELP", "TRUST", "LOVE", "SHARE"];
        const badWords = ["WORRY", "FEAR", "GRIEF", "MEAN", "RUDE", "SAD", "DOUBT", "QUIT"];

        // Game state variables
        let playerX;
        let playerY;
        let fallingWords = [];
        let score = 0;
        let timeLeft = 60;
        let gameLoop;
        let spawnInterval;
        let gameTimerInterval;
        let isMovingLeft = false;
        let isMovingRight = false;

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            playerY = canvas.height - playerHeight - 10;
        }

        // Initialize player position
        function initPlayer() {
            playerX = canvas.width / 2 - playerWidth / 2;
        }

        // Draw Snoopy (simplified as a white box with black ears for now, or text)
        function drawPlayer() {
            // Draw Snoopy-like shape
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth/2, playerY + playerHeight/2, playerWidth/2, playerHeight/3, 0, 0, Math.PI * 2);
            ctx.fill();
            // Ear
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.ellipse(playerX + 20, playerY + playerHeight/2, 10, 15, 0, 0, Math.PI * 2);
            ctx.fill();
            // Nose
            ctx.beginPath();
            ctx.ellipse(playerX + playerWidth - 10, playerY + playerHeight/2 - 5, 5, 5, 0, 0, Math.PI * 2);
            ctx.fill();
            // Collar
            ctx.fillStyle = "red";
            ctx.fillRect(playerX + playerWidth/2 - 5, playerY + playerHeight/2 + 10, 10, 5);
        }

        // Spawn a new word
        function spawnWord() {
            const isGood = Math.random() > 0.4; // 60% chance of good word
            const text = isGood ? goodWords[Math.floor(Math.random() * goodWords.length)] : badWords[Math.floor(Math.random() * badWords.length)];
            const x = Math.random() * (canvas.width - 100);
            
            fallingWords.push({
                x: x,
                y: -30,
                text: text,
                isGood: isGood,
                width: ctx.measureText(text).width + 20
            });
        }

        // Update and draw words
        function updateAndDrawWords() {
            ctx.font = "bold 20px 'Inter'";
            
            for (let i = fallingWords.length - 1; i >= 0; i--) {
                let word = fallingWords[i];
                word.y += wordSpeed;

                // Draw word background
                ctx.fillStyle = word.isGood ? "#dcfce7" : "#fee2e2";
                ctx.strokeStyle = word.isGood ? "#16a34a" : "#dc2626";
                ctx.lineWidth = 2;
                
                const textWidth = ctx.measureText(word.text).width;
                const boxWidth = textWidth + 20;
                const boxHeight = 30;
                
                ctx.fillRect(word.x, word.y - 20, boxWidth, boxHeight);
                ctx.strokeRect(word.x, word.y - 20, boxWidth, boxHeight);

                // Draw text
                ctx.fillStyle = word.isGood ? "#166534" : "#991b1b";
                ctx.fillText(word.text, word.x + 10, word.y);

                // Collision detection
                if (
                    playerX < word.x + boxWidth &&
                    playerX + playerWidth > word.x &&
                    playerY < word.y + boxHeight &&
                    playerY + playerHeight > word.y - 20
                ) {
                    // Collision!
                    if (word.isGood) {
                        score += 1;
                        scoreDisplay.textContent = `WORDS: ${score}/10`;
                        if (score >= 10) {
                            endGame(true); // Win
                        }
                    } else {
                        endGame(false); // Lose
                    }
                    fallingWords.splice(i, 1); // Remove word
                    continue;
                }

                // Remove if off screen
                if (word.y > canvas.height) {
                    fallingWords.splice(i, 1);
                }
            }
        }

        // Main game loop
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear sky
            
            // Draw grass
            ctx.fillStyle = '#4ade80';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

            // Move player
            if (isMovingLeft && playerX > 0) playerX -= 5;
            if (isMovingRight && playerX < canvas.width - playerWidth) playerX += 5;

            drawPlayer();
            updateAndDrawWords();
        }

        // End the game
        function endGame(didWin) {
            clearInterval(gameLoop);
            clearInterval(spawnInterval);
            clearInterval(gameTimerInterval);
            
            if (didWin) {
                modalTitleText.textContent = "You Won!";
                modalBodyText.textContent = "Great job catching all the good words!";
            } else {
                modalTitleText.textContent = "Good Grief!";
                modalBodyText.textContent = `You caught a bad word! Keep trying!`;
            }
            gameOverModal.classList.remove('hidden');
        }

        // Start a new game
        function startGame() {
            // Reset state
            if (gameLoop) clearInterval(gameLoop);
            if (spawnInterval) clearInterval(spawnInterval);
            if (gameTimerInterval) clearInterval(gameTimerInterval);

            resizeCanvas();
            initPlayer();
            fallingWords = [];
            score = 0;
            timeLeft = 60;
            
            scoreDisplay.textContent = `WORDS: 0/10`;
            gameTimerDisplay.textContent = `TIME: 60`;
            gameOverModal.classList.add('hidden');

            // Start intervals
            gameLoop = setInterval(updateGame, 1000 / 60); // 60 FPS
            spawnInterval = setInterval(spawnWord, 1500); // New word every 1.5s
            
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                gameTimerDisplay.textContent = `TIME: ${timeLeft}`;
                if (timeLeft <= 0) {
                    endGame(false); // Lose due to time
                }
            }, 1000);
        }

        // Handle keyboard input
        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = true;
            if (e.code === 'ArrowRight') isMovingRight = true;
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowLeft') isMovingLeft = false;
            if (e.code === 'ArrowRight') isMovingRight = false;
        });
        
        // Handle mobile button input
        leftBtn.addEventListener('mousedown', () => isMovingLeft = true);
        leftBtn.addEventListener('mouseup', () => isMovingLeft = false);
        leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingLeft = true; });
        leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingLeft = false; });

        rightBtn.addEventListener('mousedown', () => isMovingRight = true);
        rightBtn.addEventListener('mouseup', () => isMovingRight = false);
        rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isMovingRight = true; });
        rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); isMovingRight = false; });

        playAgainBtn.addEventListener('click', startGame);

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameLoop) {
                    resizeCanvas();
                    initPlayer(); // Recenter player on resize just in case
                }
            });
        });
    </script>
</body>

</html>
