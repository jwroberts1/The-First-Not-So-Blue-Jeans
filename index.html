<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Man: Grime and Punishment Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* New Game Styles */
        #game-canvas {
            background-color: #e0f2fe; /* Light blue sky */
            border: 4px solid #0284c7; /* Sky blue border */
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: grid !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            &larr; Go to Spelling
        </a>
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Dog Man: Grime and Punishment</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: A Hero Fired</h2>

                <p class="mb-4">The ninth adventure of Dog Man, as chronicled by George and Harold, begins with our hero in trouble. Not with a villain, but with the Mayor! Dog Man, being a dog, has a hard time not doing dog things. After he digs up the Mayor's brand new rose garden and slobbers all over him, the Mayor finally snaps. "You've gone too far, Dog Man!" he screams. "You're digging up public property! You're... you're... FIRED!" Dog Man is forced to turn in his badge and his police hat. The whole police department, especially the Chief, is heartbroken. Dog Man, with his head hanging low, walks out of the station, no longer a cop.</p>
                <p class="mb-6">Dog Man is crushed. He goes home to his friends, Li'l Petey and 80-HD, feeling like his life is over. "My job was my life!" he mopes. Li'l Petey and 80-HD, being the amazing friends they are, refuse to let him give up. "You're still a hero, Dog Man!" Li'l Petey insists. They decide to give Dog Man a new purpose. They form a new superhero team: the Supa Buddies! Li'l Petey becomes Cat Kid, 80-HD becomes Lightning Dude, and Dog Man... well, Dog Man is just Dog Man. But now, he's a hero who doesn't need a badge. Their first mission? To stop a local bully from being mean. It's a small start, but it's something. Dog Man is back in the hero business, even without a job.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A New Villain and an Old Grudge</h3>

                <p class="mb-4">While Dog Man is adjusting to his new life, a new (and old) villain is making plans. Grampa Petey, the grumpy and truly evil father of Petey, is in Cat Jail with his cellmate, Big Jim. Grampa is working on a new invention: the "Motor Brain," a helmet that amplifies a person's personality. He tests it on Big Jim, who is secretly a very loving and cuddly cat. When Big Jim puts on the helmet, he transforms into "Snug," a giant, super-cuddly monster who just wants to hug everything... a little too hard. Grampa quickly rips the helmet off. "Useless!" he grumbles. But he knows what will happen when *he* puts it on.</p>
                <p class="mb-6">Grampa Petey, filled with bitterness and hate, puts on the Motor Brain helmet. He transforms into "Crud," a monstrous, powerful, and pure-evil version of himself. He easily smashes out of jail and begins a reign of terror. Meanwhile, the regular Petey (who is now a good guy) is trying to be a good papa to Li'l Petey. Li'l Petey asks him why he's always so grumpy around Grampa. Petey finally explains his sad backstory: Grampa was mean to Petey's mom (Gramma) and abandoned them when she was sick. She died, and Petey has hated his father ever since. "Hate is all I have left, kid," Petey says. "It's what keeps me going." But Li'l Petey, with his pure heart, replies, "Hate has caused a lot of problems in this world, Papa... but it hasn't solved one yet."</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Crime and the "Punishment"</h3>

                <p class="mb-4">The city is in chaos, and Dog Man is still fired. Li'l Petey and 80-HD come up with a brilliant, and silly, plan. "The Mayor hates dogs, but he loves cats!" Li'l Petey realizes. So, they disguise Dog Man in a new, high-tech "Cat Man" suit. Dog Man, now looking like a cat, goes to the police station. The Mayor is thrilled! "A Cat Man! Purr-fect! You're hired!" Dog Man, now "Cat Man," is back on the force, even if he has to meow instead of bark.</p>
                <p class="mb-6">His first mission is to stop the new villain, Crud. "Cat Man" confronts Crud on the street, and a huge fight breaks out. But the Mayor, watching on TV, sees Dog Man's tail wagging. "Wait a minute... that's no cat!" he shouts. He races to the scene and, just as "Cat Man" is about to win, the Mayor arrests him! "You're Dog Man! You're arrested for impersonating a cat cop!" The Mayor also arrests the Chief and the entire police force for helping Dog Man. With all the cops in jail, Crud (Grampa) is free to do whatever he wants. His first stop? The bank.</p>
                
                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Birth of Munchy</h3>

                <p class="mb-4">With Dog Man in jail, things look bleak. Li'l Petey and 80-HD are in their treehouse trying to figure out a plan. 80-HD, using "Living Spray" (the same stuff that brought Flat Petey to life), creates a tiny, helpful "Supa De-Grime-er" machine. But then, an accident happens. 80-HD makes a claymation video to explain a plan, but a drop of Living Spray hits a giant, discarded paper lunch bag. The bag springs to life! It's big, it's hungry, and it's rampaging through the city. The media names it "Munchy."</p>
                <p class="mb-6">Munchy isn't evil; it's just starving. It starts eating paper, then books, then entire buildings! The city is being destroyed by a giant, living garbage bag. In the middle of this, Crud (Grampa) is also on a rampage. He finds Munchy and, using more Living Spray, makes Munchy even bigger and more powerful. Now the city has *two* giant monsters, and no heroes to stop them. Petey and Li'l Petey watch the destruction from their house. "Papa, we have to do something!" Li'l Petey begs. Petey, seeing his son's bravery, finally agrees. "You're right, kid. Let's go be heroes."</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Forgiveness and a Fiery Rescue</h3>

                <p class="mb-4">Petey and Li'l Petey fly their robot, 80-HD, to the scene. They see Munchy about to eat a fish (Flippy) who is teaching a class of tadpoles about adverbs (they all swim away... "swiftly," "quickly," "surreptitiously!"). Li'l Petey has an idea. "Munchy loves to 'read'!" he says, remembering it was eating books. He and the tadpole, Molly, start drawing. They draw pictures all over Munchy, covering him in art. Munchy stops his rampage, delighted. "He's not a monster! He's a masterpiece!" Li'l Petey cheers. They have calmed one of the monsters with art and kindness.</p>
                <p class="mb-6">But Crud is still a problem. Petey confronts his father, monster to monster. "I'm not gonna fight you, Papa," Petey says, "I'm just... done. I'm done hating you. It's too much work." He tells Grampa that he forgives him. This act of forgiveness completely breaks Grampa's evil spirit. The "Motor Brain" helmet shorts out, and Grampa shrinks back to normal, his evil "Crud" persona gone, leaving just a sad, confused old cat. At the same moment, Big Jim (now Snug) bursts from jail and tackles Grampa in a giant, loving hug.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Hero Restored</h3>
                
                <p class="mb-4">Just when things seem resolved, a new disaster strikes! The Mayor's house is on fire! And the Mayor is trapped on the roof. "Help me!" he cries, "But more importantly, save Mr. Snookums!" (his teddy bear). The jail cell holding Dog Man and the police force breaks open. Dog Man, seeing the fire, doesn't hesitate. He rushes into the burning building, braves the flames, and comes out holding... the Mayor! He goes back in and saves Mr. Snookums, too.</p>
                <p class="mb-6">The Mayor, holding his teddy bear, is overcome with gratitude. "You... you saved me, Dog Man. Even after I fired you." He realizes how wrong he was. "You're not just a good cop, Dog Man. You're a good boy! You're... HIRED! Again!" The crowd cheers, Dog Man gets his badge back, and all is right with the world. Grampa Petey, seeing all the love and forgiveness, willingly goes back to jail, but this time, he's a changed cat. The story ends with Petey and Li'l Petey visiting Grampa in jail, and for the first time, they feel like a real, complicated, but loving family. They visit Gramma's grave, and Petey tells his son that even though sad things happen, you can "color your own story" with love and kindness.</p>
            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Play the Chase Game!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section (Dog Man Chase) -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Dog Man Chase!</h1>
                <p class="text-gray-600">Use the arrow keys or buttons to help Dog Man catch Petey! Dodge the bombs!</p>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                 <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>
            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden grid grid-cols-3 gap-2 w-48 mt-6">
                <div></div> <!-- Top-left empty -->
                <button id="up-btn" class="control-button w-full">▲</button>
                <div></div> <!-- Top-right empty -->
                
                <button id="left-btn" class="control-button w-full">◀</button>
                <div></div> <!-- Middle-center empty -->
                <button id="right-btn" class="control-button w-full">▶</button>
                
                <div></div> <!-- Bottom-left empty -->
                <button id="down-btn" class="control-button w-full">▼</button>
                <div></div> <!-- Bottom-right empty -->
            </div>


            <div id="win-message" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 class="text-3xl font-bold mb-4 text-yellow-700 header-font">You Caught Petey!</h2>
                    <p class="text-gray-800 text-lg mb-6">Great job, hero!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- QUIZ DATA ---
        // (New questions for "Grime and Punishment")
        const allQuestions = [{
            id: 'q1',
            questionText: 'Why did the Mayor fire Dog Man at the beginning of the story?',
            options: [{ value: 'A', text: 'He robbed a bank.' }, { value: 'B', text: 'He let all the villains escape from jail.' }, { value: 'C', 'text': 'He dug up the Mayor\'s rose garden and was slobbery.' }, { value: 'D', text: 'He refused to wear his police hat.' }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What was the name of the new superhero team Li\'l Petey and 80-HD created with Dog Man?',
            options: [{ value: 'A', text: 'The Bark Knight and Cat Kid' }, { value: 'B', text: 'The Supa Buddies' }, { value: 'C', text: 'The Police Pals' }, { value: 'D', text: 'The Dog and Cat Crew' }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'What invention did Grampa Petey use to transform into the villain "Crud"?',
            options: [{ value: 'A', text: 'The Living Spray' }, { value: 'B', text: 'A Mecha-Dog Man' }, { value: 'C', text: 'The Motor Brain helmet' }, { value: 'D', text: 'A Supa De-Grime-er' }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'Why did Petey hate his father, Grampa?',
            options: [{ value: 'A', text: 'Grampa stole Petey\'s inventions.' }, { value: 'B', text: 'Grampa abandoned Petey and his mother when she was sick.' }, { value: 'C', text: 'Grampa was a dog lover.' }, { value: 'D', text: 'Grampa was a bigger villain than Petey was.' }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'How did Dog Man get his job back on the police force (temporarily)?',
            options: [{ value: 'A', text: 'He apologized to the Mayor.' }, { value: 'B', text: 'He disguised himself as "Cat Man" and got hired.' }, { value: 'C', text: 'He captured Crud all by himself.' }, { value: 'D', text: 'The Chief refused to fire him.' }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What was the name of the giant, paper-eating monster that came to life?',
            options: [{ value: 'A', text: 'Crud' }, { value: 'B', text: 'Big Jim' }, { value: 'C', text: 'Snug' }, { value: 'D', text: 'Munchy' }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'How was Munchy the monster created?',
            options: [{ value: 'A', text: 'Grampa built him in jail.' }, { value: 'B', text: 'Living Spray accidentally spilled on a paper lunch bag.' }, { value: 'C', text: 'He was a tadpole who grew to a giant size.' }, { value: 'D', text: 'He was a claymation video that came to life.' }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'How did Li\'l Petey and Molly stop Munchy from destroying the city?',
            options: [{ value: 'A', text: 'They used the "Supa De-Grime-er" to shrink him.' }, { value: 'B', text: 'They covered him in drawings and art, which he loved.' }, { value: 'C', text: 'Dog Man arrested him and put him in jail.' }, { value: 'D', text: 'Petey built a robot to fight him.' }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'How did Petey defeat his father, Crud?',
            options: [{ value: 'A', text: 'He beat him in a giant robot fight.' }, { value: 'B', text: 'He told him that he forgave him, which broke his evil spirit.' }, { value: 'C', text: 'He tricked him into being hugged by Snug.' }, { value: 'D', text: 'He helped Dog Man arrest him.' }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'How did Dog Man *officially* get his job back at the very end?',
            options: [{ value: 'A', text: 'He finally learned to act like a cat.' }, { value: 'B', text: 'Petey convinced the Mayor to re-hire him.' }, { value: 'C', text: 'He saved the Mayor and his teddy bear, Mr. Snookums, from a fire.' }, { value: 'D', text: 'He signed a contract promising to never dig up flowers again.' }],
            type: 'radio'
        }];

        // (New correct answers)
        const correctAnswers = {
            q1: "C",
            q2: "B",
            q3: "C",
            q4: "B",
            q5: "B",
            q6: "D",
            q7: "B",
            q8: "B",
            q9: "B",
            q10: "C"
        };
        // --- END OF QUIZ DATA ---


        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            // We use allQuestions directly, no shuffling of question order
            // const shuffledQuestions = shuffleArray([...allQuestions]);

            allQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    // Find the original label (A, B, C, D) for the shuffled option
                    const originalOption = allQuestions[questionIndex].options.find(o => o.value === option.value);
                    const originalLabel = allQuestions[questionIndex].options.indexOf(originalOption);
                    
                    label.appendChild(input);
                    // We display the option text, not a,b,c,d
                    label.appendChild(document.createTextNode(` ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                            input.checked = true;
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- DOG MAN CHASE GAME LOGIC ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const winMessage = document.getElementById('win-message');
        const playAgainBtn = document.getElementById('playAgainBtn');

        let isGameActive = false;
        let animationFrameId;
        const keys = {};

        const player = { x: 0, y: 0, width: 40, height: 40, speed: 4, symbol: '🐶' };
        const petey = { x: 0, y: 0, width: 40, height: 40, speed: 2, symbol: '🐱' };
        const obstacles = [];
        const obstacleSize = 20;
        let peteyThrowInterval;

        function resetGame() {
            // Stop any active game processes
            isGameActive = false;
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            clearInterval(peteyThrowInterval);

            // Hide win message and clear obstacles
            winMessage.classList.add('hidden');
            obstacles.length = 0;

            // Set initial positions for drawing during countdown
            player.x = 50;
            player.y = canvas.height / 2 - player.height / 2;
            petey.x = canvas.width - 50 - petey.width;
            petey.y = canvas.height / 2 - petey.height / 2;

            function drawStaticFrame() {
                if (!ctx) return; // Add guard clause
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#65a30d'; // Grassy green
                ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
                ctx.font = '40px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
                ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            }

            function drawCountdownText(text) {
                drawStaticFrame(); // Draw the background first
                if (!ctx) return; // Add guard clause
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.font = 'bold 96px Bangers, cursive';
                ctx.fillStyle = '#ffffff';
                ctx.strokeStyle = '#27272a';
                ctx.lineWidth = 6;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeText(text, canvas.width / 2, canvas.height / 2);
                ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            }

            let count = 3;
            drawCountdownText(count); // Draw initial "3"

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    drawCountdownText(count);
                } else if (count === 0) {
                    drawCountdownText('GO!');
                } else {
                    clearInterval(countdownInterval);
                    // --- START THE ACTUAL GAME ---
                    isGameActive = true;
                    if (!animationFrameId) {
                        gameLoop();
                    }
                    peteyThrowInterval = setInterval(() => {
                        if (!isGameActive) return;
                        obstacles.push({
                            x: petey.x,
                            y: petey.y + petey.height / 2,
                            width: obstacleSize,
                            height: obstacleSize,
                            speed: 5,
                            symbol: '💣'
                        });
                    }, 1200);
                }
            }, 1000);
        }
        
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function gameLoop() {
            if (!isGameActive) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                return;
            }

            // Update player position
            if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
            if (keys['ArrowDown'] && player.y < canvas.height - player.height) player.y += player.speed;
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;

            // Update Petey's position (simple AI)
            if (player.y < petey.y && petey.y > 0) {
                petey.y -= petey.speed;
            } else if (player.y > petey.y && petey.y < canvas.height - petey.height) {
                petey.y += petey.speed;
            }

            // Update obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.x -= obstacle.speed;
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1); // Remove obstacle if it's off-screen
                }
            }

            // Check for collisions
            // 1. Dog Man hits a bomb
            for (const obstacle of obstacles) {
                if (checkCollision(player, obstacle)) {
                    resetGame(); // Restart the game
                    return; // Exit loop for this frame
                }
            }
            // 2. Dog Man catches Petey
            if (checkCollision(player, petey)) {
                isGameActive = false;
                winMessage.classList.remove('hidden');
            }

            // --- DRAW EVERYTHING ---
            if (!ctx) return; // Add guard clause
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw ground
            ctx.fillStyle = '#65a30d'; // Grassy green
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // Draw characters and obstacles
            ctx.font = '40px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.symbol, player.x + player.width / 2, player.y + player.height / 2);
            ctx.fillText(petey.symbol, petey.x + petey.width / 2, petey.y + petey.height / 2);
            
            ctx.font = '20px sans-serif';
            obstacles.forEach(obstacle => {
                 ctx.fillText(obstacle.symbol, obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2);
            });


            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // --- EVENT LISTENERS FOR GAME ---
        document.addEventListener('keydown', e => {
             if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
        });
        document.addEventListener('keyup', e => { keys[e.key] = false; });
        
        playAgainBtn.addEventListener('click', resetGame);

        // Mobile Controls
        const controlButtons = {
            'up-btn': 'ArrowUp', 'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft', 'right-btn': 'ArrowRight'
        };

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            if (!btn) return; // Add guard clause in case element isn't found
            const key = controlButtons[id];
            btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mouseleave', (e) => { keys[key] = false; });
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            if (!container) return; // Add guard clause
            if (!canvas) return; // Add guard clause
            const size = container.clientWidth;
            canvas.width = size;
            canvas.height = size;
            // Don't reset game on resize, let it continue
            // if (isGameActive) {
            //     resetGame();
            // }
        }

        function initGame() {
            resizeCanvas();
            resetGame();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', resizeCanvas);
        });
    </script>
</body>

</html>

