<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Story of the Hunt for the Warrior Quiz</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* Styles for the Vault Hunter's game */
        #game-canvas {
            background-color: #333;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        #game-info {
            background-color: #222;
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #555;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(34, 34, 34, 0.95);
            padding: 2.5rem;
            border: 4px solid #f5f5f5;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            text-align: center;
            z-index: 1000;
            border-radius: 15px;
        }

        .message-box button {
            background-color: #f59e0b;
            color: #1a1a1a;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .message-box button:hover {
            background-color: #d97706;
            transform: scale(1.05);
        }

        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent;
            /* Removes blue highlight on tap */
        }

        /* Media query to show controls on screens smaller than large desktops */
        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="Math.html" class="text-blue-600 hover:text-blue-800 font-semibold underline text-lg">
            Go to Math Review &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Story of the Hunt for the Warrior Quiz</h1>
        <p class="text-gray-600 text-center mb-8">Read the passage. Then answer the questions.</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-sm sm:text-base border border-gray-200">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Passage: The Rise of Handsome Jack and the Hunt for the Warrior</h2>
                
                <p class="mb-6">Five years after the first Vault was opened, Pandora has changed. The Hyperion Corporation, led by its charming but ruthless CEO, Handsome Jack, has taken control of the planet. Jack claims he is bringing order and civilization to the chaotic world, but his methods are brutal and tyrannical. He has constructed a massive orbital base, Helios, and uses an army of Loader Bots to enforce his will. His true goal, however, is to find a second, far more powerful Vault: the Vault of the Warrior.</p>

                <p class="mb-6">A new group of Vault Hunters is lured to Pandora, not by the promise of treasure, but by the chance to fight back against Hyperion's oppression. They are immediately targeted by Handsome Jack, who leaves them for dead in a frozen wasteland. Rescued by the last remaining Claptrap unit, the new heroes are guided by the familiar voice of the Guardian Angel, who once again directs them on a quest to stop a great evil‚Äîthis time, Handsome Jack himself.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Crimson Raiders</h3>

                <p class="mb-4">The Vault Hunters quickly discover they are not alone. They join forces with the Crimson Raiders, a resistance movement led by the original Vault Hunter, Roland. The Raiders operate from the flying city of Sanctuary, a safe haven for those who oppose Jack. Alongside other original heroes like Lilith and Mordecai, the new Vault Hunters begin a campaign to disrupt Hyperion's operations and find the Vault Key before Jack can.</p>

                <p class="mb-6">The fight against Jack is personal and dangerous. He constantly taunts the Vault Hunters through the ECHOnet, revealing his sadistic personality and his grand vision for Pandora. He seeks to awaken the Warrior, an ancient Eridian superweapon, which he believes will allow him to "cleanse" the planet of all bandits and opposition, leaving him as its undisputed ruler.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">Betrayal and Tragedy</h3>

                <p class="mb-4">As the search for the Vault Key intensifies, a shocking truth is revealed. The Guardian Angel is not a benevolent Eridian entity. She is Angel, Handsome Jack's own Siren daughter, whom he has imprisoned and is using to manipulate events across Pandora. She has been guiding the Vault Hunters to help her stop her father, but she is also being forced to help him charge the Vault Key.</p>

                <p class="mb-4">This revelation leads to a major turning point. To stop the Key from being fully charged, the Vault Hunters must infiltrate Angel's containment facility. In a heartbreaking moment, Angel asks them to shut down her life support, sacrificing herself to stop Jack. As they succeed, Jack appears, enraged by the loss of his daughter. In a fit of fury, he murders Roland in cold blood and captures Lilith, intending to use her Siren powers as a replacement to finish charging the key.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">The Final Confrontation</h3>

                <p class="mb-4">With Sanctuary under attack and their leader gone, the remaining Crimson Raiders launch a final, desperate assault on Handsome Jack's fortress, the Hyperion Information Annex, and from there, to the location of the Vault of the Warrior. The Vault Hunters fight their way through Jack‚Äôs top defenses to confront him just as he succeeds in awakening the colossal, lava-spewing monster known as the Warrior.</p>

                <p class="mb-6">The final battle is a chaotic struggle against both the nearly invincible Warrior and Handsome Jack himself. With help from Lilith, who manages to break free and fight back, the Vault Hunters defeat the Warrior. In the end, they face a weakened but defiant Handsome Jack. They execute the tyrant, finally ending his reign of terror over Pandora.</p>

                <h3 class="text-lg sm:text-xl font-semibold mt-6 mb-3">A Universe of Vaults</h3>

                <p class="mb-4">With the Warrior defeated and Jack gone, the Vault Key is recovered. When activated, it doesn't reveal treasure but something far more significant: a complex, galactic map showing the locations of dozens, if not hundreds, of other Vaults scattered across the galaxy. The story ends not with riches, but with the realization that their adventure on Pandora was just the beginning. A whole universe of Vaults awaits, promising endless adventure and untold danger.</p>

            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 hidden">
                    Congratulations! Check out your reward
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- Game Section -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-900 rounded-lg shadow-2xl" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-white bg-gray-800 p-4 rounded-xl border-2 border-yellow-400">
                <h1 class="text-3xl font-bold mb-2 game-font">Vault Hunter's Treasure</h1>
                <p class="text-gray-300">Use the arrow keys to move and the <strong class="text-yellow-400">E key</strong> to investigate for key fragments!</p>
                <div class="mt-4 text-xl">
                    Key Fragments Found: <span id="foundCount" class="font-bold text-yellow-400">0</span> / 3
                </div>
            </div>
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex-col items-center mt-6 w-full">
                <div class="grid grid-cols-3 gap-2 w-48">
                    <div class="col-span-1"></div>
                    <button id="up-btn" class="control-button">‚ñ≤</button>
                    <div class="col-span-1"></div>
                    <button id="left-btn" class="control-button">‚óÄ</button>
                    <div class="col-span-1"></div>
                    <button id="right-btn" class="control-button">‚ñ∂</button>
                    <div class="col-span-1"></div>
                    <button id="down-btn" class="control-button">‚ñº</button>
                    <div class="col-span-1"></div>
                </div>
                <button id="investigateBtn" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full mt-6 hover:bg-yellow-500 transition duration-300 w-48">
                    Investigate
                </button>
            </div>

            <div id="end-game-message" class="message-box hidden text-white">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4">Congratulations, Vault Hunter!</h2>
                <div id="completed-key-container" class="mb-6 flex justify-center"></div>
                <p class="mb-6 text-lg sm:text-xl">You have successfully completed the vault key. What knowledge will you seek?</p>
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz Data
        const allQuestions = [{
            id: 'q1',
            questionText: 'Who is the main villain and CEO of the Hyperion Corporation in the story?',
            options: [{
                value: 'A',
                text: 'Roland'
            }, {
                value: 'B',
                text: 'Handsome Jack'
            }, {
                value: 'C',
                text: 'Claptrap'
            }, {
                value: 'D',
                text: 'Mordecai'
            }],
            type: 'radio'
        }, {
            id: 'q2',
            questionText: 'What is the name of the resistance movement that fights against Hyperion?',
            options: [{
                value: 'A',
                text: 'The Crimson Lance'
            }, {
                value: 'B',
                text: 'The Vault Hunters'
            }, {
                value: 'C',
                text: 'The Crimson Raiders'
            }, {
                value: 'D',
                text: 'The Children of the Vault'
            }],
            type: 'radio'
        }, {
            id: 'q3',
            questionText: 'What is the name of the flying city that serves as a safe haven for the resistance?',
            options: [{
                value: 'A',
                text: 'Helios'
            }, {
                value: 'B',
                text: 'Pandora'
            }, {
                value: 'C',
                text: 'Sanctuary'
            }, {
                value: 'D',
                text: 'Fyrestone'
            }],
            type: 'radio'
        }, {
            id: 'q4',
            questionText: 'What is the shocking truth revealed about the Guardian Angel?',
            options: [{
                value: 'A',
                text: 'She is a robot built by Hyperion.'
            }, {
                value: 'B',
                text: 'She is Handsome Jack\'s daughter.'
            }, {
                value: 'C',
                text: 'She is the original Vault Hunter.'
            }, {
                value: 'D',
                text: 'She was controlling the Destroyer all along.'
            }],
            type: 'radio'
        }, {
            id: 'q5',
            questionText: 'Which original Vault Hunter is tragically killed by Handsome Jack?',
            options: [{
                value: 'A',
                text: 'Lilith'
            }, {
                value: 'B',
                text: 'Mordecai'
            }, {
                value: 'C',
                text: 'Brick'
            }, {
                value: 'D',
                text: 'Roland'
            }],
            type: 'radio'
        }, {
            id: 'q6',
            questionText: 'What is the name of the ancient Eridian superweapon sealed inside the second Vault?',
            options: [{
                value: 'A',
                text: 'The Destroyer'
            }, {
                value: 'B',
                text: 'The Sentinel'
            }, {
                value: 'C',
                text: 'The Warrior'
            }, {
                value: 'D',
                text: 'The Leviathan'
            }],
            type: 'radio'
        }, {
            id: 'q7',
            questionText: 'Why does Handsome Jack capture Lilith after Roland\'s death?',
            options: [{
                value: 'A',
                text: 'To make her the new leader of Hyperion.'
            }, {
                value: 'B',
                text: 'To use her Siren powers to charge the Vault Key.'
            }, {
                value: 'C',
                text: 'To find out the location of other Vault Hunters.'
            }, {
                value: 'D',
                text: 'To convince her to join him.'
            }],
            type: 'radio'
        }, {
            id: 'q8',
            questionText: 'What does the Vault Key reveal after Handsome Jack and the Warrior are defeated?',
            options: [{
                value: 'A',
                text: 'A massive treasure of gold and Eridium.'
            }, {
                value: 'B',
                text: 'A map showing the locations of many other Vaults.'
            }, {
                value: 'C',
                text: 'A message from the ancient Eridians.'
            }, {
                value: 'D',
                text: 'An empty room.'
            }],
            type: 'radio'
        }, {
            id: 'q9',
            questionText: 'Which character rescues the new Vault Hunters from the frozen wasteland at the beginning of the story?',
            options: [{
                value: 'A',
                text: 'Roland'
            }, {
                value: 'B',
                text: 'Lilith'
            }, {
                value: 'C',
                text: 'Claptrap'
            }, {
                value: 'D',
                text: 'The Guardian Angel'
            }],
            type: 'radio'
        }, {
            id: 'q10',
            questionText: 'What is Handsome Jack\'s ultimate goal for using the Warrior?',
            options: [{
                value: 'A',
                text: 'To destroy Pandora.'
            }, {
                value: 'B',
                text: 'To bring peace and order by eliminating his enemies.'
            }, {
                value: 'C',
                text: 'To become a Siren himself.'
            }, {
                value: 'D',
                text: 'To sell it to the highest bidder.'
            }],
            type: 'radio'
        }];

        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "C",
            q4: "B",
            q5: "D",
            q6: "C",
            q7: "B",
            q8: "B",
            q9: "C",
            q10: "B"
        };

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');
        const investigateBtn = document.getElementById('investigateBtn');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                // Use a simple message box to inform the user
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box flex flex-col items-center';
            messageBox.innerHTML = `
                <p class="text-white text-lg sm:text-xl mb-4">${message}</p>
                <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // Game Logic for Vault Hunter's Treasure
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const foundCountEl = document.getElementById('foundCount');
        const messageBox = document.getElementById('end-game-message');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const completedKeyContainer = document.getElementById('completed-key-container');
        const upBtn = document.getElementById('up-btn');
        const downBtn = document.getElementById('down-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const hunterSize = 50;
        let hunterX, hunterY;
        const speed = 5;
        let foundKeys = 0;
        let isGameActive = false;
        let animationFrameId;

        const hunterSymbol = 'ü§†';
        const keyFragmentImages = [];
        let objects = [];
        const numObjects = 10;
        const objectSymbols = ['üì¶', 'üí∞', 'üõ°Ô∏è', '‚öôÔ∏è', 'üíé', 'üß™'];

        const keys = {};

        // SVG functions
        function createDiamondFragmentSVG(fragmentIndex) {
            const svgWidth = 50;
            const svgHeight = 50;
            let svgPath = '';
            if (fragmentIndex === 0) {
                svgPath = `M${svgWidth / 2},0 L0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth},${svgHeight / 2} Z`;
            } else if (fragmentIndex === 1) {
                svgPath = `M0,${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L0,${svgHeight} Z`;
            } else if (fragmentIndex === 2) {
                svgPath = `M${svgWidth},${svgHeight / 2} L${svgWidth / 2},${svgHeight * 0.75} L${svgWidth / 2},${svgHeight} L${svgWidth},${svgHeight} Z`;
            }
            return `<svg xmlns="http://www.w3.org/2000/svg" width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
                        <path d="${svgPath}" fill="#a855f7" stroke="#8b5cf6" stroke-width="2" />
                    </svg>`;
        }

        function createCompletedDiamondSVG() {
            return `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                        <path d="M50,0 L0,50 L50,100 L100,50 Z" fill="#a855f7" stroke="#8b5cf6" stroke-width="4" />
                    </svg>`;
        }

        function preloadKeyFragments() {
            for (let i = 0; i < 3; i++) {
                const keyFragImage = new Image();
                const svgString = createDiamondFragmentSVG(i);
                keyFragImage.src = 'data:image/svg+xml;base64,' + btoa(svgString);
                keyFragmentImages.push(keyFragImage);
            }
        }

        function showGameMessage() {
            completedKeyContainer.innerHTML = createCompletedDiamondSVG();
            messageBox.classList.remove('hidden');
        }

        function hideGameMessage() {
            messageBox.classList.add('hidden');
        }

        // Game state and object creation
        function createObjects() {
            objects = [];
            const keyLocations = new Set();
            while (keyLocations.size < 3) {
                keyLocations.add(Math.floor(Math.random() * numObjects));
            }

            for (let i = 0; i < numObjects; i++) {
                let x, y;
                let overlap;
                do {
                    overlap = false;
                    x = Math.random() * (canvas.width - 50);
                    y = Math.random() * (canvas.height - 50);

                    for (const obj of objects) {
                        const dist = Math.sqrt(Math.pow(x - obj.x, 2) + Math.pow(y - obj.y, 2));
                        if (dist < 100) {
                            overlap = true;
                            break;
                        }
                    }
                } while (overlap);

                objects.push({
                    x: x,
                    y: y,
                    isKey: keyLocations.has(i),
                    isFound: false,
                    symbol: objectSymbols[Math.floor(Math.random() * objectSymbols.length)]
                });
            }
        }

        function resetGame() {
            foundKeys = 0;
            foundCountEl.textContent = foundKeys;
            hunterX = canvas.width / 2 - hunterSize / 2;
            hunterY = canvas.height / 2 - hunterSize / 2;
            hideGameMessage();
            createObjects();
            isGameActive = true;
            if (!animationFrameId) {
                gameLoop();
            }
        }

        // Game drawing logic
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            objects.forEach(obj => {
                ctx.save();
                ctx.translate(obj.x, obj.y);
                if (obj.isFound) {
                    const foundKeyCount = objects.filter(o => o.isFound).length;
                    const fragIndex = obj.isKey ? objects.filter(o => o.isKey).indexOf(obj) : -1;
                    if (fragIndex !== -1 && keyFragmentImages[fragIndex]?.complete) {
                        ctx.drawImage(keyFragmentImages[fragIndex], 0, 0, 50, 50);
                    }
                } else {
                    ctx.font = '40px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(obj.symbol, 25, 25);
                }
                ctx.restore();
            });

            ctx.font = '50px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(hunterSymbol, hunterX + hunterSize / 2, hunterY + hunterSize / 2);
        }

        // Game logic
        function investigate() {
            if (!isGameActive) return;
            let foundSomething = false;
            objects.forEach(obj => {
                if (!obj.isFound &&
                    hunterX < obj.x + 50 &&
                    hunterX + hunterSize > obj.x &&
                    hunterY < obj.y + 50 &&
                    hunterY + hunterSize > obj.y) {
                    if (obj.isKey) {
                        obj.isFound = true;
                        foundKeys++;
                        foundSomething = true;
                        foundCountEl.textContent = foundKeys;
                        if (foundKeys === 3) {
                            showGameMessage();
                            isGameActive = false;
                        }
                    }
                }
            });
            draw();
        }

        function gameLoop() {
            if (!isGameActive) return;

            if (keys['ArrowUp']) hunterY -= speed;
            if (keys['ArrowDown']) hunterY += speed;
            if (keys['ArrowLeft']) hunterX -= speed;
            if (keys['ArrowRight']) hunterX += speed;

            hunterX = Math.max(0, Math.min(canvas.width - hunterSize, hunterX));
            hunterY = Math.max(0, Math.min(canvas.height - hunterSize, hunterY));

            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // Event Listeners for game
        document.addEventListener('keydown', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                keys[e.key] = true;
            }
            if (e.key.toLowerCase() === 'e' || e.key === ' ') {
                investigate();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (!isGameActive) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = false;
            }
        });

        // Touch/Mouse event listeners for new buttons
        const controlButtons = {
            'up-btn': 'ArrowUp',
            'down-btn': 'ArrowDown',
            'left-btn': 'ArrowLeft',
            'right-btn': 'ArrowRight'
        };

        function startMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = true;
        }

        function stopMovement(e) {
            e.preventDefault();
            const key = controlButtons[e.currentTarget.id];
            if (key) keys[key] = false;
        }

        Object.keys(controlButtons).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('mousedown', startMovement);
            btn.addEventListener('mouseup', stopMovement);
            btn.addEventListener('mouseleave', stopMovement); // Prevents movement from getting stuck if cursor moves off button
            btn.addEventListener('touchstart', startMovement);
            btn.addEventListener('touchend', stopMovement);
        });

        investigateBtn.addEventListener('click', investigate);
        playAgainBtn.addEventListener('click', () => {
            // New logic to return to the quiz
            hideGameMessage(); // Hide the "You Win!" message box
            gameContainer.style.display = 'none'; // Hide the game section
            quizContainer.style.display = 'block'; // Show the quiz section
            renderQuiz(); // Reset the quiz and restart the timer
        });

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            resetGame();
        }

        function initGame() {
            preloadKeyFragments();
            resizeCanvas();
            isGameActive = true;
            gameLoop();
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (gameContainer.style.display === 'flex') {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>

