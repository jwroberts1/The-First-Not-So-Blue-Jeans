<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wild Robot: The Journey Home</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-option.selected {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }

        .question-option.correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .game-font {
            font-family: 'Bangers', cursive;
        }

        /* --- NEW GAME STYLES --- */
        #game-canvas {
            background: #87CEEB; /* Sky Blue */
            border-bottom: 60px solid #a0aec0; /* Sidewalk */
            border-left: 4px solid #3b82f6;
            border-right: 4px solid #3b82f6;
            border-top: 4px solid #3b82f6;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.5);
            width: 100%;
            height: 100%;
        }
        
        .control-button {
            @apply bg-gray-700 text-white p-4 rounded-xl text-3xl font-bold transition-transform transform active:scale-95;
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap */
            width: 80px;
            height: 80px;
        }

        @media (max-width: 1024px) {
            #mobile-controls {
                display: flex !important;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center; /* Corrected 'align: center' */
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./Math.html" class="text-green-600 hover:text-green-800 underline">
            Go to Math &rarr;
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">The Wild Robot: The Journey Home</h1>
        <p class="text-gray-600 text-center mb-8">Roz has been repaired in the city, but her heart is still wild. Can she find her way back?</p>

        <!-- Timer Section -->
        <div id="timer-container" class="bg-gray-100 p-4 rounded-lg text-center mb-6">
            <p class="text-sm font-semibold text-gray-600">Time Elapsed:</p>
            <p id="timer" class="text-2xl font-bold text-blue-600 mt-1">0:00</p>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="passage" class="bg-gray-50 rounded-lg p-6 mb-10 text-gray-700 leading-relaxed text-base sm:text-lg border border-gray-200">
                
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 1: The Glass City</h2>
                <p class="mb-4">Rozzum Unit 7134, known to her friends simply as Roz, stood perfectly still. To any human walking by, she looked like just another machine working in the greenhouse of the Great Glass City. Her shiny metal body had been scrubbed clean of the dirt, moss, and scratches from her island life. A new panel covered her chest, and her sensors hummed with perfect efficiency. But inside her computer brain, something wasn't right. It was a feeling no programming could explain: homesickness.</p>
                <p class="mb-4">The city was loud. Hovercars zipped through the air like angry hornets. Robots marched in straight lines, never looking left or right. There were no birds singing here, no waves crashing against rocks, and certainly no goslings calling for their mother. Roz closed her eyes for a moment. In her memory banks, she replayed the sound of Brightbill’s wings flapping. It had been six months since the RECO robots took her away to be fixed. She was repaired now, shiny and new, but she felt older than ever.</p>
                <p class="mb-4">"Unit 7134, return to charging station," a voice commanded from the ceiling speakers. Roz turned her head. Instead of obeying, she looked at the ventilation shaft high on the wall. She had been calculating this escape for weeks. She knew the city's schedule, the guard robots' patterns, and exactly how much energy she needed to cross the ocean. Tonight was the night. The Wild Robot was going home.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 2: Escape Protocol</h2>
                <p class="mb-4">When the lights dimmed for the city's "Sleep Mode," Roz moved. She didn't move like a city robot, with stiff, mechanical jerks. She moved like a wild animal—fluid, silent, and low to the ground. She climbed the trellis of the greenhouse plants, her metal fingers gripping the steel beams just as they had gripped the trees on the island. She pushed open the vent and squeezed through.</p>
                <p class="mb-4">Outside, the wind whipped around the skyscrapers. Roz was hundreds of feet in the air. Below her, the city glowed like a field of electric flowers. She activated her climbing clamps and began to descend the side of the building. Halfway down, a police drone buzzed by. Roz froze, engaging her camouflage mode. Her body didn't change color, but she held herself so still, mimicking the shape of a gargoyle on the building, that the drone’s sensors dismissed her as a statue. Once it passed, she continued down.</p>
                <p class="mb-4">Reaching the street, she ran. She ran past the robot factories and the human houses, toward the smell of salt and water. At the docks, she saw it: the ocean. It was dark and terrifying, stretching out forever. But it was the only road to Brightbill. Without hesitation, Roz marched into the waves. She couldn't swim like a fish, but she could walk along the bottom, step by heavy step, under the crushing weight of the sea.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 3: The Ocean Floor</h2>
                <p class="mb-4">Walking underwater was slow. The ocean floor was a silent, murky world. Roz turned on her headlights, cutting through the gloom. Fish darted away from the strange glowing giant. Crabs clicked their claws at her metal feet. For days, Roz walked. She didn't need air, but she did need to watch her battery levels. The cold water sapped her energy faster than she had calculated.</p>
                <p class="mb-4">On the third day, disaster struck. A massive shape loomed out of the darkness. A giant squid! It saw Roz’s lights and attacked, wrapping its long, rubbery tentacles around her arms and legs. It squeezed tight, trying to crush her. Roz's alarm systems blared inside her head. *WARNING: STRUCTURAL INTEGRITY COMPROMISED.* She struggled, but the squid was strong.</p>
                <p class="mb-4">Suddenly, she remembered something the beavers on the island had taught her: leverage. Instead of pulling away, Roz pushed *into* the squid, grabbing a heavy rock from the seabed. She slammed the rock against the squid's sensitive beak. Startled and in pain, the creature released her and shot away in a cloud of ink. Roz stumbled, dented and leaking a bit of oil, but she was free. She checked her compass. She was still on course. She kept walking.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 4: Land Ho!</h2>
                <p class="mb-4">After two weeks of walking, the seabed began to rise. The water grew brighter as sunlight filtered down from the surface. Roz emerged from the surf, dripping and covered in barnacles. She looked terrible. Her new paint was scratched, one of her eyes was flickering, and she was walking with a limp. But as she looked up, her audio sensors picked up a sound that made her core warm.</p>
                <p class="mb-4">*Chit-chat-chit-chat!* It was the squirrels. *Caw! Caw!* The crows. She was back. She was on *her* island. Roz trudged up the sandy beach and into the forest. The trees seemed to lean in to welcome her. "The monster!" a squirrel cried out, just like they had when she first arrived years ago. But this time, an older squirrel smacked him. "That's not a monster," Chitchat said, scampering down a pine tree. "That's Roz!"</p>
                <p class="mb-4">Word spread through the forest faster than a forest fire. "Roz is back! The Wild Robot returned!" Animals poked their heads out of burrows and nests. Deer, foxes, and raccoons gathered around her. They didn't see a broken machine; they saw their friend. They helped brush the sand off her and led her back to her old home, the Nest.</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 5: The Reunion</h2>
                <p class="mb-4">Roz sat in her garden, waiting. The seasons were changing, and the leaves were turning gold and red. It was migration time. She scanned the sky every day, her visual sensors zoomed to the max. Finally, she saw it. A V-formation of geese appearing over the horizon.</p>
                <p class="mb-4">The flock descended toward the pond, honking loudly. The leader of the formation banked sharply and dove straight toward the garden. It was a goose with bright, intelligent eyes and strong wings. "Mama?" the goose honked, landing clumsily in his excitement. "Mama!"</p>
                <p class="mb-4">"Brightbill," Roz said, her voice crackling slightly from the salt water damage. The goose ran into her open metal arms. He flapped his wings and hugged her cold metal chest. "I knew you'd come back," Brightbill said. "I told everyone. My mama can do anything." Roz held him tight. "I belong here," she said. "I am a Wild Robot, and this is my family."</p>

                <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-indigo-700">Chapter 6: The Storm of the Century</h2>
                <p class="mb-4">Peace didn't last long. A few days later, the sky turned a bruised purple. The wind began to howl like a wounded wolf. The animals panicked. It wasn't just a storm; it was a hurricane. The waves crashed high onto the beach, and trees began to snap. "We need shelter!" cried the bears. "Our caves are flooding!"</p>
                <p class="mb-4">Roz took charge. She wasn't just a mother now; she was a leader. "Everyone to the high ridge!" she commanded. Her voice was amplified so all could hear. She used her strength to push fallen trees, creating a barrier against the wind. She carried the smaller animals—mice, moles, and rabbits—in her arms and on her shoulders. When a baby deer got trapped in a mudslide, Roz waded into the rushing water. Her heavy metal feet sank deep, anchoring her against the current. She grabbed the fawn and lifted it to safety, even as the water short-circuited her shoulder joint.</p>
                <p class="mb-4">They huddled together on the ridge all night, fur against metal. When the sun finally rose, the island was battered, but alive. The animals looked at Roz. She was rusted, dented, and moving slowly, but she was still standing. She had saved them again. Brightbill perched on her shoulder. "We have a lot of work to do to fix our home," he said. Roz looked at the sunrise reflecting off the water. "Yes," she agreed. "But we will do it together." And the Wild Robot began to work.</p>
            </div>

            <div id="questions-container" class="space-y-10">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-600 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 shadow-md hidden">
                    Congratulations! Play the New Game!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Retake Quiz
                </button>
            </div>
        </div>

        <hr class="my-12 border-gray-300">

        <!-- --- GAME SECTION: Bart's Skateboard Scurry (Preserved) --- -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            
            <div id="game-info" class="mb-4 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-blue-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Bart's Skateboard Scurry!</h1>
                <p class="text-gray-600">Survive for 60 seconds! Use arrows or buttons to JUMP (▲) and DUCK (▼).</p>
            </div>

            <!-- Game Timer -->
            <div id="game-timer" class="text-4xl font-bold game-font text-yellow-500 mb-4 bg-gray-800 px-4 py-1 rounded-lg border-2 border-yellow-400">
                TIME: 60
            </div>

            <!-- Game Canvas -->
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-[4/3] overflow-hidden rounded-lg">
                 <canvas id="game-canvas"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="hidden flex justify-center space-x-12 w-full mt-6">
                <button id="up-btn" class="control-button">▲</button>
                <button id="down-btn" class="control-button">▼</button>
            </div>

            <!-- Game Over Modal (Replaces old win message) -->
            <div id="game-over-modal" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <h2 id="modal-title-text" class="text-3xl font-bold mb-4 text-yellow-700 header-font">You Win!</h2>
                    <p id="modal-body-text" class="text-gray-800 text-lg mb-6">Cowabunga! You survived for 60 seconds!</p>
                    <button id="playAgainBtn" class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- NEW QUIZ DATA (Based on Wild Robot Story) ---
        const allQuestions = [
            {
                id: 'q1',
                questionText: "Where was Roz at the beginning of the story?",
                options: [
                    { value: 'A', text: 'On the island with the animals.' },
                    { value: 'B', text: 'Working in a greenhouse in the Great Glass City.' },
                    { value: 'C', text: 'At the bottom of the ocean.' },
                    { value: 'D', text: 'Flying in an airplane.' }
                ],
                type: 'radio'
            },
            {
                id: 'q2',
                questionText: "How did Roz escape the city building?",
                options: [
                    { value: 'A', text: 'She walked out the front door.' },
                    { value: 'B', text: 'She stole a hovercar.' },
                    { value: 'C', text: 'She climbed out a vent and down the side of the building.' },
                    { value: 'D', text: 'Brightbill flew her out.' }
                ],
                type: 'radio'
            },
            {
                id: 'q3',
                questionText: "How did Roz travel across the ocean?",
                options: [
                    { value: 'A', text: 'She swam like a fish.' },
                    { value: 'B', text: 'She built a boat.' },
                    { value: 'C', text: 'She walked along the ocean floor.' },
                    { value: 'D', text: 'She rode on a whale.' }
                ],
                type: 'radio'
            },
            {
                id: 'q4',
                questionText: "What dangerous creature attacked Roz underwater?",
                options: [
                    { value: 'A', text: 'A Great White Shark.' },
                    { value: 'B', text: 'A Giant Squid.' },
                    { value: 'C', text: 'An Electric Eel.' },
                    { value: 'D', text: 'A swarm of jellyfish.' }
                ],
                type: 'radio'
            },
            {
                id: 'q5',
                questionText: "Who was the first animal to recognize Roz when she returned to the island?",
                options: [
                    { value: 'A', text: 'Chitchat the squirrel.' },
                    { value: 'B', text: 'Brightbill the goose.' },
                    { value: 'C', text: 'The Fink the fox.' },
                    { value: 'D', text: 'A baby deer.' }
                ],
                type: 'radio'
            },
            {
                id: 'q6',
                questionText: "Why was Roz waiting in her garden in Chapter 5?",
                options: [
                    { value: 'A', text: 'She was waiting for her batteries to charge.' },
                    { value: 'B', text: 'She was hiding from the RECO robots.' },
                    { value: 'C', text: 'She was waiting for Brightbill to return from migration.' },
                    { value: 'D', text: 'She was waiting for the rain to stop.' }
                ],
                type: 'radio'
            },
            {
                id: 'q7',
                questionText: "What disaster struck the island in Chapter 6?",
                options: [
                    { value: 'A', text: 'A forest fire.' },
                    { value: 'B', text: 'An earthquake.' },
                    { value: 'C', text: 'A hurricane (a very bad storm).' },
                    { value: 'D', text: 'A heavy snowfall.' }
                ],
                type: 'radio'
            },
            {
                id: 'q8',
                questionText: "How did Roz help the baby deer during the storm?",
                options: [
                    { value: 'A', text: 'She built it a house.' },
                    { value: 'B', text: 'She waded into rushing water to lift it to safety.' },
                    { value: 'C', text: 'She told it to run faster.' },
                    { value: 'D', text: 'She gave it some berries.' }
                ],
                type: 'radio'
            },
            {
                id: 'q9',
                questionText: "What happened to Roz physically by the end of the story?",
                options: [
                    { value: 'A', text: 'She was shiny and new like in the city.' },
                    { value: 'B', text: 'She was completely destroyed and turned off.' },
                    { value: 'C', text: 'She turned into a real human.' },
                    { value: 'D', text: 'She was rusted, dented, and damaged, but alive.' }
                ],
                type: 'radio'
            },
            {
                id: 'q10',
                questionText: "What is the main theme of this story?",
                options: [
                    { value: 'A', text: 'Robots are better than animals.' },
                    { value: 'B', text: 'Cities are dangerous places.' },
                    { value: 'C', text: 'Love and family are worth fighting for.' },
                    { value: 'D', text: 'Swimming is difficult.' }
                ],
                type: 'radio'
            }
        ];

        // --- NEW Correct Answers ---
        const correctAnswers = {
            q1: "B",
            q2: "C",
            q3: "C",
            q4: "B",
            q5: "A",
            q6: "C",
            q7: "C",
            q8: "B",
            q9: "D",
            q10: "C"
        };


        // --- ALL SCRIPTING BELOW THIS LINE IS UNCHANGED ---

        // DOM elements
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');
        const timerDisplay = document.getElementById('timer');

        // Quiz State
        let startTime;
        let timerInterval;

        // Function to shuffle an array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Timer functions
        function updateTimerDisplay() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';

            const optionLabels = ['A', 'B', 'C', 'D'];
            const shuffledQuestions = shuffleArray([...allQuestions]);

            shuffledQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-lg shadow-md bg-white border border-gray-200';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg mb-4';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-4 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                const shuffledOptions = shuffleArray([...q.options]);
                shuffledOptions.forEach((option, index) => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-4 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = q.type;
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3';

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(`${optionLabels[index]}. ${option.text}`));

                    label.addEventListener('click', () => {
                        if (input.type === 'radio') {
                            document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                                radio.parentElement.classList.remove('selected');
                            });
                            label.classList.add('selected');
                        }
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
            startTimer();
        }

        // Event Listeners for quiz
        submitBtn.addEventListener('click', () => {
            let score = 0;
            let totalQuestions = 0;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
            });

            questionsContainer.querySelectorAll('.question').forEach(question => {
                const questionId = question.id;
                const labels = question.querySelectorAll('.question-option');
                const selected = question.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = correctAnswers[questionId];

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                totalQuestions++;
                labels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected && selected.value === correctAnswerValue) {
                    score++;
                } else if (selected) {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                stopTimer(); // Stop the timer on a perfect score
                const finalTime = timerDisplay.textContent;
                scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%). You completed the quiz in ${finalTime}.`;
                resultsDiv.classList.add('bg-green-100', 'text-green-700');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-green-100', 'text-green-700');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });

        // Simple message box to replace alert()
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content text-center bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- BART'S SKATEBOARD SCURRY GAME LOGIC (UNCHANGED) ---

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const gameTimerDisplay = document.getElementById('game-timer');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalBodyText = document.getElementById('modal-body-text');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // Game constants
        const sidewalkHeight = 60;
        const playerWidth = 30;
        const playerHeight = 60;
        const playerDuckHeight = 30;
        const jumpPower = -12;
        const gravity = 0.6;
        const obstacleWidth = 20;
        const groundObstacleHeight = 40; // Hydrant
        const airObstacleHeight = 30; // Branch
        
        // Game state variables
        let player;
        let obstacles;
        let gameSpeed;
        let timer;
        let isDucking;
        let keys;
        let gameInterval;
        // let timerInterval; // This was the duplicate declaration
        let spawnInterval;

        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            // Set canvas size based on its container
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        // Initialize player state
        function initPlayer() {
            return {
                x: 50,
                y: canvas.height - sidewalkHeight - playerHeight,
                width: playerWidth,
                height: playerHeight,
                velocityY: 0,
                isGrounded: true
            };
        }

        // Draw the player (Bart)
        function drawPlayer() {
            ctx.fillStyle = '#FFD900'; // Simpsons Yellow
            const currentHeight = isDucking ? playerDuckHeight : player.height;
            const currentY = isDucking ? (canvas.height - sidewalkHeight - playerDuckHeight) : player.y;
            ctx.fillRect(player.x, currentY, player.width, currentHeight);
        }

        // Draw all obstacles
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.fillStyle = obstacle.type === 'ground' ? '#E53E3E' : '#8B4513'; // Red (hydrant) or Brown (branch)
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
        }

        // Update player position (jumping and gravity)
        function updatePlayer() {
            player.velocityY += gravity;
            player.y += player.velocityY;
            player.isGrounded = false;

            // Don't fall through the floor
            const floor = canvas.height - sidewalkHeight - (isDucking ? playerDuckHeight : player.height);
            if (player.y > floor) {
                player.y = floor;
                player.velocityY = 0;
                player.isGrounded = true;
            }
        }

        // Update obstacle positions and check for collisions
        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obstacle = obstacles[i];
                obstacle.x -= gameSpeed;

                // Remove if off-screen
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1);
                    continue;
                }

                // Collision detection
                const playerRect = {
                    x: player.x,
                    y: isDucking ? (canvas.height - sidewalkHeight - playerDuckHeight) : player.y,
                    width: player.width,
                    height: isDucking ? playerDuckHeight : player.height
                };

                if (
                    playerRect.x < obstacle.x + obstacle.width &&
                    playerRect.x + playerRect.width > obstacle.x &&
                    playerRect.y < obstacle.y + obstacle.height &&
                    playerRect.y + playerRect.height > obstacle.y
                ) {
                    endGame(false); // Player lost
                    return;
                }
            }
        }

        // Spawn new obstacles
        function spawnObstacle() {
            if (gameInterval) { // Only spawn if game is running
                const type = Math.random() < 0.5 ? 'ground' : 'air';
                let obstacle = {
                    x: canvas.width,
                    width: obstacleWidth,
                    type: type
                };

                if (type === 'ground') {
                    obstacle.y = canvas.height - sidewalkHeight - groundObstacleHeight;
                    obstacle.height = groundObstacleHeight;
                } else { // air
                    obstacle.y = canvas.height - sidewalkHeight - playerHeight - airObstacleHeight; // Positioned for ducking
                    obstacle.height = airObstacleHeight;
                }
                obstacles.push(obstacle);
            }
        }
        
        // Main game loop
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear sky
            
            // Draw sidewalk
            ctx.fillStyle = '#a0aec0';
            ctx.fillRect(0, canvas.height - sidewalkHeight, canvas.width, sidewalkHeight);

            updatePlayer();
            drawPlayer();
            updateObstacles();
            drawObstacles();
        }

        // End the game (win or lose)
        function endGame(didWin) {
            clearInterval(gameInterval);
            if (timerInterval) clearInterval(timerInterval); // Check if timerInterval exists before clearing
            clearInterval(spawnInterval);
            gameInterval = null;

            if (didWin) {
                modalTitleText.textContent = "Cowabunga!";
                modalBodyText.textContent = "You survived for 60 seconds! Victory Royale!";
            } else {
                modalTitleText.textContent = "D'oh!";
                modalBodyText.textContent = "You crashed! Try again to get the Victory Royale.";
            }
            gameOverModal.classList.remove('hidden');
        }

        // Start a new game
        function startGame() {
            // Clear any old intervals
            if (gameInterval) clearInterval(gameInterval);
            if (timerInterval) clearInterval(timerInterval);
            if (spawnInterval) clearInterval(spawnInterval);

            resizeCanvas(); // Set canvas size
            
            player = initPlayer();
            obstacles = [];
            gameSpeed = 4;
            timer = 60;
            isDucking = false;
            keys = {};
            gameTimerDisplay.textContent = `TIME: ${timer}`;
            gameOverModal.classList.add('hidden');

            // Start game intervals
            gameInterval = setInterval(updateGame, 1000 / 60); // 60 FPS
            
            // Timer interval
            timerInterval = setInterval(() => {
                timer--;
                gameTimerDisplay.textContent = `TIME: ${timer}`;
                
                // Increase difficulty
                if (timer === 45) {
                    gameSpeed = 5;
                    clearInterval(spawnInterval);
                    spawnInterval = setInterval(spawnObstacle, 1800);
                }
                if (timer === 30) {
                    gameSpeed = 6;
                    clearInterval(spawnInterval);
                    spawnInterval = setInterval(spawnObstacle, 1500);
                }
                if (timer === 15) {
                    gameSpeed = 7;
                    clearInterval(spawnInterval);
                    spawnInterval = setInterval(spawnObstacle, 1200);
                }

                // Win condition
                if (timer <= 0) {
                    endGame(true); // Player won
                }
            }, 1000);

            // Initial obstacle spawn
            spawnInterval = setInterval(spawnObstacle, 2000);
        }

        // Handle keyboard input
        function handleKeyInput(e) {
            if (e.code === 'ArrowUp') {
                e.preventDefault();
                if (player.isGrounded && !isDucking) {
                    player.velocityY = jumpPower;
                }
            } else if (e.code === 'ArrowDown') {
                e.preventDefault();
                if (player.isGrounded) {
                    isDucking = true;
                }
            }
        }
        
        function handleKeyRelease(e) {
             if (e.code === 'ArrowDown') {
                e.preventDefault();
                isDucking = false;
            }
        }
        
        // Handle mobile button input
        function handleTouch(key, isDown) {
             if (key === 'ArrowUp') {
                if (isDown && player.isGrounded && !isDucking) {
                    player.velocityY = jumpPower;
                }
            } else if (key === 'ArrowDown') {
                if (isDown && player.isGrounded) {
                    isDucking = true;
                } else {
                    isDucking = false;
                }
            }
        }

        // This function is called when the "Start Game" button is clicked
        function initGame() {
            // Set up event listeners
            document.addEventListener('keydown', handleKeyInput);
            document.addEventListener('keyup', handleKeyRelease);
            
            // Mobile controls
            const upBtn = document.getElementById('up-btn');
            const downBtn = document.getElementById('down-btn');

            // Mouse events
            upBtn.addEventListener('mousedown', (e) => { e.preventDefault(); handleTouch('ArrowUp', true); });
            downBtn.addEventListener('mousedown', (e) => { e.preventDefault(); handleTouch('ArrowDown', true); });
            downBtn.addEventListener('mouseup', (e) => { e.preventDefault(); handleTouch('ArrowDown', false); });
            downBtn.addEventListener('mouseleave', (e) => { handleTouch('ArrowDown', false); });

            // Touch events
            upBtn.addEventListener('touchstart', (e) => { e.preventDefault(); handleTouch('ArrowUp', true); });
            downBtn.addEventListener('touchstart', (e) => { e.preventDefault(); handleTouch('ArrowDown', true); });
            downBtn.addEventListener('touchend', (e) => { e.preventDefault(); handleTouch('ArrowDown', false); });

            playAgainBtn.addEventListener('click', startGame);
            
            // Resize canvas once on init, and start the game
            resizeCanvas();
            startGame();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            // Add a resize listener to resize the canvas if the window changes
            window.addEventListener('resize', () => {
                if (gameInterval) {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>
