<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3rd Grade Math Homework Helper</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Jost:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
            /* Light green background */
        }

        .header-font {
            font-family: 'Jost', sans-serif;
        }
        
        .game-font {
            font-family: 'Bangers', cursive;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .question-option.selected {
            background-color: #ecfdf5;
            /* Lightest green */
            border-left: 4px solid #10b981;
            /* Green-500 */
        }

        .question-option.correct-answer {
            background-color: #d1fae5;
            /* Lighter green */
            border-left: 4px solid #059669;
            /* Green-600 */
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            /* Light red */
            border-left: 4px solid #ef4444;
            /* Red-500 */
        }

        /* Styles for the Modal/Help Box */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .rdw-step {
            margin-top: 1rem;
            padding: 1rem;
            border-left: 4px solid #3b82f6;
            background-color: #eff6ff;
            border-radius: 6px;
        }
        
        /* Game Canvas Styles */
        #game-canvas {
            background: #0f172a; /* Dark Blue Space */
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            width: 100%;
            height: 100%;
            display: block;
        }

        .control-button {
            @apply bg-blue-600 text-white p-4 rounded-xl text-2xl font-bold transition-transform transform active:scale-95 shadow-lg border-b-4 border-blue-800;
            -webkit-tap-highlight-color: transparent; 
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fire-button {
            @apply bg-red-600 text-white p-4 rounded-xl text-xl font-bold transition-transform transform active:scale-95 shadow-lg border-b-4 border-red-800;
            -webkit-tap-highlight-color: transparent;
            width: 100px;
            height: 80px;
        }

        /* Simple table for question 1 */
        .data-table {
            @apply w-full max-w-sm mx-auto my-4 text-left;
        }
        .data-table th, .data-table td {
            @apply border border-gray-300 p-2;
        }
        .data-table th {
            @apply bg-gray-100 font-semibold;
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./index.html" class="text-blue-600 hover:text-blue-800 underline">
            &larr; Go to Reading
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 sm:p-10 mb-8 border-4 border-green-200">
        <h1 class="text-3xl sm:text-5xl font-extrabold text-center text-green-800 mb-2 header-font">
            Math Mission: Snoopy's Sleep Math
        </h1>
        <p class="text-gray-600 text-center mb-8 text-lg">
            Help the Peanuts gang calculate sheep, hours of sleep, and dream distances!
        </p>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="questions-container" class="space-y-8">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-700 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-full hover:bg-yellow-600 transition duration-300 shadow-md hidden">
                    Perfect Score! Play Space Blaster!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Try Again
                </button>
            </div>
        </div>

        <!-- RDW Help Modal (Initially hidden) -->
        <div id="helpModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="modalTitle" class="text-2xl font-bold text-blue-700 mb-4 header-font"></h2>
                <div id="modalBody" class="text-gray-700 text-base space-y-3">
                    <!-- RDW content inserted here -->
                </div>
                <button id="closeModalBtn" class="mt-6 bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition duration-300">
                    Close Explanation
                </button>
            </div>
        </div>


        <hr class="my-12 border-gray-200">

        <!-- Space Blaster Game Section -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[600px] p-4 bg-gray-900 rounded-lg shadow-inner border-4 border-blue-500" style="display: none;">
            
            <div id="game-info" class="mb-4 w-full max-w-xl text-center text-white bg-blue-900 p-4 rounded-xl border-2 border-blue-400 bg-opacity-80">
                <h1 class="text-3xl font-bold mb-2 game-font text-yellow-400 tracking-wider">Multiples of 10 Blaster!</h1>
                <p class="text-gray-200 text-sm sm:text-base">
                    <span class="text-green-400 font-bold">MISSION:</span> Blast numbers that are <span class="text-yellow-300 font-bold">MULTIPLES OF 10</span> (10, 20, 30...)!<br>
                    <span class="text-red-400 font-bold">WARNING:</span> Do NOT shoot other numbers. Do NOT crash!
                </p>
            </div>

            <!-- Game Stats -->
            <div class="flex justify-between w-full max-w-xl mb-2 px-4 text-white game-font text-2xl">
                <div id="score-display">SCORE: 0</div>
                <div id="lives-display" class="text-red-500">❤❤❤</div>
            </div>

            <!-- Game Canvas -->
            <div id="game-canvas-container" class="relative w-full max-w-xl aspect-[3/4] overflow-hidden rounded-lg border-2 border-blue-300 shadow-[0_0_15px_rgba(59,130,246,0.5)]">
                 <canvas id="game-canvas"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div id="mobile-controls" class="flex justify-between items-center w-full max-w-xl mt-6 px-2 gap-4">
                <div class="flex gap-4">
                    <button id="left-btn" class="control-button">◄</button>
                    <button id="right-btn" class="control-button">►</button>
                </div>
                <button id="fire-btn" class="fire-button">FIRE!</button>
            </div>

            <!-- Game Over Modal -->
            <div id="game-over-modal" class="modal-overlay hidden">
                 <div class="modal-content text-center bg-gray-800 border-4 border-red-500 text-white">
                    <h2 id="modal-title-text" class="text-4xl font-bold mb-4 text-red-500 game-font">GAME OVER</h2>
                    <p id="modal-body-text" class="text-gray-300 text-lg mb-6">Final Score: 0</p>
                    <button id="playAgainBtn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition duration-300 shadow-lg border-b-4 border-green-700 text-xl">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- QUIZ DATA ---
        // Questions based on "Peanuts & Sleep" Theme
        const allQuestions = [{
            id: 'q1',
            questionText: `Charlie Brown counts 48 sheep to fall asleep, and Linus counts 23 blankets.
                          <br>Estimate the <strong>total</strong> number of items counted by rounding each number to the nearest <strong>ten</strong>.`,
            options: [
                { value: 'A', text: '60 items' }, 
                { value: 'B', text: '70 items' }, 
                { value: 'C', text: '71 items' }, 
                { value: 'D', text: '80 items' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>Estimate the total of sheep (48) and blankets (23). Round both to the nearest ten, then add.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>48 rounds to 50 (closer to 50).<br>23 rounds to 20 (closer to 20).<br>Now add: 50 + 20.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>50 + 20 = 70. The estimated total is <strong>70 items</strong>.</p></div>`
        }, {
            id: 'q2',
            questionText: `Snoopy dreams he flies 92 miles. He wakes up after 59 miles.
                          <br>Estimate how many miles he has <strong>left</strong> to fly in his dream by rounding each number to the nearest <strong>ten</strong>.`,
            options: [
                { value: 'A', text: '30 miles' }, 
                { value: 'B', text: '33 miles' }, 
                { value: 'C', text: '40 miles' }, 
                { value: 'D', text: '150 miles' }
            ],
            correctAnswer: 'A',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>Estimate the difference between total distance (92) and distance flown (59). Round to the nearest ten, then subtract.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>92 rounds down to 90.<br>59 rounds up to 60.<br>Now subtract: 90 - 60.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>90 - 60 = 30. About <strong>30 miles</strong> left.</p></div>`
        }, {
            id: 'q3',
            questionText: 'Lucy sleeps for 348 minutes. What is 348 rounded to the nearest <strong>ten</strong>?',
            options: [
                { value: 'A', text: '300' }, 
                { value: 'B', text: '340' }, 
                { value: 'C', text: '350' }, 
                { value: 'D', text: '400' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to round the number 348 to the nearest ten.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Look at the tens place (4). Now look at the ones place (8). The rule is: "5 or more, raise the score."<br>Since 8 is "more," we "raise the score," meaning the tens place (4) goes up to 5. The one's place becomes 0.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>348 rounded to the nearest ten is <strong>350</strong>.</p></div>`
        }, {
            id: 'q4',
            questionText: `Which equation can you use to find the unknown number <em>r</em> of dream clouds? <br><strong>56 ÷ 8 = r</strong>`,
            options: [
                { value: 'A', text: '56 × r = 8' }, 
                { value: 'B', text: 'r × 8 = 56' }, 
                { value: 'C', text: '8 ÷ 56 = r' }, 
                { value: 'D', text: '56 × 8 = r' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We are dividing 56 clouds into 8 groups. <em>r</em> is the number in each group.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Think about the related multiplication fact. If 56 ÷ 8 = r, then r groups of 8 equals 56.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>The related equation is <strong>r × 8 = 56</strong>.</p></div>`
        }, {
            id: 'q5',
            questionText: `Marcie reads 48 pages before bed. She reads 8 pages each night. Fill in the blanks:<br><strong>6 × 8 = 48</strong><br>So, <strong>48 ÷ 8 = ___</strong><br>And <strong>48 ÷ 6 = ___</strong>`,
            options: [
                { value: 'A', text: '6 and 8' }, 
                { value: 'B', text: '8 and 6' }, 
                { value: 'C', text: '6 and 48' }, 
                { value: 'D', text: '7 and 9' }
            ],
            correctAnswer: 'A',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We have a multiplication fact: 6 groups of 8 make 48.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>This is a fact family (6, 8, 48).<br>If 6 × 8 = 48, then 48 ÷ 8 must be the other number (6).<br>And 48 ÷ 6 must be the other number (8).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>48 ÷ 8 = <strong>6</strong><br>48 ÷ 6 = <strong>8</strong>.</p></div>`
        }, {
            id: 'q6',
            questionText: `Use the <strong>distributive property</strong> to help Sally count <strong>9 × 6</strong> sheep jumping.<br>9 × 6 = (5 + ___) × 6<br>= (5 × 6) + (___ × 6)<br>= 30 + 24<br>= ___`,
            options: [
                { value: 'A', text: '4, 4, 54' }, 
                { value: 'B', text: '3, 3, 52' }, 
                { value: 'C', text: '5, 5, 60' }, 
                { value: 'D', text: '4, 4, 48' }
            ],
            correctAnswer: 'A',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We are breaking down the 9 in (9 × 6) into (5 + something).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>9 is 5 + 4. So the blank is 4.<br>The equation becomes (5 × 6) + (4 × 6).<br>5 × 6 = 30. 4 × 6 = 24.<br>30 + 24 = 54.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>The missing numbers are <strong>4, 4, and 54</strong>.</p></div>`
        }, {
            id: 'q7',
            questionText: `Peppermint Patty is arranging pillows for a sleepover. She wants to find <strong>? × 7 = 42</strong>. Which division equation helps her find the unknown factor?`,
            options: [
                { value: 'A', text: '42 ÷ 6 = 7' }, 
                { value: 'B', text: '42 ÷ 7 = ?' }, 
                { value: 'C', text: '7 ÷ 42 = ?' }, 
                { value: 'D', text: '42 × 7 = ?' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We have a missing factor in a multiplication problem. We can use division (the inverse operation) to find it.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Start with the total (42). Divide by the part we know (7). This will give us the missing part (?).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p><strong>42 ÷ 7 = ?</strong> is the correct division equation.</p></div>`
        }, {
            id: 'q8',
            questionText: `Charlie Brown helps count stars. Which equation shows the <strong>distributive property</strong> for <strong>8 × 4</strong>?`,
            options: [
                { value: 'A', text: '8 × 4 = 4 × 8' }, 
                { value: 'B', text: '8 × 4 = (4 × 4) + (4 × 4)' }, 
                { value: 'C', text: '8 × 4 = (8 × 2) + (8 × 2)' }, 
                { value: 'D', text: '8 × 4 = 32' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to break apart the 8 into smaller, easier numbers (like 4 + 4).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Break 8 into 4 + 4.<br>So 8 groups of 4 becomes (4 groups of 4) PLUS (4 groups of 4).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p><strong>8 × 4 = (4 × 4) + (4 × 4)</strong> is the correct distributive property equation.</p></div>`
        }, {
            id: 'q9',
            questionText: 'Franklin rests his eyes for a number of minutes that rounds to 210 (nearest ten). What is the <strong>greatest</strong> whole number of minutes he could have rested?',
            options: [
                { value: 'A', text: '209 minutes' }, 
                { value: 'B', text: '211 minutes' }, 
                { value: 'C', text: '214 minutes' }, 
                { value: 'D', text: '215 minutes' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>Find the biggest number that rounds down to 210.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>The numbers that round to 210 (nearest ten) start at 205 (which rounds up) and go all the way up to...<br>Let's check 215. The ones digit is 5 ("5 or more"), so 215 rounds up to 220. That's too high.<br>Let's check 214. The ones digit is 4 ("4 or less"), so 214 rounds down to 210. This is the biggest number that works.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>The greatest possible number of minutes is <strong>214 minutes</strong>.</p></div>`
        }, {
            id: 'q10',
            questionText: 'Snoopy\'s dream doghouse is 40 feet long and 20 feet wide. What is the <strong>perimeter</strong> (total distance around)?',
            options: [
                { value: 'A', text: '60 feet' }, 
                { value: 'B', text: '100 feet' }, 
                { value: 'C', text: '120 feet' }, 
                { value: 'D', text: '800 feet' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>Find the perimeter of a rectangle (40ft long, 20ft wide).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>A rectangle has 4 sides: 40, 40, 20, 20.<br>Add them all up: 40 + 40 + 20 + 20.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>80 + 40 = <strong>120 feet</strong>.</p></div>`
        }];


        // --- DOM Elements & Global State ---
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');

        const helpModal = document.getElementById('helpModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeModalBtn = document.getElementById('closeModalBtn');

        let isQuizSubmitted = false;


        // --- QUIZ FUNCTIONS ---

        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            isQuizSubmitted = false;

            allQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-xl shadow-md bg-white border border-green-100';

                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex justify-between items-start mb-4';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg text-gray-800 flex-grow';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                headerDiv.appendChild(questionText);

                const helpBtn = document.createElement('button');
                helpBtn.className = 'ml-4 text-sm font-semibold text-blue-500 hover:text-blue-700 transition duration-150 py-1 px-3 rounded-full border border-blue-200';
                helpBtn.textContent = 'Get Help';
                helpBtn.setAttribute('data-question-id', q.id);
                helpBtn.addEventListener('click', showHelpModal);
                headerDiv.appendChild(helpBtn);

                questionDiv.appendChild(headerDiv);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-3 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                q.options.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-3 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3 accent-green-600';

                    label.appendChild(input);
                    const optionTextNode = document.createElement('span');
                    optionTextNode.innerHTML = option.text;
                    label.appendChild(optionTextNode);

                    label.addEventListener('click', () => {
                        document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                            radio.parentElement.classList.remove('selected');
                        });
                        label.classList.add('selected');
                        input.checked = true; 
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
        }

        submitBtn.addEventListener('click', () => {
            if (isQuizSubmitted) return;
            isQuizSubmitted = true;
            let score = 0;
            let totalQuestions = allQuestions.length;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
                label.classList.add('cursor-default');
            });
            document.querySelectorAll('.question input').forEach(input => input.disabled = true);

            allQuestions.forEach(q => {
                const questionDiv = document.getElementById(q.id);
                const selected = questionDiv.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = q.correctAnswer;
                if (!selected) { allAnswered = false; return; }
                questionDiv.querySelectorAll('.question-option').forEach(label => {
                    if (label.querySelector('input').value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });
                if (selected.value === correctAnswerValue) {
                    score++;
                } else {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                document.querySelectorAll('.question input').forEach(input => input.disabled = false);
                isQuizSubmitted = false;
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                resultsDiv.classList.add('bg-yellow-100', 'text-green-800');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-yellow-100', 'text-green-800');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
            document.querySelectorAll('.question input').forEach(input => input.disabled = false);
            document.querySelectorAll('.question-option').forEach(label => label.classList.remove('cursor-default'));
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'grid';
            initGame();
        });

        function showHelpModal(event) {
            const questionId = event.currentTarget.getAttribute('data-question-id');
            const question = allQuestions.find(q => q.id === questionId);
            if (question) {
                modalTitle.textContent = `Read-Draw-Write Help for Question ${questionId.replace('q', '')}`;
                modalBody.innerHTML = question.rdw;
                helpModal.classList.remove('hidden');
            }
        }
        closeModalBtn.addEventListener('click', () => { helpModal.classList.add('hidden'); });
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) { helpModal.classList.add('hidden'); }
        });

        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>`;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }

        // --- SPACE BLASTER GAME LOGIC ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const livesDisplay = document.getElementById('lives-display');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalBodyText = document.getElementById('modal-body-text');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const fireBtn = document.getElementById('fire-btn');

        // Game State
        let gameLoop;
        let spawnInterval;
        let score = 0;
        let lives = 3;
        let shipX = 0;
        const shipWidth = 40;
        const shipHeight = 40;
        const shipSpeed = 5;
        let bullets = [];
        let enemies = [];
        let keys = {};
        
        // Colors
        const SHIP_COLOR = '#00FFFF'; // Cyan
        const BULLET_COLOR = '#FFFF00'; // Yellow
        const TEXT_COLOR = '#FFFFFF';

        // Resize canvas
        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            shipX = canvas.width / 2 - shipWidth / 2;
        }

        // Game Objects
        class Bullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 4;
                this.height = 10;
                this.speed = 7;
                this.active = true;
            }
            update() {
                this.y -= this.speed;
                if (this.y < 0) this.active = false;
            }
            draw() {
                ctx.fillStyle = BULLET_COLOR;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        class Enemy {
            constructor() {
                this.width = 40;
                this.height = 30;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height;
                this.speed = Math.random() * 1.5 + 0.5; // Reduced speed to 0.5 to 2
                this.active = true;
                
                // Determine if this is a multiple of 10
                this.isMultipleOf10 = Math.random() < 0.4; // 40% chance
                if (this.isMultipleOf10) {
                    this.value = Math.floor(Math.random() * 9 + 1) * 10; // 10, 20... 90
                } else {
                    // Generate a non-multiple of 10
                    let num;
                    do {
                        num = Math.floor(Math.random() * 99 + 1);
                    } while (num % 10 === 0);
                    this.value = num;
                }
            }
            update() {
                this.y += this.speed;
                // Check if it hit bottom
                if (this.y > canvas.height) {
                    this.active = false;
                    // Penalty for missing a multiple of 10
                    if (this.isMultipleOf10) {
                        score = Math.max(0, score - 10);
                        updateUI();
                        showFloatingText("-10", this.x, canvas.height - 20, "red");
                    }
                }
            }
            draw() {
                ctx.font = "bold 20px 'Bangers'";
                ctx.fillStyle = this.isMultipleOf10 ? "#4ade80" : "#f87171"; // Green for targets, Red for hazards
                ctx.fillText(this.value, this.x, this.y + 20);
            }
        }

        // Floating Text for score changes
        let floatingTexts = [];
        function showFloatingText(text, x, y, color) {
            floatingTexts.push({ text, x, y, color, life: 30 });
        }

        function updateUI() {
            scoreDisplay.textContent = `SCORE: ${score}`;
            livesDisplay.textContent = "❤".repeat(lives);
        }

        function spawnEnemy() {
            enemies.push(new Enemy());
        }

        function endGame(reason) {
            cancelAnimationFrame(gameLoop);
            clearInterval(spawnInterval);
            modalBodyText.textContent = `${reason}\nFinal Score: ${score}`;
            gameOverModal.classList.remove('hidden');
        }

        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Move Ship
            if ((keys['ArrowLeft'] || keys['a']) && shipX > 0) shipX -= shipSpeed;
            if ((keys['ArrowRight'] || keys['d']) && shipX < canvas.width - shipWidth) shipX += shipSpeed;

            // Draw Ship
            ctx.fillStyle = SHIP_COLOR;
            // Simple triangle ship
            ctx.beginPath();
            ctx.moveTo(shipX + shipWidth / 2, canvas.height - shipHeight);
            ctx.lineTo(shipX + shipWidth, canvas.height);
            ctx.lineTo(shipX, canvas.height);
            ctx.fill();

            // Bullets
            bullets.forEach((b, i) => {
                b.update();
                b.draw();
                if (!b.active) bullets.splice(i, 1);
            });

            // Enemies
            enemies.forEach((e, i) => {
                e.update();
                e.draw();

                // Check collision with Ship
                if (
                    shipX < e.x + e.width &&
                    shipX + shipWidth > e.x &&
                    canvas.height - shipHeight < e.y + e.height &&
                    canvas.height > e.y
                ) {
                    lives = 0; // Instant Game Over on crash
                    endGame("You crashed into a number!");
                    return;
                }

                // Check collision with Bullets
                bullets.forEach((b, j) => {
                    if (
                        b.x < e.x + e.width &&
                        b.x + b.width > e.x &&
                        b.y < e.y + e.height &&
                        b.y + b.height > e.y
                    ) {
                        // Hit!
                        b.active = false;
                        e.active = false;
                        
                        if (e.isMultipleOf10) {
                            score += 10;
                            showFloatingText("+10", e.x, e.y, "#4ade80");
                        } else {
                            endGame("You shot a non-multiple of 10!");
                        }
                        updateUI();
                    }
                });

                if (!e.active) enemies.splice(i, 1);
            });

            // Floating Texts
            floatingTexts.forEach((ft, i) => {
                ft.y -= 1;
                ft.life--;
                ctx.fillStyle = ft.color;
                ctx.font = "bold 24px Arial";
                ctx.fillText(ft.text, ft.x, ft.y);
                if (ft.life <= 0) floatingTexts.splice(i, 1);
            });

            if (lives > 0) {
                gameLoop = requestAnimationFrame(update);
            }
        }

        function initGame() {
            resizeCanvas();
            score = 0;
            lives = 1; // "Shooting a non multiple of 10 ends the game" implies instant fail conditions usually, but let's stick to the prompt's collision logic
            updateUI();
            bullets = [];
            enemies = [];
            floatingTexts = [];
            
            // Input Listeners
            document.addEventListener('keydown', (e) => {
                keys[e.key] = true;
                if (e.code === 'Space') {
                    bullets.push(new Bullet(shipX + shipWidth / 2 - 2, canvas.height - shipHeight));
                }
            });
            document.addEventListener('keyup', (e) => keys[e.key] = false);

            // Mobile Controls
            let leftInterval, rightInterval;
            leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ArrowLeft'] = true; });
            leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys['ArrowLeft'] = false; });
            leftBtn.addEventListener('mousedown', (e) => { e.preventDefault(); keys['ArrowLeft'] = true; });
            leftBtn.addEventListener('mouseup', (e) => { e.preventDefault(); keys['ArrowLeft'] = false; });
            leftBtn.addEventListener('mouseleave', () => keys['ArrowLeft'] = false);

            rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ArrowRight'] = true; });
            rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys['ArrowRight'] = false; });
            rightBtn.addEventListener('mousedown', (e) => { e.preventDefault(); keys['ArrowRight'] = true; });
            rightBtn.addEventListener('mouseup', (e) => { e.preventDefault(); keys['ArrowRight'] = false; });
            rightBtn.addEventListener('mouseleave', () => keys['ArrowRight'] = false);

            fireBtn.addEventListener('touchstart', (e) => { 
                e.preventDefault(); 
                bullets.push(new Bullet(shipX + shipWidth / 2 - 2, canvas.height - shipHeight)); 
            });
            fireBtn.addEventListener('mousedown', (e) => { 
                e.preventDefault(); 
                bullets.push(new Bullet(shipX + shipWidth / 2 - 2, canvas.height - shipHeight)); 
            });

            playAgainBtn.addEventListener('click', () => {
                gameOverModal.classList.add('hidden');
                initGame();
            });

            gameLoop = requestAnimationFrame(update);
            clearInterval(spawnInterval);
            spawnInterval = setInterval(spawnEnemy, 1500); // Spawn every 1.5 seconds
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            window.addEventListener('resize', () => {
                if (document.getElementById('game-container').style.display !== 'none') {
                    resizeCanvas();
                }
            });
        });

    </script>
</body>

</html>
