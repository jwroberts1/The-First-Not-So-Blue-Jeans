<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3rd Grade Math Homework Helper</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Jost:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
            /* Light green background */
        }

        .header-font {
            font-family: 'Jost', sans-serif;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .question-option.selected {
            background-color: #ecfdf5;
            /* Lightest green */
            border-left: 4px solid #10b981;
            /* Green-500 */
        }

        .question-option.correct-answer {
            background-color: #d1fae5;
            /* Lighter green */
            border-left: 4px solid #059669;
            /* Green-600 */
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            /* Light red */
            border-left: 4px solid #ef4444;
            /* Red-500 */
        }

        /* Styles for the Modal/Help Box */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .rdw-step {
            margin-top: 1rem;
            padding: 1rem;
            border-left: 4px solid #3b82f6;
            background-color: #eff6ff;
            border-radius: 6px;
        }

        /* Game specific styles */
        #game-canvas {
            background-color: #fefce8;
            border: 4px solid #facc15;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.5);
            margin-top: 1rem;
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Link -->
    <div class="max-w-4xl mx-auto text-right mb-4">
        <a href="./index.html" class="text-green-600 hover:text-green-800 font-semibold underline text-lg">
            &larr; Go to Reading Review
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 sm:p-10 mb-8 border-4 border-green-200">
        <h1 class="text-3xl sm:text-5xl font-extrabold text-center text-green-800 mb-2 header-font">
            Math Mission: Equal Groups & Arrays
        </h1>
        <p class="text-gray-600 text-center mb-8 text-lg">
            3rd Grade Practice: Solve 10 problems to unlock the Array Builder Game!
        </p>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="questions-container" class="space-y-8">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-700 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-full hover:bg-yellow-600 transition duration-300 shadow-md hidden">
                    Perfect Score! Play the Array Builder!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Try Again
                </button>
            </div>
        </div>

        <!-- RDW Help Modal (Initially hidden) -->
        <div id="helpModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="modalTitle" class="text-2xl font-bold text-blue-700 mb-4 header-font"></h2>
                <div id="modalBody" class="text-gray-700 text-base space-y-3">
                    <!-- RDW content inserted here -->
                </div>
                <button id="closeModalBtn" class="mt-6 bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition duration-300">
                    Close Explanation
                </button>
            </div>
        </div>


        <hr class="my-12 border-gray-200">

        <!-- Game Section (Array Builder) -->
        <div id="game-container" class="flex flex-col items-center justify-center min-h-[500px] p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            <div id="game-info" class="mb-6 w-full max-w-xl text-center text-gray-800 bg-white p-4 rounded-xl border-2 border-yellow-400">
                <h1 class="text-3xl font-bold mb-2 header-font text-yellow-700">The Array Builder</h1>
                <p class="text-gray-600 mb-4">Build arrays by entering the number of **Rows** and **Columns**.</p>
                <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <div class="flex items-center space-x-2">
                        <label for="rows" class="font-semibold">Rows:</label>
                        <input type="number" id="rows" value="4" min="1" max="10" class="w-20 p-2 border rounded-lg text-center">
                    </div>
                    <span class="text-2xl font-bold text-gray-500 hidden sm:block">x</span>
                    <div class="flex items-center space-x-2">
                        <label for="cols" class="font-semibold">Columns:</label>
                        <input type="number" id="cols" value="6" min="1" max="10" class="w-20 p-2 border rounded-lg text-center">
                    </div>
                </div>
                <button id="buildArrayBtn" class="mt-4 bg-purple-500 text-white font-bold py-2 px-6 rounded-full hover:bg-purple-600 transition duration-300 shadow-md">
                    Build Array
                </button>
                <div class="mt-4 text-xl font-semibold">
                    Total Blocks: <span id="totalBlocks" class="font-bold text-purple-700">24</span>
                </div>
            </div>
            <div class="w-full max-w-xl aspect-square overflow-hidden rounded-lg">
                <canvas id="game-canvas" class="w-full h-full"></canvas>
            </div>
        </div>
    </div>

    <script>
        // --- QUIZ DATA ---
        const allQuestions = [{
            id: 'q1',
            questionText: 'What number makes this equation true? 3 X ___ = 12',
            options: [{
                value: 'A',
                text: '3'
            }, {
                value: 'B',
                text: '4'
            }, {
                value: 'C',
                text: '5'
            }, {
                value: 'D',
                text: '9'
            }],
            correctAnswer: 'B',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>The equation is a multiplication problem where one factor is missing. We know one factor is 3 and the product is 12.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>You can think of this as 12 รท 3 = ?. Draw 12 dots and circle them in groups of 3. You will have 4 groups.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>By skip-counting by 3 (3, 6, 9, 12), we see that it takes 4 steps. So, 3 X 4 = 12. The missing number is <strong>4</strong>.</p>
                </div>
            `
        }, {
            id: 'q2',
            questionText: 'Mr. Davis sets up chairs for a school play. He sets up 4 rows of 8 chairs. Which array shows how he set up the chairs?',
            options: [{
                value: 'A',
                text: `Array A (4 rows, 8 columns):<br><svg width="128" height="64" class="mx-auto mt-2 bg-gray-100 rounded">${Array(4).fill(0).map((_, r) => Array(8).fill(0).map((_, c) => `<rect x="${c*16}" y="${r*16}" width="15" height="15" fill="#60a5fa"></rect>`).join('')).join('')}</svg>`
            }, {
                value: 'B',
                text: `Array B (8 rows, 4 columns):<br><svg width="64" height="128" class="mx-auto mt-2 bg-gray-100 rounded">${Array(8).fill(0).map((_, r) => Array(4).fill(0).map((_, c) => `<rect x="${c*16}" y="${r*16}" width="15" height="15" fill="#60a5fa"></rect>`).join('')).join('')}</svg>`
            }, {
                value: 'C',
                text: `Array C (4 rows, 4 columns):<br><svg width="64" height="64" class="mx-auto mt-2 bg-gray-100 rounded">${Array(4).fill(0).map((_, r) => Array(4).fill(0).map((_, c) => `<rect x="${c*16}" y="${r*16}" width="15" height="15" fill="#60a5fa"></rect>`).join('')).join('')}</svg>`
            }, {
                value: 'D',
                text: `Array D (3 rows, 8 columns):<br><svg width="128" height="48" class="mx-auto mt-2 bg-gray-100 rounded">${Array(3).fill(0).map((_, r) => Array(8).fill(0).map((_, c) => `<rect x="${c*16}" y="${r*16}" width="15" height="15" fill="#60a5fa"></rect>`).join('')).join('')}</svg>`
            }],
            correctAnswer: 'A',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>The problem says there are <strong>4 rows</strong> and <strong>8 chairs in each row</strong>. Rows go across (horizontally).</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>An array with 4 rows and 8 columns will have 4 lines of chairs going across, with 8 chairs in each line.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>Array A is the only one with exactly 4 rows and 8 columns. This represents the equation 4 X 8.</p>
                </div>
            `
        }, {
            id: 'q3',
            questionText: 'Based on the problem about Mr. Davis\'s chairs (4 rows of 8 chairs), which two expressions show the total number of chairs?',
            options: [{
                value: 'A',
                text: '4 X 8 and 8+8+8+8'
            }, {
                value: 'B',
                text: '8 รท 4 and 4+4+4+4'
            }, {
                value: 'C',
                text: '4+8 and 8 X 8'
            }, {
                value: 'D',
                text: '4 X 4 and 8+8'
            }],
            correctAnswer: 'A',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>We need to find two ways to write the total for 4 rows of 8. This means 4 groups of 8.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>You can write this as a multiplication sentence (4 X 8) or as repeated addition (8+8+8+8).</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>The expression 4 X 8 means "4 groups of 8". The expression 8+8+8+8 also means adding 8 four times. Both are correct.</p>
                </div>
            `
        }, {
            id: 'q4',
            questionText: 'How many total chairs did Mr. Davis set up?',
            options: [{
                value: 'A',
                text: '12 chairs'
            }, {
                value: 'B',
                text: '24 chairs'
            }, {
                value: 'C',
                text: '32 chairs'
            }, {
                value: 'D',
                text: '36 chairs'
            }],
            correctAnswer: 'C',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>To find the total, we need to solve for 4 rows of 8 chairs, which is 4 X 8.</p>
                </div>
                 <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>You can count the boxes in the correct array from the previous question, or use repeated addition: 8, 16, 24, 32.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>The multiplication fact is 4 X 8 = 32. There are <strong>32 chairs</strong> in total.</p>
                </div>
            `
        }, {
            id: 'q5',
            questionText: 'Is the expression (4 X 5) + (2 X 5) equal to 6 X 5?',
            options: [{
                value: 'A',
                text: 'Yes'
            }, {
                value: 'B',
                text: 'No'
            }],
            correctAnswer: 'A',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>This is a distributive property problem. It asks if breaking the 6 in 6 X 5 into a (4+2) gives the same answer.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>Solve both sides. Left side: 6 X 5 = 30. Right side: (4 X 5) + (2 X 5) = 20 + 10 = 30.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>Since both sides equal 30, the expression is true. The answer is <strong>Yes</strong>.</p>
                </div>
            `
        }, {
            id: 'q6',
            questionText: `An array is shown with 7 rows of 4 stars. Solve for the blanks: <br> 7 X 4 = (5 X 4) + (___ X 4) <br> 7 X 4 = 20 + ___ <br> 7 X 4 = ___`,
            options: [{
                value: 'A',
                text: 'Blanks: 2, 8, 28'
            }, {
                value: 'B',
                text: 'Blanks: 2, 4, 28'
            }, {
                value: 'C',
                text: 'Blanks: 1, 8, 28'
            }, {
                value: 'D',
                text: 'Blanks: 2, 8, 32'
            }],
            correctAnswer: 'A',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>We are breaking apart a 7 X 4 array. First, find the missing part of 7 if one part is 5. Second, solve for that part. Third, find the grand total.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw and Write:</p>
                    <p>First blank: 5 + ___ = 7. The answer is 2. So the first line is (5 X 4) + (2 X 4).</p>
                    <p>Second blank: We know (5 X 4) = 20. The second part is (2 X 4), which is 8. So the second line is 20 + 8.</p>
                    <p>Third blank: The total is 20 + 8 = 28. So the final line is 7 X 4 = 28.</p>
                </div>
                <div class="rdw-step">
                     <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>The numbers that fill the blanks are <strong>2, 8, and 28</strong>.</p>
                </div>
            `
        }, {
            id: 'q7',
            questionText: 'Which two situations can be represented by 12 รท 3?',
            options: [{
                value: 'A',
                text: 'The total of 12 books and 3 books.'
            }, {
                value: 'B',
                text: 'The number of rows when 12 flowers are planted in rows of 3, AND the number of marbles each child gets when 3 children share 12 marbles.'
            }, {
                value: 'C',
                text: 'The total grapes when 3 children each have 3 grapes.'
            }, {
                value: 'D',
                text: 'The difference between 12 cookies and 3 cookies.'
            }],
            correctAnswer: 'B',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>The expression 12 รท 3 can mean two things: splitting 12 into groups of 3 (to find the number of groups), or splitting 12 into 3 equal groups (to find the size of each group).</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>Planting 12 flowers in rows of 3 is splitting 12 into groups of 3. Sharing 12 marbles among 3 children is splitting 12 into 3 equal groups.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>Both the flower problem and the marble problem are correct representations of division. Addition, subtraction, and multiplication are incorrect.</p>
                </div>
            `
        }, {
            id: 'q8',
            questionText: "Miss Wong's class earns 5 points for each question they answer correctly. On Monday, they earn 40 points. How many questions did they answer correctly?",
            options: [{
                value: 'A',
                text: '6 questions'
            }, {
                value: 'B',
                text: '7 questions'
            }, {
                value: 'C',
                text: '8 questions'
            }, {
                value: 'D',
                text: '9 questions'
            }],
            correctAnswer: 'C',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>The total points is 40. Each question is worth 5 points. We need to find the number of questions. The expression is 5 X ___ = 40.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>This is the same as asking 40 รท 5 = ?. You can skip-count by 5 until you reach 40: 5, 10, 15, 20, 25, 30, 35, 40. That took 8 steps.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>Since 5 X 8 = 40, they answered <strong>8 questions</strong> correctly.</p>
                </div>
            `
        }, {
            id: 'q9',
            questionText: 'On Tuesday, Miss Wong\'s class answers 7 questions correctly. What is the total number of points the class earned on Monday AND Tuesday?',
            options: [{
                value: 'A',
                text: '35 points'
            }, {
                value: 'B',
                text: '47 points'
            }, {
                value: 'C',
                text: '75 points'
            }, {
                value: 'D',
                text: '85 points'
            }],
            correctAnswer: 'C',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read (Two Steps!):</p>
                    <p>Step 1: Find the points for Tuesday (7 questions at 5 points each). Step 2: Add Tuesday's points to Monday's points (40).</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw:</p>
                    <p>Step 1: 7 X 5 = ?. Step 2: 40 + answer from Step 1 = ?</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>Step 1: 7 X 5 = 35 points for Tuesday. Step 2: 40 + 35 = 75 total points. The total is <strong>75 points</strong>.</p>
                </div>
            `
        }, {
            id: 'q10',
            questionText: 'Which expression equals 30?',
            options: [{
                value: 'A',
                text: '6 X 5'
            }, {
                value: 'B',
                text: '8 รท 2'
            }, {
                value: 'C',
                text: '20 รท 4'
            }, {
                value: 'D',
                text: '7 X 3'
            }],
            correctAnswer: 'A',
            rdw: `
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">1. Read:</p>
                    <p>We need to solve each of the four expressions to see which one equals 30.</p>
                </div>
                <div class="rdw-step">
                    <p class="font-bold text-lg text-blue-700">2. Draw and Write:</p>
                    <p>A: 6 X 5 = 30.</p>
                    <p>B: 8 รท 2 = 4.</p>
                    <p>C: 20 รท 4 = 5.</p>
                    <p>D: 7 X 3 = 21.</p>
                </div>
                <div class="rdw-step">
                     <p class="font-bold text-lg text-blue-700">3. Write:</p>
                    <p>The only expression that equals 30 is <strong>6 X 5</strong>.</p>
                </div>
            `
        }];


        // --- DOM Elements & Global State ---
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');

        const helpModal = document.getElementById('helpModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeModalBtn = document.getElementById('closeModalBtn');

        let isQuizSubmitted = false;


        // --- QUIZ FUNCTIONS ---

        // Renders the quiz questions to the page
        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            isQuizSubmitted = false;

            allQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-xl shadow-md bg-white border border-green-100';

                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex justify-between items-start mb-4';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg text-gray-800 flex-grow';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                headerDiv.appendChild(questionText);

                // Get Help Button
                const helpBtn = document.createElement('button');
                helpBtn.className = 'ml-4 text-sm font-semibold text-blue-500 hover:text-blue-700 transition duration-150 py-1 px-3 rounded-full border border-blue-200';
                helpBtn.textContent = 'Get Help';
                helpBtn.setAttribute('data-question-id', q.id);
                helpBtn.addEventListener('click', showHelpModal);
                headerDiv.appendChild(helpBtn);

                questionDiv.appendChild(headerDiv);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-3 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                q.options.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-3 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3 accent-green-600';

                    label.appendChild(input);
                    // Use innerHTML to render the SVG in the array question
                    const optionTextNode = document.createElement('span');
                    optionTextNode.innerHTML = option.text;
                    label.appendChild(optionTextNode);


                    label.addEventListener('click', () => {
                        // Remove 'selected' from all radio buttons in this group
                        document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                            radio.parentElement.classList.remove('selected');
                        });
                        // Add 'selected' to the clicked label
                        label.classList.add('selected');
                        input.checked = true; // Ensure the radio button is marked checked
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
        }

        // Event listener for quiz submission
        submitBtn.addEventListener('click', () => {
            if (isQuizSubmitted) return; // Prevent double submission
            isQuizSubmitted = true;

            let score = 0;
            let totalQuestions = allQuestions.length;
            let allAnswered = true;

            // Reset classes
            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
                label.classList.add('cursor-default'); // Disable hover for review mode
            });
            document.querySelectorAll('.question input').forEach(input => input.disabled = true);

            allQuestions.forEach(q => {
                const questionDiv = document.getElementById(q.id);
                const selected = questionDiv.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = q.correctAnswer;

                if (!selected) {
                    allAnswered = false;
                    return;
                }

                questionDiv.querySelectorAll('.question-option').forEach(label => {
                    const input = label.querySelector('input');
                    if (input.value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selected.value === correctAnswerValue) {
                    score++;
                } else {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                // Re-enable options since submission was invalid
                document.querySelectorAll('.question input').forEach(input => input.disabled = false);
                isQuizSubmitted = false;
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                resultsDiv.classList.add('bg-yellow-100', 'text-green-800');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-yellow-100', 'text-green-800');
            }
        });

        // Event listener for retaking the quiz
        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
            // Re-enable options
            document.querySelectorAll('.question input').forEach(input => input.disabled = false);
            document.querySelectorAll('.question-option').forEach(label => label.classList.remove('cursor-default'));
        });

        // Event listener to start the game
        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            initGame();
        });


        // --- HELP MODAL FUNCTIONS ---

        // Shows the RDW explanation modal
        function showHelpModal(event) {
            const questionId = event.currentTarget.getAttribute('data-question-id');
            const question = allQuestions.find(q => q.id === questionId);

            if (question) {
                modalTitle.textContent = `Read-Draw-Write Help for Question ${questionId.replace('q', '')}`;
                modalBody.innerHTML = question.rdw;
                helpModal.classList.remove('hidden');
            }
        }

        // Closes the RDW explanation modal
        closeModalBtn.addEventListener('click', () => {
            helpModal.classList.add('hidden');
        });

        // Closes the modal when clicking outside of it
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                helpModal.classList.add('hidden');
            }
        });

        // Simple message box (replaces alert())
        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }


        // --- ARRAY BUILDER GAME LOGIC ---

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const rowsInput = document.getElementById('rows');
        const colsInput = document.getElementById('cols');
        const totalBlocksEl = document.getElementById('totalBlocks');
        const buildArrayBtn = document.getElementById('buildArrayBtn');

        let blockSize = 40;
        const padding = 20;

        function drawArray(rows, cols) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fefce8'; // Canvas background
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const totalWidth = cols * blockSize;
            const totalHeight = rows * blockSize;

            // Center the array
            const startX = (canvas.width - totalWidth) / 2;
            const startY = (canvas.height - totalHeight) / 2;

            ctx.lineWidth = 2;
            ctx.strokeStyle = '#facc15'; // Yellow border

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const x = startX + c * blockSize;
                    const y = startY + r * blockSize;

                    // Draw the block (a filled rectangle)
                    ctx.fillStyle = r % 2 === 0 ? '#10b981' : '#059669'; // Alternating green colors
                    ctx.fillRect(x, y, blockSize, blockSize);

                    // Draw the block border (grid lines)
                    ctx.strokeRect(x, y, blockSize, blockSize);
                }
            }
        }

        function handleBuildArray() {
            let rows = parseInt(rowsInput.value) || 1;
            let cols = parseInt(colsInput.value) || 1;

            // Clamp values
            rows = Math.min(10, Math.max(1, rows));
            cols = Math.min(10, Math.max(1, cols));

            rowsInput.value = rows;
            colsInput.value = cols;

            const total = rows * cols;
            totalBlocksEl.textContent = total;

            // Adjust block size based on the larger dimension to fit the canvas
            const maxDimension = Math.max(rows, cols);
            const availableSpace = Math.min(canvas.width, canvas.height) - 2 * padding;
            blockSize = Math.floor(availableSpace / maxDimension);
            blockSize = Math.max(20, Math.min(50, blockSize)); // Keep it reasonable

            drawArray(rows, cols);
        }

        buildArrayBtn.addEventListener('click', handleBuildArray);

        function resizeCanvas() {
            // Ensure the canvas is square and fits its container
            const size = canvas.parentElement.clientWidth;
            canvas.width = size;
            canvas.height = size;
            handleBuildArray(); // Redraw array on resize
        }

        function initGame() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            // Attach initial resize listener for the game setup
            window.addEventListener('resize', () => {
                if (gameContainer.style.display === 'flex') {
                    resizeCanvas();
                }
            });
        });
    </script>
</body>

</html>

