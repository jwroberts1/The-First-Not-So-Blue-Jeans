<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3rd Grade Math Homework Helper</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Jost:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
            /* Light green background */
        }

        .header-font {
            font-family: 'Jost', sans-serif;
        }

        .question-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .question-option:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .question-option.selected {
            background-color: #ecfdf5;
            /* Lightest green */
            border-left: 4px solid #10b981;
            /* Green-500 */
        }

        .question-option.correct-answer {
            background-color: #d1fae5;
            /* Lighter green */
            border-left: 4px solid #059669;
            /* Green-600 */
        }

        .question-option.incorrect-answer {
            background-color: #fee2e2;
            /* Light red */
            border-left: 4px solid #ef4444;
            /* Red-500 */
        }

        /* Styles for the Modal/Help Box */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .rdw-step {
            margin-top: 1rem;
            padding: 1rem;
            border-left: 4px solid #3b82f6;
            background-color: #eff6ff;
            border-radius: 6px;
        }
        
        /* New Game Styles */
        .container-btn {
            @apply p-2 border-2 border-gray-300 rounded-lg flex items-center justify-center transition-all duration-200;
        }
        .container-btn.selected {
            @apply border-blue-500 bg-blue-50 shadow-lg;
        }
        #visualizer-svg svg {
            width: 100%;
            height: 100%;
            max-height: 400px;
        }

        /* Simple table for question 1 */
        .data-table {
            @apply w-full max-w-sm mx-auto my-4 text-left;
        }
        .data-table th, .data-table td {
            @apply border border-gray-300 p-2;
        }
        .data-table th {
            @apply bg-gray-100 font-semibold;
        }
    </style>
</head>

<body class="p-4 sm:p-8">
    <!-- Navigation Links -->
    <div class="max-w-4xl mx-auto flex justify-between mb-4 text-lg font-semibold">
        <a href="./index.html" class="text-blue-600 hover:text-blue-800 underline">
            &larr; Go to Reading
        </a>
        <a href="./Spelling.html" class="text-indigo-600 hover:text-indigo-800 underline">
            Go to Spelling &rarr;
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 sm:p-10 mb-8 border-4 border-green-200">
        <h1 class="text-3xl sm:text-5xl font-extrabold text-center text-green-800 mb-2 header-font">
            Math Mission: Springfield Glitch
        </h1>
        <p class="text-gray-600 text-center mb-8 text-lg">
            3rd Grade Practice: Solve 10 problems to unlock the Volume Explorer!
        </p>

        <!-- Quiz Section -->
        <div id="quiz-container">
            <div id="questions-container" class="space-y-8">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </div>

            <div class="mt-10 text-center space-x-4">
                <button id="submitBtn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-700 transition duration-300 shadow-lg">
                    Check Answers
                </button>
            </div>
        </div>

        <div id="results" class="mt-8 p-6 rounded-lg text-center font-bold text-lg hidden">
            <p id="scoreText"></p>
            <div class="mt-4 space-x-4">
                <button id="startGameBtn" class="bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-full hover:bg-yellow-600 transition duration-300 shadow-md hidden">
                    Perfect Score! Play the Volume Explorer!
                </button>
                <button id="retakeQuizBtn" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full hover:bg-gray-400 transition duration-300 shadow-md hidden">
                    Try Again
                </button>
            </div>
        </div>

        <!-- RDW Help Modal (Initially hidden) -->
        <div id="helpModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="modalTitle" class="text-2xl font-bold text-blue-700 mb-4 header-font"></h2>
                <div id="modalBody" class="text-gray-700 text-base space-y-3">
                    <!-- RDW content inserted here -->
                </div>
                <button id="closeModalBtn" class="mt-6 bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition duration-300">
                    Close Explanation
                </button>
            </div>
        </div>


        <hr class="my-12 border-gray-200">

        <!-- Game Section (Volume Explorer) -->
        <div id="game-container" class="p-4 bg-gray-100 rounded-lg shadow-inner" style="display: none;">
            <div class="text-center mb-6">
                 <h1 class="text-3xl font-bold mb-2 header-font text-blue-700">Volume Explorer</h1>
                 <p class="text-gray-600">Choose a container, enter an amount, and see how full it gets!</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Container Selection -->
                <div id="container-selector" class="md:col-span-1 flex md:flex-col justify-around md:justify-start space-x-2 md:space-x-0 md:space-y-4">
                    <button id="juice-box-btn" class="container-btn">
                        <svg class="w-12 h-12" viewBox="0 0 100 100"><path d="M20,80 L20,20 L80,20 L80,80 Z M30,15 L70,15 L70,20 L30,20 Z" fill="none" stroke="#4b5563" stroke-width="3"/></svg>
                    </button>
                     <button id="water-bottle-btn" class="container-btn">
                        <svg class="w-12 h-12" viewBox="0 0 100 100"><path d="M30 95 L30 40 Q30 20 50 20 Q70 20 70 40 L70 95 Z M40 15 L60 15 L60 20 L40 20Z" fill="none" stroke="#4b5563" stroke-width="3"/></svg>
                    </button>
                     <button id="milk-carton-btn" class="container-btn">
                         <svg class="w-12 h-12" viewBox="0 0 100 100"><path d="M20 95 L20 30 L50 10 L80 30 L80 95 Z" fill="none" stroke="#4b5563" stroke-width="3"/></svg>
                    </button>
                     <button id="soda-bottle-btn" class="container-btn">
                        <svg class="w-12 h-12" viewBox="0 0 100 100"><path d="M35 95 C 20 80, 20 50, 35 40 L 40 15 L 60 15 L 65 40 C 80 50, 80 80, 65 95 Z M45 10 L55 10 L55 15 L45 15Z" fill="none" stroke="#4b5563" stroke-width="3"/></svg>
                    </button>
                </div>
                <!-- Visualizer -->
                <div class="md:col-span-3 flex flex-col items-center">
                    <div id="visualizer-svg" class="w-full h-64 md:h-96 bg-white rounded-lg border-2 border-gray-300 p-2 mb-4">
                        <!-- SVG will be injected here -->
                    </div>
                    <div class="text-center mb-4">
                        <p class="font-semibold text-lg" id="container-name">Select a container</p>
                        <p class="text-gray-600" id="container-capacity"></p>
                    </div>
                     <!-- Controls -->
                    <div class="flex items-center space-x-2 bg-white p-3 rounded-lg border border-gray-300 shadow-sm">
                        <input type="number" id="volume-input" value="1" class="w-24 p-2 border rounded-lg text-center font-bold">
                        <select id="unit-selector" class="p-2 border rounded-lg bg-gray-50">
                            <option value="L">Liters (L)</option>
                            <option value="mL" selected>milliliters (mL)</option>
                        </select>
                        <button id="fill-btn" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition">Fill it!</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- QUIZ DATA ---
        // (New questions based on rounding/estimation concepts and "Simpsons in Fortnite" story)
        const allQuestions = [{
            id: 'q1',
            questionText: `Homer eats 32 Lard Lad Donuts. Bart hits 18 players with his slingshot.
                          <br>Estimate the <strong>total</strong> number of donuts and hits by rounding each number to the nearest <strong>ten</strong>.`,
            options: [
                { value: 'A', text: '40' }, 
                { value: 'B', text: '50' }, 
                { value: 'C', text: '60' }, 
                { value: 'D', text: '50' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to estimate the total of donuts (32) and hits (18). First, round both numbers to the nearest ten. Then, add the rounded numbers.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>32 is between 30 and 40. It's closer to 30. So, 32 rounds to 30.<br>18 is between 10 and 20. It's closer to 20. So, 18 rounds to 20.<br>Now add: 30 + 20.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>30 + 20 = 50. The estimated total is <strong>50</strong>.</p></div>`
        }, {
            id: 'q2',
            questionText: `Peely builds a tower 88 meters high. The Kwik-E-Mart is 23 meters high.
                          <br>Estimate how much <strong>taller</strong> Peely's tower is than the Kwik-E-Mart by rounding each number to the nearest <strong>ten</strong>.`,
            options: [
                { value: 'A', text: '60 meters' }, 
                { value: 'B', text: '65 meters' }, 
                { value: 'C', text: '70 meters' }, 
                { value: 'D', text: '110 meters' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to estimate the difference between Peely's tower (88) and the Kwik-E-Mart (23). First, round both numbers to the nearest ten. Then, subtract.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>88 is between 80 and 90. It's closer to 90. So, 88 rounds to 90.<br>23 is between 20 and 30. It's closer to 20. So, 23 rounds to 20.<br>Now subtract: 90 - 20.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>90 - 20 = 70. Peely's tower is about <strong>70 meters</strong> taller.</p></div>`
        }, {
            id: 'q3',
            questionText: 'The new Battle Bus, disguised as Otto\'s school bus, flies 742 meters above Springfield. What is 742 rounded to the nearest <strong>ten</strong>?',
            options: [
                { value: 'A', text: '700' }, 
                { value: 'B', text: '740' }, 
                { value: 'C', text: '750' }, 
                { value: 'D', text: '800' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to round the number 742 to the nearest ten.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Look at the tens place (4). Now look at the ones place (2). The rule is: "5 or more, raise the score. 4 or less, let it rest."<br>Since 2 is "less," we "let it rest," meaning the tens place (4) stays the same. The one's place becomes 0.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>742 rounded to the nearest ten is <strong>740</strong>.</p></div>`
        }, {
            id: 'q4',
            questionText: 'The new Battle Bus flies 742 meters above Springfield. What is 742 rounded to the nearest <strong>hundred</strong>?',
            options: [
                { value: 'A', text: '700' }, 
                { value: 'B', text: '740' }, 
                { value: 'C', text: '750' }, 
                { value: 'D', text: '800' }
            ],
            correctAnswer: 'A',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to round the number 742 to the nearest hundred.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Look at the hundreds place (7). Now look at the tens place (4). The rule is: "5 or more, raise the score. 4 or less, let it rest."<br>Since 4 is "less," we "let it rest," meaning the hundreds place (7) stays the same. All other places become 0.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>742 rounded to the nearest hundred is <strong>700</strong>.</p></div>`
        }, {
            id: 'q5',
            questionText: 'Homer finds a pile of Chug Splashes. The number of splashes rounds to 60 when rounded to the nearest <strong>ten</strong>. Which of these could be the number of splashes?',
            options: [
                { value: 'A', text: '54 splashes' }, 
                { value: 'B', text: '66 splashes' }, 
                { value: 'C', text: '58 splashes' }, 
                { value: 'D', text: '65 splashes' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to find which of the answers rounds to 60 (nearest ten).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>Let's check each one:<br>A: 54 rounds to 50 (because 4 is "4 or less").<br>B: 66 rounds to 70 (because 6 is "5 or more").<br>C: 58 rounds to 60 (because 8 is "5 or more").<br>D: 65 rounds to 70 (because 5 is "5 or more").</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p><strong>58 splashes</strong> is the only number that rounds to 60.</p></div>`
        }, {
            id: 'q6',
            questionText: 'Lisa finds 47 blue mushrooms by the pond. What is 47 rounded to the nearest <strong>ten</strong>?',
            options: [
                { value: 'A', text: '40' }, 
                { value: 'B', text: '45' }, 
                { value: 'C', text: '50' }, 
                { value: 'D', text: '47' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to round 47 to the nearest ten.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>The number 47 is between 40 and 50. The ones digit is 7. Since 7 is "5 or more," we "raise the score" and round up to 50.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>47 rounds up to <strong>50</strong>.</p></div>`
        }, {
            id: 'q7',
            questionText: 'The Nuclear Power Plant has 685 buttons. Homer presses 103 of them. Estimate how many buttons Homer <strong>didn\'t</strong> press by rounding both numbers to the nearest <strong>ten</strong>.',
            options: [
                { value: 'A', text: '580 buttons' }, 
                { value: 'B', text: '590 buttons' }, 
                { value: 'C', text: '500 buttons' }, 
                { value: 'D', text: '600 buttons' }
            ],
            correctAnswer: 'B',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>Estimate the difference between 685 and 103. Round both numbers to the nearest ten, then subtract.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>685 rounds up to 690 (because 5 is "5 or more").<br>103 rounds down to 100 (because 3 is "4 or less").<br>Now subtract: 690 - 100.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>690 - 100 = 590. The estimated difference is <strong>590 buttons</strong>.</p></div>`
        }, {
            id: 'q8',
            questionText: 'Marge collects 377 wood. Homer collects 219 stone. Estimate the <strong>total</strong> materials they have by rounding both numbers to the nearest <strong>hundred</strong>.',
            options: [
                { value: 'A', text: '500' }, 
                { value: 'B', text: '596' }, 
                { value: 'C', text: '600' }, 
                { value: 'D', 'text': '700' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>Estimate the sum of 377 and 219. Round both numbers to the nearest hundred, then add.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>377 rounds up to 400 (because the tens digit, 7, is "5 or more").<br>219 rounds down to 200 (because the tens digit, 1, is "4 or less").<br>Now add: 400 + 200.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>400 + 200 = 600. The estimated total is <strong>600 materials</strong>.</p></div>`
        }, {
            id: 'q9',
            questionText: 'The storm circle will close in a number of seconds that rounds to 180 (nearest <strong>ten</strong>). What is the <strong>greatest</strong> whole number of seconds it could be?',
            options: [
                { value: 'A', text: '179 seconds' }, 
                { value: 'B', text: '181 seconds' }, 
                { value: 'C', text: '184 seconds' }, 
                { value: 'D', text: '185 seconds' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to find the biggest whole number that still rounds down or stays at 180 (nearest ten).</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>The numbers that round to 180 (nearest ten) start at 175 (which rounds up) and go all the way up to...<br>Let's check 185. The ones digit is 5 ("5 or more"), so 185 rounds up to 190. That's too high.<br>Let's check 184. The ones digit is 4 ("4 or less"), so 184 rounds down to 180. This is the biggest number that works.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>The greatest possible number of seconds is <strong>184 seconds</strong>.</p></div>`
        }, {
            id: 'q10',
            questionText: 'The Simpsons\' new house on the island has a yard that is 35 meters long and 25 meters wide. What is the <strong>total distance around the yard</strong> (the perimeter)?',
            options: [
                { value: 'A', text: '60 meters' }, 
                { value: 'B', text: '100 meters' }, 
                { value: 'C', text: '120 meters' }, 
                { value: 'D', text: '875 meters' }
            ],
            correctAnswer: 'C',
            rdw: `<div class="rdw-step"><p class="font-bold text-lg text-blue-700">1. Read:</p><p>We need to find the perimeter of a rectangle. The sides are 35 m and 25 m.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">2. Draw:</p><p>A rectangle has 4 sides. Two long sides (35 m) and two short sides (25 m).<br>We must add all four sides: 35 + 35 + 25 + 25.</p></div><div class="rdw-step"><p class="font-bold text-lg text-blue-700">3. Write:</p><p>35 + 35 = 70.<br>25 + 25 = 50.<br>70 + 50 = 120. The total perimeter is <strong>120 meters</strong>.</p></div>`
        }];


        // --- DOM Elements & Global State ---
        const submitBtn = document.getElementById('submitBtn');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const resultsDiv = document.getElementById('results');
        const scoreText = document.getElementById('scoreText');
        const questionsContainer = document.getElementById('questions-container');
        const quizContainer = document.getElementById('quiz-container');
        const gameContainer = document.getElementById('game-container');

        const helpModal = document.getElementById('helpModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeModalBtn = document.getElementById('closeModalBtn');

        let isQuizSubmitted = false;


        // --- QUIZ FUNCTIONS ---

        function renderQuiz() {
            questionsContainer.innerHTML = '';
            resultsDiv.classList.add('hidden');
            retakeQuizBtn.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            gameContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            isQuizSubmitted = false;

            allQuestions.forEach((q, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.id = q.id;
                questionDiv.className = 'question p-6 rounded-xl shadow-md bg-white border border-green-100';

                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex justify-between items-start mb-4';

                const questionText = document.createElement('p');
                questionText.className = 'font-semibold text-lg text-gray-800 flex-grow';
                questionText.innerHTML = `${questionIndex + 1}. ${q.questionText}`;
                headerDiv.appendChild(questionText);

                const helpBtn = document.createElement('button');
                helpBtn.className = 'ml-4 text-sm font-semibold text-blue-500 hover:text-blue-700 transition duration-150 py-1 px-3 rounded-full border border-blue-200';
                helpBtn.textContent = 'Get Help';
                helpBtn.setAttribute('data-question-id', q.id);
                helpBtn.addEventListener('click', showHelpModal);
                headerDiv.appendChild(helpBtn);

                questionDiv.appendChild(headerDiv);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-3 text-sm sm:text-base';
                questionDiv.appendChild(optionsDiv);

                q.options.forEach(option => {
                    const label = document.createElement('label');
                    label.className = 'question-option block bg-gray-50 p-3 rounded-lg border border-gray-200';
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = q.id;
                    input.value = option.value;
                    input.className = 'mr-3 accent-green-600';

                    label.appendChild(input);
                    const optionTextNode = document.createElement('span');
                    optionTextNode.innerHTML = option.text;
                    label.appendChild(optionTextNode);

                    label.addEventListener('click', () => {
                        document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                            radio.parentElement.classList.remove('selected');
                        });
                        label.classList.add('selected');
                        input.checked = true; 
                    });
                    optionsDiv.appendChild(label);
                });
                questionsContainer.appendChild(questionDiv);
            });
        }

        submitBtn.addEventListener('click', () => {
            if (isQuizSubmitted) return;
            isQuizSubmitted = true;
            let score = 0;
            let totalQuestions = allQuestions.length;
            let allAnswered = true;

            document.querySelectorAll('.question-option').forEach(label => {
                label.classList.remove('selected', 'correct-answer', 'incorrect-answer');
                label.classList.add('cursor-default');
            });
            document.querySelectorAll('.question input').forEach(input => input.disabled = true);

            allQuestions.forEach(q => {
                const questionDiv = document.getElementById(q.id);
                const selected = questionDiv.querySelector('input[type="radio"]:checked');
                const correctAnswerValue = q.correctAnswer;
                if (!selected) { allAnswered = false; return; }
                questionDiv.querySelectorAll('.question-option').forEach(label => {
                    if (label.querySelector('input').value === correctAnswerValue) {
                        label.classList.add('correct-answer');
                    }
                });
                if (selected.value === correctAnswerValue) {
                    score++;
                } else {
                    selected.parentElement.classList.add('incorrect-answer');
                }
            });

            if (!allAnswered) {
                showBasicMessage("Please answer all questions before submitting.");
                document.querySelectorAll('.question input').forEach(input => input.disabled = false);
                isQuizSubmitted = false;
                return;
            }

            const percentage = (score / totalQuestions) * 100;
            scoreText.textContent = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(0)}%).`;
            resultsDiv.classList.remove('hidden');
            retakeQuizBtn.classList.remove('hidden');

            if (score === totalQuestions) {
                resultsDiv.classList.add('bg-yellow-100', 'text-green-800');
                resultsDiv.classList.remove('bg-red-100', 'text-red-700');
                startGameBtn.classList.remove('hidden');
            } else {
                resultsDiv.classList.add('bg-red-100', 'text-red-700');
                resultsDiv.classList.remove('bg-yellow-100', 'text-green-800');
            }
        });

        retakeQuizBtn.addEventListener('click', () => {
            renderQuiz();
            document.querySelectorAll('.question input').forEach(input => input.disabled = false);
            document.querySelectorAll('.question-option').forEach(label => label.classList.remove('cursor-default'));
        });

        startGameBtn.addEventListener('click', () => {
            quizContainer.style.display = 'none';
            gameContainer.style.display = 'grid';
            initGame();
        });

        function showHelpModal(event) {
            const questionId = event.currentTarget.getAttribute('data-question-id');
            const question = allQuestions.find(q => q.id === questionId);
            if (question) {
                modalTitle.textContent = `Read-Draw-Write Help for Question ${questionId.replace('q', '')}`;
                modalBody.innerHTML = question.rdw;
                helpModal.classList.remove('hidden');
            }
        }
        closeModalBtn.addEventListener('click', () => { helpModal.classList.add('hidden'); });
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) { helpModal.classList.add('hidden'); }
        });

        function showBasicMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'modal-overlay';
            messageBox.innerHTML = `
                <div class="modal-content bg-yellow-50 border-4 border-yellow-400">
                    <p class="text-gray-800 text-lg sm:text-xl mb-4 font-semibold">${message}</p>
                    <button class="bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-yellow-500 transition duration-300">OK</button>
                </div>`;
            document.body.appendChild(messageBox);
            messageBox.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(messageBox);
            });
        }

        // --- VOLUME EXPLORER GAME LOGIC ---
        // (This game is unchanged)
        const visualizerDiv = document.getElementById('visualizer-svg');
        const containerNameEl = document.getElementById('container-name');
        const containerCapacityEl = document.getElementById('container-capacity');
        const volumeInput = document.getElementById('volume-input');
        const unitSelector = document.getElementById('unit-selector');
        const fillBtn = document.getElementById('fill-btn');
        const containerButtons = {
            'juice-box': document.getElementById('juice-box-btn'),
            'water-bottle': document.getElementById('water-bottle-btn'),
            'milk-carton': document.getElementById('milk-carton-btn'),
            'soda-bottle': document.getElementById('soda-bottle-btn'),
        };
        let currentContainerId = null;

        const containers = {
            'juice-box': {
                name: 'Juice Box',
                capacity: 250, // mL
                fillableHeight: 175, // The 'fillable' pixel height in the SVG
                fillableY: 50, // The starting Y position for filling
                svg: `
                    <svg viewBox="0 0 150 250">
                        <defs><clipPath id="juice-clip"><path d="M25,225 V50 H125 V225 Z" /></clipPath></defs>
                        <rect id="liquid" clip-path="url(#juice-clip)" x="0" y="250" width="150" height="0" fill="#f97316" style="transition: all 0.5s ease-in-out;"/>
                        <path d="M25,225 V50 H125 V225 Z M40,35 H110 V50 H40 Z" fill="none" stroke="#4b5563" stroke-width="4" />
                    </svg>`
            },
            'water-bottle': {
                name: 'Water Bottle',
                capacity: 500, // mL
                fillableHeight: 140,
                fillableY: 100,
                svg: `
                    <svg viewBox="0 0 150 250">
                        <defs><clipPath id="water-clip"><path d="M40,240 V100 C40,70 110,70 110,100 V240 Z" /></clipPath></defs>
                        <rect id="liquid" clip-path="url(#water-clip)" x="0" y="250" width="150" height="0" fill="#38bdf8" style="transition: all 0.5s ease-in-out;"/>
                        <path d="M40,240 V100 C40,70 110,70 110,100 V240 Z M50,50 h50 v-15 h-50 Z M60,35 h30 v-15 h-30 Z" fill="none" stroke="#4b5563" stroke-width="4" />
                    </svg>`
            },
            'milk-carton': {
                name: 'Milk Carton',
                capacity: 1000, // mL
                fillableHeight: 170, 
                fillableY: 70, 
                svg: `
                    <svg viewBox="0 0 150 250">
                        <defs><clipPath id="milk-clip"><path d="M25,240 V70 L75,30 L125,70 V240 Z" /></clipPath></defs>
                        <rect id="liquid" clip-path="url(#milk-clip)" x="0" y="250" width="150" height="0" fill="#e2e8f0" style="transition: all 0.5s ease-in-out;"/>
                        <path d="M25,240 V70 L75,30 L125,70 V240 Z" fill="none" stroke="#4b5563" stroke-width="4" />
                    </svg>`
            },
            'soda-bottle': {
                name: 'Soda Bottle',
                capacity: 2000, // mL
                fillableHeight: 160,
                fillableY: 80,
                svg: `
                    <svg viewBox="0 0 150 250">
                        <defs><clipPath id="soda-clip"><path d="M45,240 C20,200 20,100 45,80 V40 H105 V80 C130,100 130,200 105,240 Z" /></clipPath></defs>
                        <rect id="liquid" clip-path="url(#soda-clip)" x="0" y="250" width="150" height="0" fill="#166534" style="transition: all 0.5s ease-in-out;"/>
                        <path d="M45,240 C20,200 20,100 45,80 V40 H105 V80 C130,100 130,200 105,240 Z M60,20 h30 v20 h-30 Z" fill="none" stroke="#4b5563" stroke-width="4" />
                    </svg>`
            }
        };

        function selectContainer(id) {
            currentContainerId = id;
            const container = containers[id];
            
            // Add checks to ensure elements exist before manipulating them
            if (visualizerDiv) visualizerDiv.innerHTML = container.svg;
            if (containerNameEl) containerNameEl.textContent = container.name;
            if (containerCapacityEl) containerCapacityEl.textContent = `Capacity: ${container.capacity} mL (${container.capacity / 1000} L)`;
            
            for (const btnId in containerButtons) {
                 if (containerButtons[btnId]) { // Check if button exists
                    containerButtons[btnId].classList.toggle('selected', btnId === id);
                 }
            }
            if (volumeInput) volumeInput.value = container.capacity / 2;
            if (unitSelector) unitSelector.value = 'mL';
            handleFill();
        }

        function handleFill() {
            if (!currentContainerId) return;

            const container = containers[currentContainerId];
            const liquidEl = document.getElementById('liquid');
             if (!liquidEl || !volumeInput || !unitSelector) return; // Add checks for elements

            let amount = parseFloat(volumeInput.value) || 0;
            const unit = unitSelector.value;

            if (unit === 'L') {
                amount *= 1000; // Convert Liters to mL
            }

            let fillPercent = (amount / container.capacity);
            fillPercent = Math.max(0, Math.min(1, fillPercent)); // Clamp between 0 and 1
            
            const liquidHeight = fillPercent * container.fillableHeight;
            const yPos = container.fillableY + container.fillableHeight - liquidHeight;
            
            liquidEl.setAttribute('y', yPos);
            liquidEl.setAttribute('height', liquidHeight);
        }

        function initGame() {
            // Add checks for button existence before adding listeners
            if (containerButtons['juice-box']) containerButtons['juice-box'].addEventListener('click', () => selectContainer('juice-box'));
            if (containerButtons['water-bottle']) containerButtons['water-bottle'].addEventListener('click', () => selectContainer('water-bottle'));
            if (containerButtons['milk-carton']) containerButtons['milk-carton'].addEventListener('click', () => selectContainer('milk-carton'));
            if (containerButtons['soda-bottle']) containerButtons['soda-bottle'].addEventListener('click', () => selectContainer('soda-bottle'));
            if (fillBtn) fillBtn.addEventListener('click', handleFill);
            
            selectContainer('juice-box'); // Select default container
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
        });
    </script>
</body>

</html>

